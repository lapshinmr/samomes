var Te=Object.defineProperty;var Ce=(W,t,o)=>t in W?Te(W,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):W[t]=o;var x=(W,t,o)=>Ce(W,typeof t!="symbol"?t+"":t,o);import{_ as ke}from"./Drs9EG8R.js";import{V as oe,a as _e,_ as we}from"./Djne1Sei.js";import{_ as ue}from"./BXmhU4Z4.js";import{F as S,A as ne,D as Q}from"./BoIzNFIF.js";import{f as T,g as pe,a as Re,b as Ee}from"./FI_hX0un.js";import{e as Y,k as X,F as U,c as d,o as i,b as r,i as E,w as D,j as e,A as M,I as R,a,L,h as N,t as u,_ as $e,m as Fe,d as _,G as ge,H as Se,r as j,E as Me,z as ie,f as he,M as Ae,C as Ue,N as We,D as Ie,J as me,n as Oe,B as Ne}from"./CAjOBrmp.js";import{u as ye}from"./CP7GEBIt.js";import{u as te}from"./DauQQsIp.js";import{V as le,a as Le}from"./WnvZM1YP.js";import{V as ce}from"./B9tvuOiE.js";import{_ as xe}from"./DNq6m-Jf.js";import{R as P}from"./CpQkKza9.js";import{V as be}from"./u_RKPdEX.js";import{V as de}from"./B_VsIeC2.js";import{_ as Ve,V as je}from"./DgVljYhS.js";import{u as Ge}from"./Cp5yawAZ.js";import{u as Pe}from"./DNEFbcd8.js";import{u as De}from"./CFamQGYr.js";import{t as ve,a as re}from"./BBggtmFf.js";import{a as J}from"./BbNfchzT.js";import{V as He}from"./CO79grmH.js";import{V as qe}from"./DqSffNVo.js";import{V as K}from"./BnGVFgx6.js";import Be from"./tIjPzFjq.js";import{C as Je,p as Ke,a as Ye,b as Xe,L as Ze,P as Qe,c as et,d as tt,e as st}from"./CZ6FVyBU.js";import{M as G}from"./DFSzMgOG.js";import{V as at}from"./DIDKVmLy.js";import{a as nt,b as lt,c as ot,V as it}from"./CC46wD0t.js";import{V as fe}from"./DtKLawVR.js";import{_ as rt}from"./DNMeGNJU.js";import{u as ut}from"./sDtukEVE.js";import{u as dt}from"./BXAQlSoM.js";import{u as mt}from"./BO9C2837.js";import{u as ct}from"./CGgjgG8i.js";import{F as ft}from"./CFPUExE7.js";import{D as ee}from"./g4IDhZ2R.js";import{b as pt,a as gt,V as ht}from"./B4h3jHlb.js";import"./B931MWyl.js";import"./8aZ8wFKZ.js";import"./CmCO8bft.js";import"./8EgpZJj2.js";import"./CwwTltiD.js";import"./BHlOY6NW.js";import"./BrjXlFfO.js";import"./CXMC8vWC.js";import"./BKgp5Z4T.js";import"./ClBR376H.js";import"./BzQJ-91M.js";import"./L3mZOQHR.js";/* empty css        */import"./BXpKWP0_.js";import"./CCHlbqFp.js";import"./CYc57goH.js";const yt={class:"d-flex"},bt={class:"d-flex w-100"},Vt={class:"d-flex align-start"},Dt={class:"d-flex mt-4"},vt={class:"text-subtitle-1 font-weight-medium w-100 pr-2"},zt={style:{position:"relative",top:"3px"}},Tt={class:"d-flex align-start"},Ct={class:"d-flex"},kt={class:"font-weight-medium align-self-end w-60 pr-2"},_t={style:{position:"relative",top:"3px"}},wt={class:"w-40 font-weight-medium"},Rt={class:"d-flex w-40"},Et=Y({name:"TheFertilizersDosesTable",__name:"TheFertilizerDosesTable",setup(W){const{t}=X(),{required:o,positive:l}=ye(),h=[{text:t("dosing.dosesTable.everyDay"),value:!1},{text:t("dosing.dosesTable.total"),value:!0}],s=te(),b=U({get(){return s.isTotalMode},set(f){s.setTotalMode(f)}}),m=U({get(){return s.daysTotal},set(f){s.setDaysTotal(f)}}),V=U({get(){return s.fertilizersRegime},set(f){s.setFertilizersRegime(f)}}),n=U({get(){return s.tank.waterChangeVolume},set(f){s.setWaterChangeVolume(f)}});return(f,k)=>{const w=ue;return i(),d("div",null,[r(Le,{modelValue:e(V),"onUpdate:modelValue":k[0]||(k[0]=g=>M(V)?V.value=g:null),color:"primary",class:"my-2 ml-n3","hide-details":"auto",inline:f.$vuetify.display.smAndUp},{default:D(()=>[r(le,{label:e(t)("dosing.dosesTable.regime1"),value:0},null,8,["label"]),r(le,{label:e(t)("dosing.dosesTable.regime2"),value:1,class:"mt-1 mt-sm-0"},null,8,["label"]),r(le,{label:e(t)("dosing.dosesTable.regime3"),value:2,class:"mt-1 mt-sm-0"},null,8,["label"])]),_:1},8,["modelValue","inline"]),e(V)===("FertilizersRegime"in f?f.FertilizersRegime:e(S)).EVERY_DAY?(i(),d(R,{key:0},[a("div",yt,[r(oe,{modelValue:e(b),"onUpdate:modelValue":k[1]||(k[1]=g=>M(b)?b.value=g:null),items:h,"item-title":"text","item-value":"value",variant:"underlined",class:"w-60 pr-2","hide-details":"auto"},null,8,["modelValue"]),r(w,{modelValue:e(m),"onUpdate:modelValue":k[2]||(k[2]=g=>M(m)?m.value=g:null),"hide-details":"auto",class:"w-40",label:e(t)("dosing.dosesTable.daysTotal"),rules:[e(l)]},null,8,["modelValue","label","rules"])]),(i(!0),d(R,null,L(e(s).doseModels,(g,A)=>(i(),d("div",{key:A,class:"d-flex justify-space-between align-center"},[a("div",bt,[e(b)?(i(),N(w,{key:0,"model-value":("format"in f?f.format:e(T))(g.amount),label:g.fertilizer.name,suffix:g.fertilizer.isLiquid?e(t)("units.ml"):e(t)("units.g"),"hide-details":"auto","onUpdate:modelValue":p=>e(s).updateAmount(p,A)},null,8,["model-value","label","suffix","onUpdate:modelValue"])):(i(),N(w,{key:1,"model-value":("format"in f?f.format:e(T))(g.amountDay),label:g.fertilizer.name,suffix:g.fertilizer.isLiquid?e(t)("units.ml/d"):e(t)("units.g/d"),"hide-details":"auto","onUpdate:modelValue":p=>e(s).updateAmountDay(p,A)},null,8,["model-value","label","suffix","onUpdate:modelValue"]))])]))),128))],64)):e(V)===("FertilizersRegime"in f?f.FertilizersRegime:e(S)).ONCE_A_WEEK?(i(),d(R,{key:1},[a("div",Vt,[r(w,{modelValue:e(n),"onUpdate:modelValue":k[3]||(k[3]=g=>M(n)?n.value=g:null),label:e(t)("dosing.dosesTable.waterChange"),hint:e(t)("dosing.dosesTable.waterChangeHint"),"persistent-hint":"",class:"pr-2 w-60","validate-on":"eager",rules:[e(o),e(l)]},null,8,["modelValue","label","hint","rules"]),r(w,{modelValue:e(m),"onUpdate:modelValue":k[4]||(k[4]=g=>M(m)?m.value=g:null),"hide-details":"auto",class:"w-40",label:e(t)("dosing.dosesTable.daysTotal"),rules:[e(l)]},null,8,["modelValue","label","rules"])]),a("div",Dt,[a("div",vt,[a("span",zt,u(e(t)("dosing.dosesTable.doseTotal")),1),r(ce,{class:"mt-1"})])]),(i(!0),d(R,null,L(e(s).doseModels,(g,A)=>(i(),d("div",{key:A,class:"d-flex justify-space-between align-center"},[r(w,{"model-value":("format"in f?f.format:e(T))(g.amount),label:g.fertilizer.name,suffix:g.fertilizer.isLiquid?e(t)("units.ml"):e(t)("units.g"),"hide-details":"auto",class:"pr-2",disabled:!e(n),"onUpdate:modelValue":p=>e(s).updateAmount(p,A)},null,8,["model-value","label","suffix","disabled","onUpdate:modelValue"])]))),128))],64)):e(V)===("FertilizersRegime"in f?f.FertilizersRegime:e(S)).MIX?(i(),d(R,{key:2},[a("div",Tt,[r(w,{modelValue:e(n),"onUpdate:modelValue":k[5]||(k[5]=g=>M(n)?n.value=g:null),label:e(t)("dosing.dosesTable.waterChange"),hint:e(t)("dosing.dosesTable.waterChangeHint"),"persistent-hint":"",class:"pr-2 w-60","validate-on":"eager",rules:[e(o),e(l)]},null,8,["modelValue","label","hint","rules"]),r(w,{modelValue:e(m),"onUpdate:modelValue":k[6]||(k[6]=g=>M(m)?m.value=g:null),"hide-details":"auto",label:e(t)("dosing.dosesTable.daysTotal"),class:"w-40",rules:[e(l)]},null,8,["modelValue","label","rules"])]),a("div",Ct,[a("div",kt,[a("span",_t,u(e(t)("dosing.dosesTable.waterChangeTitle")),1),r(ce,{class:"mt-1"})]),a("div",wt,[r(oe,{modelValue:e(b),"onUpdate:modelValue":k[7]||(k[7]=g=>M(b)?b.value=g:null),items:h,"item-title":"text","item-value":"value",variant:"underlined","hide-details":"auto"},null,8,["modelValue"])])]),(i(!0),d(R,null,L(e(s).doseModels,(g,A)=>(i(),d("div",{key:A,class:"d-flex justify-space-between align-center"},[r(w,{"model-value":("format"in f?f.format:e(T))(g.amountWaterChange),label:g.fertilizer.name,suffix:g.fertilizer.isLiquid?e(t)("units.ml"):e(t)("units.g"),"hide-details":"auto",class:"pr-2 w-60",disabled:!e(n),"onUpdate:modelValue":p=>e(s).updateAmountWaterChange(p,A)},null,8,["model-value","label","suffix","disabled","onUpdate:modelValue"]),a("div",Rt,[e(b)?(i(),N(w,{key:0,"model-value":("format"in f?f.format:e(T))(g.amount),suffix:g.fertilizer.isLiquid?e(t)("units.ml"):e(t)("units.g"),"hide-details":"auto","onUpdate:modelValue":p=>e(s).updateAmount(p,A)},null,8,["model-value","suffix","onUpdate:modelValue"])):(i(),N(w,{key:1,"model-value":("format"in f?f.format:e(T))(g.amountDay),suffix:g.fertilizer.isLiquid?e(t)("units.ml/d"):e(t)("units.g/d"),"hide-details":"auto","onUpdate:modelValue":p=>e(s).updateAmountDay(p,A)},null,8,["model-value","suffix","onUpdate:modelValue"]))])]))),128))],64)):E("",!0)])}}}),$t=$e(Et,[["__scopeId","data-v-a4cf41f5"]]),Ft={class:"d-flex flex-column flex-md-row justify-space-between align-md-center mt-2 mb-2"},St={class:"pl-0 text-center"},Mt={class:"text-center"},At={class:"text-center"},Ut={class:"text-center"},Wt={class:"text-center"},It={class:"text-center"},Ot={class:"text-center"},Nt={class:"text-center"},Lt={class:"text-center"},xt={key:3,class:"text-center"},jt={class:"pl-0 text-center"},Gt={class:"text-center text-no-wrap"},Pt={class:"text-center text-no-wrap"},Ht={class:"text-center text-no-wrap"},qt={class:"text-center text-no-wrap"},Bt={class:"text-center text-no-wrap"},Jt={class:"text-center text-no-wrap"},Kt={class:"text-center text-no-wrap"},Yt={class:"text-center text-no-wrap"},Xt={key:3,class:"text-center"},Zt=Y({name:"TheElementsTable",__name:"TheDosingElementsTable",props:{dosing:{}},setup(W){const{t}=X(),o=te(),l=U({get(){return o.isHardness},set(s){o.setHardness(s)}});function h(s){return s<.001&&s!==0?t("dosing.smallValue"):s}return(s,b)=>{const m=xe;return i(),d("div",null,[a("div",Ft,[r(be,{modelValue:e(l),"onUpdate:modelValue":b[0]||(b[0]=V=>M(l)?l.value=V:null),color:"primary",label:e(t)("dosing.elementsTable.showGh"),"hide-details":"auto",class:"mt-0 mb-2 mb-sm-0"},null,8,["modelValue","label"]),Fe(s.$slots,"default")]),r(de,{density:"compact"},{default:D(()=>[a("thead",null,[a("tr",null,[a("th",St,u(e(t)("dosing.elementsTable.element")),1),e(o).fertilizersRegime===("FertilizersRegime"in s?s.FertilizersRegime:e(S)).EVERY_DAY?(i(),d(R,{key:0},[a("th",Mt,[_(u(e(t)("dosing.elementsTable.everyDayDose"))+" ",1),a("span",null,u(e(t)("units.mg/l")),1)]),a("th",At,[_(u(e(t)("dosing.elementsTable.totalDose"))+", ",1),a("span",null,u(e(t)("units.mg/l")),1)])],64)):E("",!0),e(o).fertilizersRegime===("FertilizersRegime"in s?s.FertilizersRegime:e(S)).ONCE_A_WEEK?(i(),d(R,{key:1},[a("th",Ut,[_(u(e(t)("dosing.elementsTable.inWaterChangeDose"))+", ",1),a("span",null,u(e(t)("units.mg/l")),1)]),a("th",Wt,[_(u(e(t)("dosing.elementsTable.everyDayDose"))+", ",1),a("span",null,u(e(t)("units.mg/l")),1)]),a("th",It,[_(u(e(t)("dosing.elementsTable.totalDose"))+", ",1),a("span",null,u(e(t)("units.mg/l")),1)])],64)):E("",!0),e(o).fertilizersRegime===("FertilizersRegime"in s?s.FertilizersRegime:e(S)).MIX?(i(),d(R,{key:2},[a("th",Ot,[_(u(e(t)("dosing.elementsTable.inWaterChangeDose"))+", ",1),a("span",null,u(e(t)("units.mg/l")),1)]),a("th",Nt,[_(u(e(t)("dosing.elementsTable.inDayWeekDose"))+", ",1),a("span",null,u(e(t)("units.mg/l")),1)]),a("th",Lt,[_(u(e(t)("dosing.elementsTable.totalDose"))+", ",1),a("span",null,u(e(t)("units.mg/l")),1)])],64)):E("",!0),e(l)?(i(),d("th",xt," Gh ")):E("",!0)])]),a("tbody",null,[(i(!0),d(R,null,L(s.dosing.concentrationSorted,([V,n])=>(i(),d("tr",{key:V,class:"caption regular-sm"},[a("td",jt,u(V),1),e(o).fertilizersRegime===("FertilizersRegime"in s?s.FertilizersRegime:e(S)).EVERY_DAY?(i(),d(R,{key:0},[a("td",Gt,u(h(("format"in s?s.format:e(T))(n.concentrationDay))),1),a("td",Pt,u(h(("format"in s?s.format:e(T))(n.concentration))),1)],64)):E("",!0),e(o).fertilizersRegime===("FertilizersRegime"in s?s.FertilizersRegime:e(S)).ONCE_A_WEEK?(i(),d(R,{key:1},[a("td",Ht,u(h(("format"in s?s.format:e(T))(n.concentrationWaterChange))),1),a("td",qt,u(h(("format"in s?s.format:e(T))(n.concentrationDay))),1),a("td",Bt,u(h(("format"in s?s.format:e(T))(n.concentration))),1)],64)):E("",!0),e(o).fertilizersRegime===("FertilizersRegime"in s?s.FertilizersRegime:e(S)).MIX?(i(),d(R,{key:2},[a("td",Jt,u(h(("format"in s?s.format:e(T))(n.concentrationWaterChange))),1),a("td",Kt,u(h(("format"in s?s.format:e(T))(n.concentrationDay)))+" / "+u(h(("format"in s?s.format:e(T))(n.concentration))),1),a("td",Yt,u(h(("format"in s?s.format:e(T))(n.concentrationTotal))),1)],64)):E("",!0),e(l)?(i(),d("td",Xt,[V in("RemineralRecipe"in s?s.RemineralRecipe:e(P)).GH?(i(),d(R,{key:0},[[("FertilizersRegime"in s?s.FertilizersRegime:e(S)).ONCE_A_WEEK,("FertilizersRegime"in s?s.FertilizersRegime:e(S)).EVERY_DAY].includes(e(o).fertilizersRegime)?(i(),d(R,{key:0},[_(" +"+u(("format"in s?s.format:e(T))(n.concentration/("RemineralRecipe"in s?s.RemineralRecipe:e(P)).GH[V])),1)],64)):E("",!0),("FertilizersRegime"in s?s.FertilizersRegime:e(S)).MIX===e(o).fertilizersRegime?(i(),d(R,{key:1},[_(" +"+u(("format"in s?s.format:e(T))(n.concentrationTotal/("RemineralRecipe"in s?s.RemineralRecipe:e(P)).GH[V])),1)],64)):E("",!0)],64)):E("",!0)])):E("",!0)]))),128))])]),_:1}),r(m,{concentration:s.dosing.concentrationTotal,"is-gh":e(l),class:"mt-8"},null,8,["concentration","is-gh"])])}}});class Qt{constructor(t){x(this,"dosing");x(this,"startDate");x(this,"waterChangeDay",{date:"",fertilizers:{}});x(this,"days",[]);this.dosing=t}get daysAmountTotal(){const t={};return this.days.forEach(o=>{ve(o.fertilizers).forEach(([l,h])=>{l in t||(t[l]=0),t[l]+=h.amount})}),t}get daysSelectedTotal(){const t={};return this.days.forEach(o=>{re(o.fertilizers).forEach(l=>{l in t||(t[l]=0),o.fertilizers[l].selected&&(t[l]+=1)})}),t}resetWaterChangeDay(){this.waterChangeDay={date:"",fertilizers:{}}}resetDays(){this.days=[]}initWaterChangeDay(){this.resetWaterChangeDay(),this.waterChangeDay.date=this.startDate,this.dosing.doses.forEach(t=>{t.amountWaterChange&&(this.waterChangeDay.fertilizers[t.fertilizer.name]={amount:t.amountWaterChange,status:ne.ACTIVE})})}initDays(){this.resetDays();let t=new Date(this.startDate);[...Array(this.dosing.daysTotal)].forEach(()=>{const o=pe(t),l={};this.dosing.doses.forEach(h=>{h.amountDay&&(l[h.fertilizer.name]={amount:h.amountDay,status:ne.ACTIVE,selected:!0})}),Object.entries(l).length!==0&&this.days.push({date:o,fertilizers:l}),t=new Date(t.setDate(t.getDate()+1))})}updateDays(){let t=new Date(this.startDate);for(const o of this.days){o.date=t.toISOString().split("T")[0];for(const l in o.fertilizers)o.fertilizers[l].status=ne.ACTIVE;t=new Date(t.setDate(t.getDate()+1))}}spreadDayAmounts(t){const o=this.dosing.doses.find(l=>l.fertilizer.name===t);o&&this.days.forEach(l=>{o.amountDay&&l.fertilizers[t].selected&&(l.fertilizers[t].amount=T(o.amount/this.daysSelectedTotal[t]))})}resetDaysAmount(t){const o=this.dosing.doses.find(l=>l.fertilizer.name===t);o&&this.days.forEach(l=>{l.fertilizers[t].amount=T(o.amount/this.days.length),l.fertilizers[t].selected=!0})}toJson(){return{dosing:this.dosing.toJson(),startDate:this.startDate,waterChangeDay:this.waterChangeDay,days:this.days}}}const es={key:0},ts={key:0},ss={class:"pl-0 text-center"},as={class:"d-flex flex-column"},ns={style:{"text-transform":"capitalize"}},ls={key:0,class:"d-flex justify-center align-center"},os={style:{width:"50px"}},is={key:0,class:"d-flex flex-column align-center"},rs={class:"font-weight-medium"},us=["onClick"],ds={class:"d-flex mt-10"},ms=Y({name:"TheScheduleDoseTable",__name:"TheScheduleDoseTable",props:{dosing:{}},setup(W){const{t}=X(),o=ge(),l=Se(),{appRoutes:h}=Ge(),s=Pe(),b=De(),m=W,V=j(),n=Me(new Qt(m.dosing)),f=U(()=>!isNaN(V.value));ie(()=>m.dosing,()=>{n.dosing=m.dosing,n.startDate&&(n.initWaterChangeDay(),n.initDays())}),he(()=>{if(V.value=+o.query.schedule,isNaN(V.value))n.startDate=pe(new Date),n.initWaterChangeDay(),n.initDays();else{const p=JSON.parse(JSON.stringify(s.schedules[V.value]));p&&(n.startDate=p.startDate,n.waterChangeDay=p.waterChangeDay,n.days=p.days)}});function k(p){p&&(n.startDate=p,n.initWaterChangeDay(),n.days.length>0?n.updateDays():n.initDays())}async function w(){f.value?s.editSchedule(V.value,n.toJson()):s.saveSchedule(n.toJson()),await l.push(h.value.schedules.path)}function g(p,z){z.selected||(z.amount=0),n.spreadDayAmounts(p)}async function A(){s.removeSchedule(V.value),b.show("Расписание удалено"),await l.push(h.value.schedules.path)}return(p,z)=>{const H=ue;return i(),d("div",null,[r(He,{"model-value":e(n).startDate,type:"date",label:"Выберите дату подмены",class:"mb-4","onUpdate:modelValue":k},null,8,["model-value"]),r(J,null,{default:D(()=>[e(n).startDate?(i(),d("div",es,[r(de,{"fixed-footer":""},{default:D(()=>[a("thead",null,[a("tr",null,[z[1]||(z[1]=a("th",{class:"text-center pl-0"}," Дни ",-1)),(i(!0),d(R,null,L(e(n).dosing.doses,v=>(i(),d("th",{key:v.fertilizer.name,class:"text-center"},u(v.fertilizer.name),1))),128))])]),a("tbody",null,[e(n).dosing.fertilizersRegime===("FertilizersRegime"in p?p.FertilizersRegime:e(S)).ONCE_A_WEEK||e(n).dosing.fertilizersRegime===("FertilizersRegime"in p?p.FertilizersRegime:e(S)).MIX?(i(),d("tr",ts,[z[2]||(z[2]=a("td",{class:"pl-0 text-center"}," Подмена ",-1)),(i(!0),d(R,null,L(e(n).dosing.doses,v=>{var I;return i(),d("td",{key:`water_change_${v.fertilizer.name}`,class:"text-center"},u(((I=e(n).waterChangeDay.fertilizers[v.fertilizer.name])==null?void 0:I.amount)||"—"),1)}),128))])):E("",!0),e(n).days.length>0?(i(),d(R,{key:1},[(i(!0),d(R,null,L(e(n).days,v=>(i(),d("tr",{key:v.date},[a("td",ss,[a("div",as,[a("span",ns,u(("getWeekday"in p?p.getWeekday:e(Re))(v.date)),1),a("span",null,u(("formatDate"in p?p.formatDate:e(Ee))(v.date)),1)])]),(i(!0),d(R,null,L(e(n).dosing.doses,I=>{var C;return i(),d("td",{key:I.fertilizer.name+v,class:"text-center"},[((C=v.fertilizers[I.fertilizer.name])==null?void 0:C.amount)!==void 0?(i(),d("div",ls,[a("div",os,[r(H,{modelValue:v.fertilizers[I.fertilizer.name].amount,"onUpdate:modelValue":y=>v.fertilizers[I.fertilizer.name].amount=y},null,8,["modelValue","onUpdate:modelValue"])]),r(qe,{modelValue:v.fertilizers[I.fertilizer.name].selected,"onUpdate:modelValue":[y=>v.fertilizers[I.fertilizer.name].selected=y,y=>g(I.fertilizer.name,v.fertilizers[I.fertilizer.name])],color:"primary",dense:"","hide-details":"auto",class:"mt-0 ml-1",style:{display:"inline-block"}},null,8,["modelValue","onUpdate:modelValue"])])):(i(),d(R,{key:1},[_(" — ")],64))])}),128))]))),128)),a("tr",null,[z[4]||(z[4]=a("td",{class:"font-weight-medium"}," Total ",-1)),(i(!0),d(R,null,L(e(n).dosing.doses,v=>(i(),d("td",{key:v.fertilizer.name,class:"text-center"},[e(n).daysAmountTotal[v.fertilizer.name]?(i(),d("div",is,[a("div",null,[a("span",{class:Ae({"text-warning":("format"in p?p.format:e(T))(e(n).daysAmountTotal[v.fertilizer.name])!==("format"in p?p.format:e(T))(v.amount)})},u(("format"in p?p.format:e(T))(e(n).daysAmountTotal[v.fertilizer.name])),3),z[3]||(z[3]=_(" / ")),a("span",rs,u(("format"in p?p.format:e(T))(v.amount)),1)]),a("div",{class:"text-blue cursor-pointer",onClick:I=>e(n).resetDaysAmount(v.fertilizer.name)}," Сбросить ",8,us)])):(i(),d(R,{key:1},[_(" — ")],64))]))),128))])],64)):E("",!0)])]),_:1}),a("div",ds,[e(f)?(i(),N(K,{key:0,color:"error",onClick:A},{default:D(()=>[_(u(e(t)("buttons.remove")),1)]),_:1})):E("",!0),r(K,{class:"ml-auto mr-1 mr-sm-2 ml-sm-auto",onClick:z[0]||(z[0]=v=>e(l).push(e(h).schedules.path))},{default:D(()=>[_(u(e(t)("buttons.cancel")),1)]),_:1}),r(K,{color:"primary",onClick:w},{default:D(()=>[_(u(e(t)("buttons.save")),1)]),_:1})])])):E("",!0)]),_:1})])}}}),cs=Y({__name:"LineChart",props:{data:{},options:{}},setup(W){return Je.register(Ke,Ye,Xe,Ze,Qe,et,tt),(t,o)=>(i(),N(e(st),{id:"my-chart-id",options:t.options,data:t.data},null,8,["options","data"]))}}),fs={key:0},ps={class:"mb-4 text-body-2"},gs={class:"text-center"},hs={class:"text-center"},ys={class:"text-center"},bs={key:0},Vs={class:"text-center"},Ds={class:"text-center"},vs={key:0},zs=Y({name:"TheDynamicsPopup",__name:"TheDynamicsPopup",props:Ue({dosing:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:["update:modelValue"],setup(W){const{t}=X(),{mdAndUp:o}=We(),{positive:l}=ye(),h=te(),s=Ie(W,"modelValue"),b=W,m=j(!1),V=j(),n=j(),f=j(),k=j(),w=j([]),g={NO3:"#D81B60",PO4:"#1E88E5",K:"#78909C"},A={maintainAspectRatio:!1,responsive:!0},p=U(()=>({labels:Object.keys([...Array(b.dosing.daysTotal*15)]),datasets:[{label:V.value,fill:!1,borderColor:g[V.value],data:w.value}]})),z=U(()=>b.dosing.countBalancedIons()),H=U(()=>"Ca"in z.value&&"Mg"in z.value?z.value.Ca[0]/z.value.Mg[0]:null),v=U(()=>"Ca"in z.value&&"Mg"in z.value?z.value.Ca[1]/z.value.Mg[1]:null),I=U(()=>P.countCaGh(z.value.Ca[0],1/G,1)+P.countMgGh(z.value.Mg[0],1/G,1)),C=U(()=>P.countCaGh(z.value.Ca[1],1/G,1)+P.countMgGh(z.value.Mg[1],1/G,1)),y=U({get(){return h.tank.waterChangeVolume},set(F){h.setWaterChangeVolume(F)}});ie(V,()=>{n.value=0,f.value=0,k.value=0}),ie([V,n,f,k,()=>b.dosing],()=>{w.value=b.dosing.countIonDynamic(V.value,n.value,f.value,k.value)});function q(){return Math.ceil(Math.log(.05)/Math.log(1-b.dosing.waterChangeDecimal))}return(F,c)=>{const B=ue,Z=Be,se=Ve,ae=cs;return i(),N(at,{modelValue:s.value,"onUpdate:modelValue":c[7]||(c[7]=$=>s.value=$),"max-width":"700"},{default:D(()=>[r(it,null,{default:D(()=>[r(nt,null,{default:D(()=>c[8]||(c[8]=[_(" Параметры в аквариуме ")])),_:1}),r(lt,null,{default:D(()=>[r(B,{modelValue:e(y),"onUpdate:modelValue":c[0]||(c[0]=$=>M(y)?y.value=$:null),label:e(t)("dosing.dosesTable.waterChange"),hint:e(t)("dosing.dosesTable.waterChangeHint"),"persistent-hint":"",class:"pr-2 w-60 mb-4","validate-on":"eager",rules:[e(l)]},null,8,["modelValue","label","hint","rules"]),r(J,null,{default:D(()=>[e(y)?(i(),d("div",fs,[a("div",ps,[_(" При заданном режиме подмен ("+u(F.dosing.waterChangePercent)+"% объёма каждые "+u(F.dosing.daysTotal)+" д) и выбранных дозировках удобрений равновесные параметры будут достигнуты через "+u(q())+" подмен ("+u(F.dosing.daysTotal*(q()-1))+" д) и будут следующими ",1),r(fe,{location:"bottom","max-width":"400","open-on-click":"","open-on-hover":""},{activator:D(({props:$})=>[r(Z,me({name:"mdi-help-circle-outline",size:"18",class:"mb-n1"},$),null,16)]),default:D(()=>[c[9]||(c[9]=a("p",{class:"mb-2"}," Данные концентрации в аквариуме рассчитаны с допущением, что в аквариуме нет поглотителей. И если для таких элементов, как калий, кальций, магний, такой расчет является довольно точным, то для фосфата и нитрата данные значения будут сильно завышенными. Тем не менее даже для фосфата и нитрата таким образом мы можем получить верхний диапазон значений, чтобы исключить передозировку этих элементов в том случае, если растения по каким-то причинам перестали расти. ",-1)),c[10]||(c[10]=a("p",null," Если вы хотите понять, как будут изменяться концентрации с учетом потребления элементов, то можете воспользоваться расположенной ниже секцией «Динамика». ",-1))]),_:1}),c[11]||(c[11]=_(": "))]),Object.keys(e(z)).length>0?(i(),N(de,{key:0,density:"compact"},{default:D(()=>[a("thead",null,[a("tr",null,[c[14]||(c[14]=a("th",{class:"text-center"},"Элемент",-1)),a("th",gs,[c[13]||(c[13]=_("Диапазон, мг/л ")),r(fe,{location:"bottom","max-width":"400","open-on-click":"","open-on-hover":""},{activator:D(({props:$})=>[r(Z,me({name:"mdi-help-circle-outline",size:"18",class:"mb-n1"},$),null,16)]),default:D(()=>[c[12]||(c[12]=_(" Левое значение в диапазоне концентрации элемента — это концентрация сразу после подмены воды. Правое значение — это концентрация непосредственно перед подменой. Диапазон показывает, как изменяется концентрация элемента в период между подменами. "))]),_:1})])])]),a("tbody",null,[(i(!0),d(R,null,L(e(z),($,O)=>(i(),d("tr",{key:O},[a("td",hs,u(O),1),a("td",ys,u(("format"in F?F.format:e(T))($[0]))+" — "+u(("format"in F?F.format:e(T))($[1])),1)]))),128))]),e(H)&&e(v)?(i(),d("tfoot",bs,[a("tr",null,[c[15]||(c[15]=a("td",{class:"text-center"},"Ca/Mg",-1)),a("td",Vs,u(("format"in F?F.format:e(T))(e(H)))+" — "+u(("format"in F?F.format:e(T))(e(v))),1)]),a("tr",null,[c[16]||(c[16]=a("td",{class:"text-center"},"dGh",-1)),a("td",Ds,u(("format"in F?F.format:e(T))(e(I)))+" — "+u(("format"in F?F.format:e(T))(e(C))),1)])])):E("",!0)]),_:1})):E("",!0),r(se,{modelValue:e(m),"onUpdate:modelValue":c[1]||(c[1]=$=>M(m)?m.value=$:null),button:"",class:"my-10"},{default:D(()=>c[17]||(c[17]=[_(" Динамика ")])),_:1},8,["modelValue"]),r(J,null,{default:D(()=>[e(m)?(i(),d("div",vs,[r(oe,{modelValue:e(V),"onUpdate:modelValue":c[2]||(c[2]=$=>M(V)?V.value=$:null),items:F.dosing.ionList,variant:"outlined",label:"Выберите элемент"},null,8,["modelValue","items"]),a("div",{style:Oe(e(o)?"height: 400px;":"height: 250px;"),class:"mb-4"},[r(ae,{data:e(p),options:A,class:"line-chart"},null,8,["data"])],4),r(B,{modelValue:e(f),"onUpdate:modelValue":c[3]||(c[3]=$=>M(f)?f.value=$:null),label:"Концентрация в подменной воде",suffix:"мг/л","hide-details":"auto"},null,8,["modelValue"]),r(B,{modelValue:e(n),"onUpdate:modelValue":c[4]||(c[4]=$=>M(n)?n.value=$:null),label:"В аквариуме сейчас",suffix:"мг/л","hide-details":"auto"},null,8,["modelValue"]),r(B,{modelValue:e(k),"onUpdate:modelValue":c[5]||(c[5]=$=>M(k)?k.value=$:null),label:"Потребление в день",suffix:"мг/л","hide-details":"auto"},null,8,["modelValue"])])):E("",!0)]),_:1})])):E("",!0)]),_:1})]),_:1}),r(ot,null,{default:D(()=>[r(K,{color:"primary",onClick:c[6]||(c[6]=$=>s.value=!1)},{default:D(()=>[_(u(e(t)("buttons.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});class Ts{constructor(t,o,l,h){x(this,"doses");x(this,"fertilizersRegime");x(this,"daysTotal");x(this,"tank");this.doses=t,this.fertilizersRegime=o,this.daysTotal=l,this.tank=h}get isDoses(){return this.doses.length>0}get waterChangeDecimal(){return this.tank.waterChangeVolume/this.tank.volume}get waterChangePercent(){return this.tank.waterChangeVolume/this.tank.volume*100}get concentration(){const t={};return this.doses.forEach(o=>{ve(o.fertilizer.concentration).forEach(([l,h])=>{l in t||(t[l]={concentration:0,concentrationDay:0,concentrationWaterChange:0,concentrationTotal:0});let s=o.amount*h/this.tank.volume,b=o.amountDay*h/this.tank.volume,m=this.tank.waterChangeVolume?o.amountWaterChange*h/this.tank.waterChangeVolume:0,V=s;this.fertilizersRegime===S.ONCE_A_WEEK&&(m=s*this.waterChangeDecimal),this.fertilizersRegime===S.MIX&&(V=m*this.waterChangeDecimal+s),o.fertilizer.isLiquid||(s*=G,b*=G,m*=G,V*=G),t[l].concentration+=s,t[l].concentrationDay+=b,t[l].concentrationTotal+=V,t[l].concentrationWaterChange+=m})}),t}get ionList(){return re(this.concentration)}get concentrationSorted(){const t=[];return Object.entries(this.concentration).forEach(([o,l])=>{t.push([o,{...l}])}),t.sort((o,l)=>l[1].concentrationTotal-o[1].concentrationTotal),t}get concentrationTotal(){return Object.fromEntries(Object.entries(this.concentration).map(([t,o])=>[t,o.concentrationTotal]))}countIonDynamic(t,o=0,l=0,h=0){const s=[];let b=o;if(t in this.concentration)return re([...Array(this.daysTotal*15)]).forEach(m=>{+m>0&&+m%this.daysTotal===0&&(b=b*(1-this.waterChangeDecimal)+l*this.waterChangeDecimal),this.fertilizersRegime===S.EVERY_DAY?b+=this.concentration[t].concentrationDay:this.fertilizersRegime===S.ONCE_A_WEEK?+m%this.daysTotal===0&&(b+=this.concentration[t].concentrationWaterChange):this.fertilizersRegime===S.MIX&&(+m%this.daysTotal===0&&(b+=this.concentration[t].concentrationWaterChange*this.waterChangeDecimal),b+=this.concentration[t].concentrationDay),b-=h,b<0&&(b=0),s.push(b)}),s}countBalancedIons(){const t={};return["NO3","PO4","K","Ca","Mg","Na","SO4","Cl"].forEach(l=>{const h=this.countIonDynamic(l);if(h){const s=h.slice(-1*this.daysTotal);t[l]=[s[0],s[this.daysTotal-1]]}}),t}toJson(){return{doses:this.doses.map(t=>t.toJson()),daysTotal:this.daysTotal,tank:{...this.tank},fertilizersRegime:this.fertilizersRegime}}}const Cs={class:"text-body-2 text-grey-darken-1 mb-8"},ks={key:0,class:"d-flex flex-column flex-md-row align-sm-center"},_s={key:0},wa=Y({name:"DosingPage",__name:"index",setup(W){const{t}=X(),o=ge(),l=ut(),{fertilizerRecipes:h}=dt(),{fertilizers:s}=mt(),{remineralRecipes:b}=ct(),m=te(),V=De(),n=j(!1),f=j(!1),k=l.tankModels.map(C=>C.toJson()),w=U(()=>new Ts(m.doseModels,m.fertilizersRegime,m.daysTotal,m.tank)),g=U(()=>{let C=[];if(v.value){const y=h.map(c=>c.name),q=s.map(c=>c.name),F=b.map(c=>c.name);C=ft.filter(c=>![...y,...q,...F].includes(c.name))}return[...h.map(y=>new ee({fertilizer:y,fertilizerType:Q.fertilizerRecipe,daysTotal:m.daysTotal})),...s.map(y=>new ee({fertilizer:y,fertilizerType:Q.fertilizer,daysTotal:m.daysTotal})),...b.map(y=>new ee({fertilizer:y,fertilizerType:Q.remineralRecipe,daysTotal:m.daysTotal})),...C.map(y=>new ee({fertilizer:y,fertilizerType:Q.fertilizer,daysTotal:m.daysTotal}))]}),A=U(()=>!isNaN(+o.query.schedule));he(()=>{o.query.schedule&&(f.value=!0)});function p(C){if(typeof C=="number"){m.setTank({name:C.toString(),volume:C});return}else if(typeof C=="string"||C===null)return;m.setTank({name:C.name,volume:C.volumeTotal,waterChangeVolume:C.waterChangeVolume})}function z(C){C.length>m.doseModels.length&&typeof[...C].pop()=="string"||m.setDoses(C.map(y=>y.toJson()))}function H(){m.resetDosing()}const v=U({get(){return m.isDefaultFertilizers},set(C){m.setDefaultFertilizers(C),V.show(C?"Фирменные удобрения добавлены в список":"Фирменные удобрения удалены из списка")}}),I=[C=>!!C||"Выберите аквариум"];return Ne({title:"Подбор дозировок удобрений в аквариуме",description:"Здесь вы можете подобрать дозировки всех ваших удобрений с помощью удобной таблицы. Калькулятор сам рассчитает суммарные концентрации всех элементов, поступающих в ваш аквариум. Это упростит подсчет таких элементов, как калий, которые встречаются в разных удобрениях.",keywords:"аквариум, удобрения, дозировки, концентрация"}),(C,y)=>{const q=ke,F=we,c=$t,B=Zt,Z=Ve,se=ms,ae=zs,$=rt;return i(),N(pt,{class:"mb-12"},{default:D(()=>[r(gt,null,{default:D(()=>[r(q,null,{button:D(()=>[r(K,{color:"primary",onClick:H},{default:D(()=>[_(u(e(t)("buttons.reset")),1)]),_:1})]),default:D(()=>[_(u(e(t)("dosing.title"))+" ",1)]),_:1}),r(ht,{cols:"12",md:"8","offset-md":"2"},{default:D(()=>[a("div",Cs,u(e(t)("dosing.doses.description")),1),r($,null,{default:D(()=>[r(je,{ref:"scheduleForm"},{default:D(()=>[r(_e,{modelValue:e(w).tank,"onUpdate:modelValue":[y[0]||(y[0]=O=>e(w).tank=O),p],modelModifiers:{number:!0},items:e(k),"item-title":"name",variant:"underlined",label:e(t)("dosing.tankInputLabel"),hint:e(t)("dosing.tankInputHint"),"persistent-hint":"","hide-selected":"",rules:I,class:"mb-4",disabled:e(A)},null,8,["modelValue","items","label","hint","disabled"]),r(J,null,{default:D(()=>{var O;return[(O=e(w).tank)!=null&&O.volume?(i(),d("div",ks,[r(F,{"model-value":e(m).doseModels,items:e(g),variant:"underlined",label:e(t)("dosing.fertilizersInputLabel"),hint:e(t)("dosing.fertilizersInputHint"),"item-title":"fertilizer.name","persistent-hint":"",multiple:"",chips:"","closable-chips":"",class:"mb-4","onUpdate:modelValue":z},null,8,["model-value","items","label","hint"]),r(be,{modelValue:e(v),"onUpdate:modelValue":y[1]||(y[1]=ze=>M(v)?v.value=ze:null),color:"primary",label:e(t)("dosing.switch"),class:"ml-md-4 flex-shrink-0"},null,8,["modelValue","label"])])):E("",!0)]}),_:1}),e(w).isDoses?(i(),N(c,{key:0,class:"mb-4"})):E("",!0),r(J,null,{default:D(()=>[e(w).isDoses?(i(),d("div",_s,[r(B,{"is-helpful-info":"","is-switchers":"",dosing:e(w)},{default:D(()=>[r(K,{color:"success",class:"mb-3 mb-sm-0",onClick:y[2]||(y[2]=O=>{n.value=!0})},{default:D(()=>y[5]||(y[5]=[_(" Параметры в аквариуме ")])),_:1})]),_:1},8,["dosing"])])):E("",!0)]),_:1}),e(w).isDoses?(i(),d(R,{key:1},[r(Z,{modelValue:e(f),"onUpdate:modelValue":y[3]||(y[3]=O=>M(f)?f.value=O:null),button:"",class:"my-10"},{default:D(()=>y[6]||(y[6]=[_(" Составить расписание ")])),_:1},8,["modelValue"]),r(J,null,{default:D(()=>[e(f)?(i(),N(se,{key:0,dosing:e(w),class:"mt-10"},null,8,["dosing"])):E("",!0)]),_:1})],64)):E("",!0),r(ae,{modelValue:e(n),"onUpdate:modelValue":y[4]||(y[4]=O=>M(n)?n.value=O:null),dosing:e(w)},null,8,["modelValue","dosing"])]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})}}});export{wa as default};
