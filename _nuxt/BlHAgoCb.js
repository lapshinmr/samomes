var Ce=Object.defineProperty;var we=(I,t,l)=>t in I?Ce(I,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):I[t]=l;var N=(I,t,l)=>we(I,typeof t!="symbol"?t+"":t,l);import{_ as ke}from"./BKGzhLFO.js";import{V as re,a as Re,_ as _e}from"./DAF1G55o.js";import{_ as me}from"./BUJFLcPK.js";import{F,A as le,D as te}from"./BoIzNFIF.js";import{f as z,g as he,a as Ee,b as Se}from"./FI_hX0un.js";import{e as Z,k as Q,F as M,c as d,o as i,b as r,i as $,w as D,j as e,A,I as _,a,L as O,h as x,t as u,_ as $e,m as Fe,d as E,M as L,G as ye,H as Me,r as j,E as Ae,z as ue,f as be,C as Ue,N as We,D as Ie,J as fe,n as xe,B as Oe}from"./DFG5sAfX.js";import{u as Ve}from"./CoO_-vj9.js";import{u as ae}from"./BHnfjoVK.js";import{V as ie,a as Ne}from"./Dc-TPRor.js";import{V as pe}from"./6sDFnY8D.js";import{_ as Le}from"./CFZr_si5.js";import{R as q}from"./BRCeRKMw.js";import{V as De}from"./dHx1kRU-.js";import{V as ce}from"./BSh_OlAh.js";import{_ as Te,V as je}from"./B1xm3xRq.js";import{u as Ge}from"./BIXjO7P4.js";import{u as Pe}from"./Dwe_Fv8d.js";import{u as ve}from"./CIqVXe_f.js";import{t as ze,a as de,b as He}from"./BBggtmFf.js";import{a as Y}from"./2eSb8hgA.js";import{V as qe}from"./DCUc0X6q.js";import{V as Be}from"./BbSZofZi.js";import{V as X}from"./b6rgidj0.js";import Je from"./BFP9DFSN.js";import{C as Ke,p as Ye,a as Xe,b as Ze,L as Qe,P as et,c as tt,d as st,e as at}from"./_J6F1iE-.js";import{M as H}from"./BL0FC99F.js";import{V as nt}from"./DrpoVN_c.js";import{a as ot,b as lt,c as it,V as rt}from"./ZmE6DjNu.js";import{V as ge}from"./DC4JJHtf.js";import{_ as ut}from"./BgWpXKpz.js";import{u as dt}from"./25B3_1tw.js";import{u as mt}from"./TA95ghgx.js";import{u as ct}from"./qdqMa2Gg.js";import{u as ft}from"./BFTaGu8H.js";import{F as pt}from"./CFPUExE7.js";import{D as se}from"./CgmFw_iJ.js";import{b as gt,a as ht,V as yt}from"./BrK6A4ac.js";import"./B931MWyl.js";import"./CGotk2uM.js";import"./Bapplkw-.js";import"./BX9MECSf.js";import"./DTX0tUqu.js";import"./BkVHWGhG.js";import"./CVrSEdTP.js";import"./nlrI5vAl.js";import"./CQay1gPF.js";import"./CbQAqJWO.js";import"./BQK4NqOt.js";import"./HIehDx_R.js";/* empty css        */import"./BXpKWP0_.js";import"./DjjMRDDF.js";import"./CYc57goH.js";const bt={class:"d-flex"},Vt={class:"d-flex w-100"},Dt={class:"d-flex align-start"},Tt={class:"d-flex mt-4"},vt={class:"text-subtitle-1 font-weight-medium w-100 pr-2"},zt={style:{position:"relative",top:"3px"}},Ct={class:"d-flex align-start"},wt={class:"d-flex"},kt={class:"font-weight-medium align-self-end w-60 pr-2"},Rt={style:{position:"relative",top:"3px"}},_t={class:"w-40 font-weight-medium"},Et={class:"d-flex w-40"},St=Z({name:"TheFertilizersDosesTable",__name:"TheFertilizerDosesTable",setup(I){const{t}=Q(),{required:l,positive:o}=Ve(),h=[{text:t("dosing.dosesTable.everyDay"),value:!1},{text:t("dosing.dosesTable.total"),value:!0}],s=ae(),b=M({get(){return s.isTotalMode},set(c){s.setTotalMode(c)}}),m=M({get(){return s.daysTotal},set(c){s.setDaysTotal(c)}}),V=M({get(){return s.fertilizersRegime},set(c){s.setFertilizersRegime(c)}}),n=M({get(){return s.tank.waterChangeVolume},set(c){s.setWaterChangeVolume(c)}});return(c,R)=>{const S=me;return i(),d("div",null,[r(Ne,{modelValue:e(V),"onUpdate:modelValue":R[0]||(R[0]=g=>A(V)?V.value=g:null),color:"primary",class:"my-2 ml-n3","hide-details":"auto",inline:c.$vuetify.display.smAndUp},{default:D(()=>[r(ie,{label:e(t)("dosing.dosesTable.regime1"),value:0},null,8,["label"]),r(ie,{label:e(t)("dosing.dosesTable.regime2"),value:1,class:"mt-1 mt-sm-0"},null,8,["label"]),r(ie,{label:e(t)("dosing.dosesTable.regime3"),value:2,class:"mt-1 mt-sm-0"},null,8,["label"])]),_:1},8,["modelValue","inline"]),e(V)===("FertilizersRegime"in c?c.FertilizersRegime:e(F)).EVERY_DAY?(i(),d(_,{key:0},[a("div",bt,[r(re,{modelValue:e(b),"onUpdate:modelValue":R[1]||(R[1]=g=>A(b)?b.value=g:null),items:h,"item-title":"text","item-value":"value",variant:"underlined",class:"w-60 pr-2","hide-details":"auto"},null,8,["modelValue"]),r(S,{modelValue:e(m),"onUpdate:modelValue":R[2]||(R[2]=g=>A(m)?m.value=g:null),"hide-details":"auto",class:"w-40",label:e(t)("dosing.dosesTable.daysTotal"),rules:[e(o)]},null,8,["modelValue","label","rules"])]),(i(!0),d(_,null,O(e(s).doseModels,(g,U)=>(i(),d("div",{key:U,class:"d-flex justify-space-between align-center"},[a("div",Vt,[e(b)?(i(),x(S,{key:0,"model-value":("format"in c?c.format:e(z))(g.amount),label:g.fertilizer.name,suffix:g.fertilizer.isLiquid?e(t)("units.ml"):e(t)("units.g"),"hide-details":"auto","onUpdate:modelValue":p=>e(s).updateAmount(p,U)},null,8,["model-value","label","suffix","onUpdate:modelValue"])):(i(),x(S,{key:1,"model-value":("format"in c?c.format:e(z))(g.amountDay),label:g.fertilizer.name,suffix:g.fertilizer.isLiquid?e(t)("units.ml/d"):e(t)("units.g/d"),"hide-details":"auto","onUpdate:modelValue":p=>e(s).updateAmountDay(p,U)},null,8,["model-value","label","suffix","onUpdate:modelValue"]))])]))),128))],64)):e(V)===("FertilizersRegime"in c?c.FertilizersRegime:e(F)).ONCE_A_WEEK?(i(),d(_,{key:1},[a("div",Dt,[r(S,{modelValue:e(n),"onUpdate:modelValue":R[3]||(R[3]=g=>A(n)?n.value=g:null),label:e(t)("dosing.dosesTable.waterChange"),hint:e(t)("dosing.dosesTable.waterChangeHint"),"persistent-hint":"",class:"pr-2 w-60","validate-on":"eager",rules:[e(l),e(o)]},null,8,["modelValue","label","hint","rules"]),r(S,{modelValue:e(m),"onUpdate:modelValue":R[4]||(R[4]=g=>A(m)?m.value=g:null),"hide-details":"auto",class:"w-40",label:e(t)("dosing.dosesTable.daysTotal"),rules:[e(o)]},null,8,["modelValue","label","rules"])]),a("div",Tt,[a("div",vt,[a("span",zt,u(e(t)("dosing.dosesTable.doseTotal")),1),r(pe,{class:"mt-1"})])]),(i(!0),d(_,null,O(e(s).doseModels,(g,U)=>(i(),d("div",{key:U,class:"d-flex justify-space-between align-center"},[r(S,{"model-value":("format"in c?c.format:e(z))(g.amount),label:g.fertilizer.name,suffix:g.fertilizer.isLiquid?e(t)("units.ml"):e(t)("units.g"),"hide-details":"auto",class:"pr-2",disabled:!e(n),"onUpdate:modelValue":p=>e(s).updateAmount(p,U)},null,8,["model-value","label","suffix","disabled","onUpdate:modelValue"])]))),128))],64)):e(V)===("FertilizersRegime"in c?c.FertilizersRegime:e(F)).MIX?(i(),d(_,{key:2},[a("div",Ct,[r(S,{modelValue:e(n),"onUpdate:modelValue":R[5]||(R[5]=g=>A(n)?n.value=g:null),label:e(t)("dosing.dosesTable.waterChange"),hint:e(t)("dosing.dosesTable.waterChangeHint"),"persistent-hint":"",class:"pr-2 w-60","validate-on":"eager",rules:[e(l),e(o)]},null,8,["modelValue","label","hint","rules"]),r(S,{modelValue:e(m),"onUpdate:modelValue":R[6]||(R[6]=g=>A(m)?m.value=g:null),"hide-details":"auto",label:e(t)("dosing.dosesTable.daysTotal"),class:"w-40",rules:[e(o)]},null,8,["modelValue","label","rules"])]),a("div",wt,[a("div",kt,[a("span",Rt,u(e(t)("dosing.dosesTable.waterChangeTitle")),1),r(pe,{class:"mt-1"})]),a("div",_t,[r(re,{modelValue:e(b),"onUpdate:modelValue":R[7]||(R[7]=g=>A(b)?b.value=g:null),items:h,"item-title":"text","item-value":"value",variant:"underlined","hide-details":"auto"},null,8,["modelValue"])])]),(i(!0),d(_,null,O(e(s).doseModels,(g,U)=>(i(),d("div",{key:U,class:"d-flex justify-space-between align-center"},[r(S,{"model-value":("format"in c?c.format:e(z))(g.amountWaterChange),label:g.fertilizer.name,suffix:g.fertilizer.isLiquid?e(t)("units.ml"):e(t)("units.g"),"hide-details":"auto",class:"pr-2 w-60",disabled:!e(n),"onUpdate:modelValue":p=>e(s).updateAmountWaterChange(p,U)},null,8,["model-value","label","suffix","disabled","onUpdate:modelValue"]),a("div",Et,[e(b)?(i(),x(S,{key:0,"model-value":("format"in c?c.format:e(z))(g.amount),suffix:g.fertilizer.isLiquid?e(t)("units.ml"):e(t)("units.g"),"hide-details":"auto","onUpdate:modelValue":p=>e(s).updateAmount(p,U)},null,8,["model-value","suffix","onUpdate:modelValue"])):(i(),x(S,{key:1,"model-value":("format"in c?c.format:e(z))(g.amountDay),suffix:g.fertilizer.isLiquid?e(t)("units.ml/d"):e(t)("units.g/d"),"hide-details":"auto","onUpdate:modelValue":p=>e(s).updateAmountDay(p,U)},null,8,["model-value","suffix","onUpdate:modelValue"]))])]))),128))],64)):$("",!0)])}}}),$t=$e(St,[["__scopeId","data-v-a4cf41f5"]]),Ft={class:"d-flex flex-column flex-md-row justify-space-between align-md-center mt-2 mb-2"},Mt={class:"pl-0 text-center"},At={class:"text-center"},Ut={class:"text-no-wrap"},Wt={class:"text-center"},It={class:"text-no-wrap"},xt={class:"text-center"},Ot={class:"text-no-wrap"},Nt={class:"text-center"},Lt={class:"text-no-wrap"},jt={class:"text-center"},Gt={class:"text-no-wrap"},Pt={class:"text-center"},Ht={class:"text-no-wrap"},qt={class:"text-center"},Bt={class:"text-no-wrap"},Jt={class:"text-center"},Kt={class:"text-no-wrap"},Yt={key:3,class:"text-center"},Xt={class:"pl-0 text-center"},Zt={key:3,class:"text-center"},Qt=Z({name:"TheElementsTable",__name:"TheDosingElementsTable",props:{dosing:{}},setup(I){const{t}=Q(),l=ae(),o=M({get(){return l.isHardness},set(s){l.setHardness(s)}});function h(s){return s<.01}return(s,b)=>{const m=Le;return i(),d("div",null,[a("div",Ft,[r(De,{modelValue:e(o),"onUpdate:modelValue":b[0]||(b[0]=V=>A(o)?o.value=V:null),color:"primary",label:e(t)("dosing.elementsTable.showGh"),"hide-details":"auto",class:"mt-0 mb-2 mb-sm-0"},null,8,["modelValue","label"]),Fe(s.$slots,"default")]),r(ce,{density:"compact"},{default:D(()=>[a("thead",null,[a("tr",null,[a("th",Mt,u(e(t)("dosing.elementsTable.element")),1),e(l).fertilizersRegime===("FertilizersRegime"in s?s.FertilizersRegime:e(F)).EVERY_DAY?(i(),d(_,{key:0},[a("th",At,[E(u(e(t)("dosing.elementsTable.everyDayDose"))+" ",1),a("span",Ut,u(e(t)("units.mg/l")),1)]),a("th",Wt,[E(u(e(t)("dosing.elementsTable.totalDose"))+", ",1),a("span",It,u(e(t)("units.mg/l")),1)])],64)):$("",!0),e(l).fertilizersRegime===("FertilizersRegime"in s?s.FertilizersRegime:e(F)).ONCE_A_WEEK?(i(),d(_,{key:1},[a("th",xt,[E(u(e(t)("dosing.elementsTable.inWaterChangeDose"))+", ",1),a("span",Ot,u(e(t)("units.mg/l")),1)]),a("th",Nt,[E(u(e(t)("dosing.elementsTable.everyDayDose"))+", ",1),a("span",Lt,u(e(t)("units.mg/l")),1)]),a("th",jt,[E(u(e(t)("dosing.elementsTable.totalDose"))+", ",1),a("span",Gt,u(e(t)("units.mg/l")),1)])],64)):$("",!0),e(l).fertilizersRegime===("FertilizersRegime"in s?s.FertilizersRegime:e(F)).MIX?(i(),d(_,{key:2},[a("th",Pt,[E(u(e(t)("dosing.elementsTable.inWaterChangeDose"))+", ",1),a("span",Ht,u(e(t)("units.mg/l")),1)]),a("th",qt,[E(u(e(t)("dosing.elementsTable.inDayWeekDose"))+", ",1),a("span",Bt,u(e(t)("units.mg/l")),1)]),a("th",Jt,[E(u(e(t)("dosing.elementsTable.totalDose"))+", ",1),a("span",Kt,u(e(t)("units.mg/l")),1)])],64)):$("",!0),e(o)?(i(),d("th",Yt," Gh ")):$("",!0)])]),a("tbody",null,[(i(!0),d(_,null,O(s.dosing.concentrationSorted,([V,n])=>(i(),d("tr",{key:V,class:"caption regular-sm"},[a("td",Xt,u(V),1),e(l).fertilizersRegime===("FertilizersRegime"in s?s.FertilizersRegime:e(F)).EVERY_DAY?(i(),d(_,{key:0},[a("td",{class:L(["text-center text-no-wrap",{"text-caption":h(n.concentrationDay)}])},u(("format"in s?s.format:e(z))(n.concentrationDay)),3),a("td",{class:L(["text-center text-no-wrap",{"text-caption":h(n.concentration)}])},u(("format"in s?s.format:e(z))(n.concentration)),3)],64)):$("",!0),e(l).fertilizersRegime===("FertilizersRegime"in s?s.FertilizersRegime:e(F)).ONCE_A_WEEK?(i(),d(_,{key:1},[a("td",{class:L(["text-center text-no-wrap",{"text-caption":h(n.concentrationWaterChange)}])},u(("format"in s?s.format:e(z))(n.concentrationWaterChange)),3),a("td",{class:L(["text-center text-no-wrap",{"text-caption":h(n.concentrationDay)}])},u(("format"in s?s.format:e(z))(n.concentrationDay)),3),a("td",{class:L(["text-center text-no-wrap",{"text-caption":h(n.concentration)}])},u(("format"in s?s.format:e(z))(n.concentration)),3)],64)):$("",!0),e(l).fertilizersRegime===("FertilizersRegime"in s?s.FertilizersRegime:e(F)).MIX?(i(),d(_,{key:2},[a("td",{class:L(["text-center text-no-wrap",{"text-caption":h(n.concentrationWaterChange)}])},u(("format"in s?s.format:e(z))(n.concentrationWaterChange)),3),a("td",{class:L(["text-center text-no-wrap",{"text-caption":h(n.concentrationDay)}])},u(("format"in s?s.format:e(z))(n.concentrationDay))+" / "+u(("format"in s?s.format:e(z))(n.concentration)),3),a("td",{class:L(["text-center text-no-wrap",{"text-caption":h(n.concentrationTotal)}])},u(("format"in s?s.format:e(z))(n.concentrationTotal)),3)],64)):$("",!0),e(o)?(i(),d("td",Zt,[V in("RemineralRecipe"in s?s.RemineralRecipe:e(q)).GH?(i(),d(_,{key:0},[[("FertilizersRegime"in s?s.FertilizersRegime:e(F)).ONCE_A_WEEK,("FertilizersRegime"in s?s.FertilizersRegime:e(F)).EVERY_DAY].includes(e(l).fertilizersRegime)?(i(),d(_,{key:0},[E(" +"+u(("format"in s?s.format:e(z))(n.concentration/("RemineralRecipe"in s?s.RemineralRecipe:e(q)).GH[V])),1)],64)):$("",!0),("FertilizersRegime"in s?s.FertilizersRegime:e(F)).MIX===e(l).fertilizersRegime?(i(),d(_,{key:1},[E(" +"+u(("format"in s?s.format:e(z))(n.concentrationTotal/("RemineralRecipe"in s?s.RemineralRecipe:e(q)).GH[V])),1)],64)):$("",!0)],64)):$("",!0)])):$("",!0)]))),128))])]),_:1}),r(m,{concentration:s.dosing.concentrationTotal,"is-gh":e(o),class:"mt-8"},null,8,["concentration","is-gh"])])}}});class es{constructor(t){N(this,"dosing");N(this,"startDate");N(this,"waterChangeDay",{date:"",fertilizers:{}});N(this,"days",[]);this.dosing=t}get daysAmountTotal(){const t={};return this.days.forEach(l=>{ze(l.fertilizers).forEach(([o,h])=>{o in t||(t[o]=0),t[o]+=h.amount})}),t}get daysSelectedTotal(){const t={};return this.days.forEach(l=>{de(l.fertilizers).forEach(o=>{o in t||(t[o]=0),l.fertilizers[o].selected&&(t[o]+=1)})}),t}resetWaterChangeDay(){this.waterChangeDay={date:"",fertilizers:{}}}resetDays(){this.days=[]}initWaterChangeDay(){this.resetWaterChangeDay(),this.waterChangeDay.date=this.startDate,this.dosing.doses.forEach(t=>{t.amountWaterChange&&(this.waterChangeDay.fertilizers[t.fertilizer.name]={amount:t.amountWaterChange,status:le.ACTIVE})})}initDays(){this.resetDays();let t=new Date(this.startDate);[...Array(this.dosing.daysTotal)].forEach(()=>{const l=he(t),o={};this.dosing.doses.forEach(h=>{h.amountDay&&(o[h.fertilizer.name]={amount:h.amountDay,status:le.ACTIVE,selected:!0})}),Object.entries(o).length!==0&&this.days.push({date:l,fertilizers:o}),t=new Date(t.setDate(t.getDate()+1))})}updateDays(){let t=new Date(this.startDate);for(const l of this.days){l.date=t.toISOString().split("T")[0];for(const o in l.fertilizers)l.fertilizers[o].status=le.ACTIVE;t=new Date(t.setDate(t.getDate()+1))}}spreadDayAmounts(t){const l=this.dosing.doses.find(o=>o.fertilizer.name===t);l&&this.days.forEach(o=>{l.amountDay&&o.fertilizers[t].selected&&(o.fertilizers[t].amount=z(l.amount/this.daysSelectedTotal[t]))})}resetDaysAmount(t){const l=this.dosing.doses.find(o=>o.fertilizer.name===t);l&&this.days.forEach(o=>{o.fertilizers[t].amount=z(l.amount/this.days.length),o.fertilizers[t].selected=!0})}toJson(){return{dosing:this.dosing.toJson(),startDate:this.startDate,waterChangeDay:this.waterChangeDay,days:this.days}}}const ts={key:0},ss={key:0},as={class:"pl-0 text-center"},ns={class:"d-flex flex-column"},os={style:{"text-transform":"capitalize"}},ls={key:0,class:"d-flex justify-center align-center"},is={style:{width:"50px"}},rs={key:0,class:"d-flex flex-column align-center"},us={class:"font-weight-medium"},ds=["onClick"],ms={class:"d-flex mt-10"},cs=Z({name:"TheScheduleDoseTable",__name:"TheScheduleDoseTable",props:{dosing:{}},setup(I){const{t}=Q(),l=ye(),o=Me(),{appRoutes:h}=Ge(),s=Pe(),b=ve(),m=I,V=j(),n=Ae(new es(m.dosing)),c=M(()=>!isNaN(V.value));ue(()=>m.dosing,()=>{n.dosing=m.dosing,n.startDate&&(n.initWaterChangeDay(),n.initDays())}),be(()=>{if(V.value=+l.query.schedule,isNaN(V.value))n.startDate=he(new Date),n.initWaterChangeDay(),n.initDays();else{const p=JSON.parse(JSON.stringify(s.schedules[V.value]));p&&(n.startDate=p.startDate,n.waterChangeDay=p.waterChangeDay,n.days=p.days)}});function R(p){p&&(n.startDate=p,n.initWaterChangeDay(),n.days.length>0?n.updateDays():n.initDays())}async function S(){c.value?s.editSchedule(V.value,n.toJson()):s.saveSchedule(n.toJson()),await o.push(h.value.schedules.path)}function g(p,C){C.selected||(C.amount=0),n.spreadDayAmounts(p)}async function U(){s.removeSchedule(V.value),b.show("Расписание удалено"),await o.push(h.value.schedules.path)}return(p,C)=>{const B=me;return i(),d("div",null,[r(qe,{"model-value":e(n).startDate,type:"date",label:"Выберите дату подмены",class:"mb-4","onUpdate:modelValue":R},null,8,["model-value"]),r(Y,null,{default:D(()=>[e(n).startDate?(i(),d("div",ts,[r(ce,{"fixed-footer":""},{default:D(()=>[a("thead",null,[a("tr",null,[C[1]||(C[1]=a("th",{class:"text-center pl-0"}," Дни ",-1)),(i(!0),d(_,null,O(e(n).dosing.doses,v=>(i(),d("th",{key:v.fertilizer.name,class:"text-center"},u(v.fertilizer.name),1))),128))])]),a("tbody",null,[e(n).dosing.fertilizersRegime===("FertilizersRegime"in p?p.FertilizersRegime:e(F)).ONCE_A_WEEK||e(n).dosing.fertilizersRegime===("FertilizersRegime"in p?p.FertilizersRegime:e(F)).MIX?(i(),d("tr",ss,[C[2]||(C[2]=a("td",{class:"pl-0 text-center"}," Подмена ",-1)),(i(!0),d(_,null,O(e(n).dosing.doses,v=>{var W;return i(),d("td",{key:`water_change_${v.fertilizer.name}`,class:"text-center"},u(((W=e(n).waterChangeDay.fertilizers[v.fertilizer.name])==null?void 0:W.amount)||"—"),1)}),128))])):$("",!0),e(n).days.length>0?(i(),d(_,{key:1},[(i(!0),d(_,null,O(e(n).days,v=>(i(),d("tr",{key:v.date},[a("td",as,[a("div",ns,[a("span",os,u(("getWeekday"in p?p.getWeekday:e(Ee))(v.date)),1),a("span",null,u(("formatDate"in p?p.formatDate:e(Se))(v.date)),1)])]),(i(!0),d(_,null,O(e(n).dosing.doses,W=>{var k;return i(),d("td",{key:W.fertilizer.name+v,class:"text-center"},[((k=v.fertilizers[W.fertilizer.name])==null?void 0:k.amount)!==void 0?(i(),d("div",ls,[a("div",is,[r(B,{modelValue:v.fertilizers[W.fertilizer.name].amount,"onUpdate:modelValue":T=>v.fertilizers[W.fertilizer.name].amount=T},null,8,["modelValue","onUpdate:modelValue"])]),r(Be,{modelValue:v.fertilizers[W.fertilizer.name].selected,"onUpdate:modelValue":[T=>v.fertilizers[W.fertilizer.name].selected=T,T=>g(W.fertilizer.name,v.fertilizers[W.fertilizer.name])],color:"primary",dense:"","hide-details":"auto",class:"mt-0 ml-1",style:{display:"inline-block"}},null,8,["modelValue","onUpdate:modelValue"])])):(i(),d(_,{key:1},[E(" — ")],64))])}),128))]))),128)),a("tr",null,[C[4]||(C[4]=a("td",{class:"font-weight-medium"}," Total ",-1)),(i(!0),d(_,null,O(e(n).dosing.doses,v=>(i(),d("td",{key:v.fertilizer.name,class:"text-center"},[e(n).daysAmountTotal[v.fertilizer.name]?(i(),d("div",rs,[a("div",null,[a("span",{class:L({"text-warning":("format"in p?p.format:e(z))(e(n).daysAmountTotal[v.fertilizer.name])!==("format"in p?p.format:e(z))(v.amount)})},u(("format"in p?p.format:e(z))(e(n).daysAmountTotal[v.fertilizer.name])),3),C[3]||(C[3]=E(" / ")),a("span",us,u(("format"in p?p.format:e(z))(v.amount)),1)]),a("div",{class:"text-blue cursor-pointer",onClick:W=>e(n).resetDaysAmount(v.fertilizer.name)}," Сбросить ",8,ds)])):(i(),d(_,{key:1},[E(" — ")],64))]))),128))])],64)):$("",!0)])]),_:1}),a("div",ms,[e(c)?(i(),x(X,{key:0,color:"error",onClick:U},{default:D(()=>[E(u(e(t)("buttons.remove")),1)]),_:1})):$("",!0),r(X,{class:"ml-auto mr-1 mr-sm-2 ml-sm-auto",onClick:C[0]||(C[0]=v=>e(o).push(e(h).schedules.path))},{default:D(()=>[E(u(e(t)("buttons.cancel")),1)]),_:1}),r(X,{color:"primary",onClick:S},{default:D(()=>[E(u(e(t)("buttons.save")),1)]),_:1})])])):$("",!0)]),_:1})])}}}),fs=Z({__name:"LineChart",props:{data:{},options:{}},setup(I){return Ke.register(Ye,Xe,Ze,Qe,et,tt,st),(t,l)=>(i(),x(e(at),{id:"my-chart-id",options:t.options,data:t.data},null,8,["options","data"]))}}),ps={key:0},gs={class:"mb-4 text-body-2"},hs={class:"text-center"},ys={class:"text-center"},bs={class:"text-center"},Vs={class:"text-center"},Ds={class:"text-center"},Ts={class:"text-center"},vs={key:0},zs=Z({name:"TheDynamicsPopup",__name:"TheDynamicsPopup",props:Ue({dosing:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:["update:modelValue"],setup(I){const{t}=Q(),{mdAndUp:l}=We(),{positive:o}=Ve(),h=ae(),s=Ie(I,"modelValue"),b=I,m=j(!1),V=j(),n=j(),c=j(),R=j(),S=j([]),g={NO3:"#D81B60",PO4:"#1E88E5",K:"#78909C"},U={maintainAspectRatio:!1,responsive:!0},p=M(()=>({labels:Object.keys([...Array(b.dosing.daysTotal*15)]),datasets:[{label:V.value,fill:!1,borderColor:g[V.value],data:S.value}]})),C=M(()=>b.dosing.countBalancedIons()),B=M(()=>{let y=0,f=0;return He(C.value).forEach(([P,K])=>{y+=P,f+=K}),[y,f]}),v=M(()=>"Ca"in C.value&&"Mg"in C.value?C.value.Ca[0]/C.value.Mg[0]:null),W=M(()=>"Ca"in C.value&&"Mg"in C.value?C.value.Ca[1]/C.value.Mg[1]:null),k=M(()=>q.countCaGh(C.value.Ca[0],1/H,1)+q.countMgGh(C.value.Mg[0],1/H,1)),T=M(()=>q.countCaGh(C.value.Ca[1],1/H,1)+q.countMgGh(C.value.Mg[1],1/H,1)),G=M({get(){return h.tank.waterChangeVolume},set(y){h.setWaterChangeVolume(y)}});ue(V,()=>{n.value=0,c.value=0,R.value=0}),ue([V,n,c,R,()=>b.dosing],()=>{S.value=b.dosing.countIonDynamic(V.value,n.value,c.value,R.value)});function J(){return Math.ceil(Math.log(.05)/Math.log(1-b.dosing.waterChangeDecimal))}return(y,f)=>{const P=me,K=Je,ne=Te,oe=fs;return i(),x(nt,{modelValue:s.value,"onUpdate:modelValue":f[7]||(f[7]=w=>s.value=w),"max-width":"700"},{default:D(()=>[r(rt,null,{default:D(()=>[r(ot,null,{default:D(()=>f[8]||(f[8]=[E(" Параметры в аквариуме ")])),_:1}),r(lt,null,{default:D(()=>[r(P,{modelValue:e(G),"onUpdate:modelValue":f[0]||(f[0]=w=>A(G)?G.value=w:null),label:e(t)("dosing.dosesTable.waterChange"),hint:e(t)("dosing.dosesTable.waterChangeHint"),"persistent-hint":"",class:"pr-2 w-60 mb-4","validate-on":"eager",rules:[e(o)]},null,8,["modelValue","label","hint","rules"]),r(Y,null,{default:D(()=>[e(G)?(i(),d("div",ps,[a("div",gs,[E(" При заданном режиме подмен ("+u(("format"in y?y.format:e(z))(y.dosing.waterChangePercent,3))+"% объёма каждые "+u(y.dosing.daysTotal)+" д) и выбранных дозировках удобрений равновесные параметры будут достигнуты через "+u(J())+" подмен ("+u(y.dosing.daysTotal*(J()-1))+" д) и будут следующими ",1),r(ge,{location:"bottom","max-width":"400","open-on-click":"","open-on-hover":""},{activator:D(({props:w})=>[r(K,fe({name:"mdi-help-circle-outline",size:"18",class:"mb-n1"},w),null,16)]),default:D(()=>[f[9]||(f[9]=a("p",{class:"mb-2"}," Данные концентрации в аквариуме рассчитаны с допущением, что в аквариуме нет поглотителей. И если для таких элементов, как калий, кальций, магний, такой расчет является довольно точным, то для фосфата и нитрата данные значения будут сильно завышенными. Тем не менее даже для фосфата и нитрата таким образом мы можем получить верхний диапазон значений, чтобы исключить передозировку этих элементов в том случае, если растения по каким-то причинам перестали расти. ",-1)),f[10]||(f[10]=a("p",null," Если вы хотите понять, как будут изменяться концентрации с учетом потребления элементов, то можете воспользоваться расположенной ниже секцией «Динамика». ",-1))]),_:1}),f[11]||(f[11]=E(": "))]),Object.keys(e(C)).length>0?(i(),x(ce,{key:0,density:"compact"},{default:D(()=>[a("thead",null,[a("tr",null,[f[14]||(f[14]=a("th",{class:"text-center"},"Элемент",-1)),a("th",hs,[f[13]||(f[13]=E("Диапазон, мг/л ")),r(ge,{location:"bottom","max-width":"400","open-on-click":"","open-on-hover":""},{activator:D(({props:w})=>[r(K,fe({name:"mdi-help-circle-outline",size:"18",class:"mb-n1"},w),null,16)]),default:D(()=>[f[12]||(f[12]=E(" Левое значение в диапазоне концентрации элемента — это концентрация сразу после подмены воды. Правое значение — это концентрация непосредственно перед подменой. Диапазон показывает, как изменяется концентрация элемента в период между подменами. "))]),_:1})])])]),a("tbody",null,[(i(!0),d(_,null,O(e(C),(w,ee)=>(i(),d("tr",{key:ee},[a("td",ys,u(ee),1),a("td",bs,u(("format"in y?y.format:e(z))(w[0]))+" — "+u(("format"in y?y.format:e(z))(w[1])),1)]))),128))]),a("tfoot",null,[e(v)&&e(W)?(i(),d(_,{key:0},[a("tr",null,[f[15]||(f[15]=a("td",{class:"text-center"},"Ca/Mg",-1)),a("td",Vs,u(("format"in y?y.format:e(z))(e(v)))+" — "+u(("format"in y?y.format:e(z))(e(W))),1)]),a("tr",null,[f[16]||(f[16]=a("td",{class:"text-center"},"dGh",-1)),a("td",Ds,u(("format"in y?y.format:e(z))(e(k)))+" — "+u(("format"in y?y.format:e(z))(e(T))),1)])],64)):$("",!0),a("tr",null,[f[17]||(f[17]=a("td",{class:"text-center"},"TDS",-1)),a("td",Ts,u(("format"in y?y.format:e(z))(e(B)[0]))+" — "+u(("format"in y?y.format:e(z))(e(B)[1])),1)])])]),_:1})):$("",!0),r(ne,{modelValue:e(m),"onUpdate:modelValue":f[1]||(f[1]=w=>A(m)?m.value=w:null),button:"",class:"my-10"},{default:D(()=>f[18]||(f[18]=[E(" Динамика ")])),_:1},8,["modelValue"]),r(Y,null,{default:D(()=>[e(m)?(i(),d("div",vs,[r(re,{modelValue:e(V),"onUpdate:modelValue":f[2]||(f[2]=w=>A(V)?V.value=w:null),items:y.dosing.ionList,variant:"outlined",label:"Выберите элемент"},null,8,["modelValue","items"]),a("div",{style:xe(e(l)?"height: 400px;":"height: 250px;"),class:"mb-4"},[r(oe,{data:e(p),options:U,class:"line-chart"},null,8,["data"])],4),r(P,{modelValue:e(c),"onUpdate:modelValue":f[3]||(f[3]=w=>A(c)?c.value=w:null),label:"Концентрация в подменной воде",suffix:"мг/л","hide-details":"auto"},null,8,["modelValue"]),r(P,{modelValue:e(n),"onUpdate:modelValue":f[4]||(f[4]=w=>A(n)?n.value=w:null),label:"В аквариуме сейчас",suffix:"мг/л","hide-details":"auto"},null,8,["modelValue"]),r(P,{modelValue:e(R),"onUpdate:modelValue":f[5]||(f[5]=w=>A(R)?R.value=w:null),label:"Потребление в день",suffix:"мг/л","hide-details":"auto"},null,8,["modelValue"])])):$("",!0)]),_:1})])):$("",!0)]),_:1})]),_:1}),r(it,null,{default:D(()=>[r(X,{color:"primary",onClick:f[6]||(f[6]=w=>s.value=!1)},{default:D(()=>[E(u(e(t)("buttons.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});class Cs{constructor(t,l,o,h){N(this,"doses");N(this,"fertilizersRegime");N(this,"daysTotal");N(this,"tank");this.doses=t,this.fertilizersRegime=l,this.daysTotal=o,this.tank=h}get isDoses(){return this.doses.length>0}get waterChangeDecimal(){return this.tank.waterChangeVolume/this.tank.volume}get waterChangePercent(){return this.tank.waterChangeVolume/this.tank.volume*100}get concentration(){const t={};return this.doses.forEach(l=>{ze(l.fertilizer.concentration).forEach(([o,h])=>{o in t||(t[o]={concentration:0,concentrationDay:0,concentrationWaterChange:0,concentrationTotal:0});let s=l.amount*h/this.tank.volume,b=l.amountDay*h/this.tank.volume,m=this.tank.waterChangeVolume?l.amountWaterChange*h/this.tank.waterChangeVolume:0,V=s;this.fertilizersRegime===F.ONCE_A_WEEK&&(m=s/this.waterChangeDecimal),this.fertilizersRegime===F.MIX&&(V=m*this.waterChangeDecimal+s),l.fertilizer.isLiquid||(s*=H,b*=H,m*=H,V*=H),t[o].concentration+=s,t[o].concentrationDay+=b,t[o].concentrationTotal+=V,t[o].concentrationWaterChange+=m})}),t}get ionList(){return de(this.concentration)}get concentrationSorted(){const t=[];return Object.entries(this.concentration).forEach(([l,o])=>{t.push([l,{...o}])}),t.sort((l,o)=>o[1].concentrationTotal-l[1].concentrationTotal),t}get concentrationTotal(){return Object.fromEntries(Object.entries(this.concentration).map(([t,l])=>[t,l.concentrationTotal]))}countIonDynamic(t,l=0,o=0,h=0){const s=[];let b=l;if(t in this.concentration)return de([...Array(this.daysTotal*15)]).forEach(m=>{+m>0&&+m%this.daysTotal===0&&(b=b*(1-this.waterChangeDecimal)+o*this.waterChangeDecimal),this.fertilizersRegime===F.EVERY_DAY?b+=this.concentration[t].concentrationDay:this.fertilizersRegime===F.ONCE_A_WEEK?+m%this.daysTotal===0&&(b+=this.concentration[t].concentrationWaterChange):this.fertilizersRegime===F.MIX&&(+m%this.daysTotal===0&&(b+=this.concentration[t].concentrationWaterChange*this.waterChangeDecimal),b+=this.concentration[t].concentrationDay),b-=h,b<0&&(b=0),s.push(b)}),s}countBalancedIons(){const t={};return["NO3","PO4","K","Ca","Mg","Na","SO4","Cl"].forEach(o=>{const h=this.countIonDynamic(o);if(h){const s=h.slice(-1*this.daysTotal);t[o]=[s[0],s[this.daysTotal-1]]}}),t}toJson(){return{doses:this.doses.map(t=>t.toJson()),daysTotal:this.daysTotal,tank:{...this.tank},fertilizersRegime:this.fertilizersRegime}}}const ws={class:"text-body-2 text-grey-darken-1 mb-8"},ks={key:0,class:"d-flex flex-column flex-md-row align-sm-center"},Rs={key:0},_a=Z({name:"DosingPage",__name:"index",setup(I){const{t}=Q(),l=ye(),o=dt(),{fertilizerRecipes:h}=mt(),{fertilizers:s}=ct(),{remineralRecipes:b}=ft(),m=ae(),V=ve(),n=j(!1),c=j(!1),R=o.tankModels.map(k=>k.toJson()),S=M(()=>new Cs(m.doseModels,m.fertilizersRegime,m.daysTotal,m.tank)),g=M(()=>{let k=[];if(v.value){const T=h.map(y=>y.name),G=s.map(y=>y.name),J=b.map(y=>y.name);k=pt.filter(y=>![...T,...G,...J].includes(y.name))}return[...h.map(T=>new se({fertilizer:T,fertilizerType:te.fertilizerRecipe,daysTotal:m.daysTotal})),...s.map(T=>new se({fertilizer:T,fertilizerType:te.fertilizer,daysTotal:m.daysTotal})),...b.map(T=>new se({fertilizer:T,fertilizerType:te.remineralRecipe,daysTotal:m.daysTotal})),...k.map(T=>new se({fertilizer:T,fertilizerType:te.fertilizer,daysTotal:m.daysTotal}))]}),U=M(()=>!isNaN(+l.query.schedule));be(()=>{l.query.schedule&&(c.value=!0)});function p(k){if(typeof k=="number"){m.setTank({name:k.toString(),volume:k});return}else if(typeof k=="string"||k===null)return;m.setTank({name:k.name,volume:k.volumeTotal,waterChangeVolume:k.waterChangeVolume})}function C(k){k.length>m.doseModels.length&&typeof[...k].pop()=="string"||m.setDoses(k.map(T=>T.toJson()))}function B(){m.resetDosing()}const v=M({get(){return m.isDefaultFertilizers},set(k){m.setDefaultFertilizers(k),V.show(k?"Фирменные удобрения добавлены в список":"Фирменные удобрения удалены из списка")}}),W=[k=>!!k||"Выберите аквариум"];return Oe({title:t("meta.dosing.title"),description:t("meta.dosing.description"),keywords:t("meta.dosing.keywords")}),(k,T)=>{const G=ke,J=_e,y=$t,f=Qt,P=Te,K=cs,ne=zs,oe=ut;return i(),x(gt,{class:"mb-12"},{default:D(()=>[r(ht,null,{default:D(()=>[r(G,null,{button:D(()=>[r(X,{color:"primary",onClick:B},{default:D(()=>[E(u(e(t)("buttons.reset")),1)]),_:1})]),default:D(()=>[E(u(e(t)("dosing.title"))+" ",1)]),_:1}),r(yt,{cols:"12",md:"8","offset-md":"2"},{default:D(()=>[a("div",ws,u(e(t)("dosing.doses.description")),1),r(oe,null,{default:D(()=>[r(je,{ref:"scheduleForm"},{default:D(()=>[r(Re,{modelValue:e(S).tank,"onUpdate:modelValue":[T[0]||(T[0]=w=>e(S).tank=w),p],modelModifiers:{number:!0},items:e(R),"item-title":"name",variant:"underlined",label:e(t)("dosing.tankInputLabel"),hint:e(t)("dosing.tankInputHint"),"persistent-hint":"","hide-selected":"",rules:W,class:"mb-4",disabled:e(U)},null,8,["modelValue","items","label","hint","disabled"]),r(Y,null,{default:D(()=>{var w;return[(w=e(S).tank)!=null&&w.volume?(i(),d("div",ks,[r(J,{"model-value":e(m).doseModels,items:e(g),variant:"underlined",label:e(t)("dosing.fertilizersInputLabel"),hint:e(t)("dosing.fertilizersInputHint"),"item-title":"fertilizer.name","persistent-hint":"",multiple:"",chips:"","closable-chips":"",class:"mb-4","onUpdate:modelValue":C},null,8,["model-value","items","label","hint"]),r(De,{modelValue:e(v),"onUpdate:modelValue":T[1]||(T[1]=ee=>A(v)?v.value=ee:null),color:"primary",label:e(t)("dosing.switch"),class:"ml-md-4 flex-shrink-0"},null,8,["modelValue","label"])])):$("",!0)]}),_:1}),e(S).isDoses?(i(),x(y,{key:0,class:"mb-4"})):$("",!0),r(Y,null,{default:D(()=>[e(S).isDoses?(i(),d("div",Rs,[r(f,{"is-helpful-info":"","is-switchers":"",dosing:e(S)},{default:D(()=>[r(X,{color:"success",class:"mb-3 mb-sm-0",onClick:T[2]||(T[2]=w=>{n.value=!0})},{default:D(()=>T[5]||(T[5]=[E(" Параметры в аквариуме ")])),_:1})]),_:1},8,["dosing"])])):$("",!0)]),_:1}),e(S).isDoses?(i(),d(_,{key:1},[r(P,{modelValue:e(c),"onUpdate:modelValue":T[3]||(T[3]=w=>A(c)?c.value=w:null),button:"",class:"my-10"},{default:D(()=>T[6]||(T[6]=[E(" Составить расписание ")])),_:1},8,["modelValue"]),r(Y,null,{default:D(()=>[e(c)?(i(),x(K,{key:0,dosing:e(S),class:"mt-10"},null,8,["dosing"])):$("",!0)]),_:1})],64)):$("",!0),r(ne,{modelValue:e(n),"onUpdate:modelValue":T[4]||(T[4]=w=>A(n)?n.value=w:null),dosing:e(S)},null,8,["modelValue","dosing"])]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})}}});export{_a as default};
