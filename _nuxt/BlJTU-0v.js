var _e=Object.defineProperty;var Ce=(U,t,l)=>t in U?_e(U,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):U[t]=l;var L=(U,t,l)=>Ce(U,typeof t!="symbol"?t+"":t,l);import{_ as we}from"./BennhIYQ.js";import{V as re,a as ke,_ as Re}from"./D0Eyi-NH.js";import{_ as me}from"./DFy-W6Nl.js";import{F as S,A as le,D as te}from"./BoIzNFIF.js";import{f as T,g as he,a as Ee,b as $e}from"./DHChNhVW.js";import{e as Z,k as Q,E as F,c as u,o as r,b as d,i as $,w as D,j as e,z as M,H as k,a,K as O,h as P,t as o,_ as Se,l as Fe,d as R,L as j,F as ye,G as Me,r as G,D as Ae,y as de,f as be,B as We,M as Ue,C as Ie,I as fe,n as xe,A as Pe}from"./C4AY6iDY.js";import{u as De}from"./Cku8uNeL.js";import{u as ae}from"./DDJqf7YD.js";import{V as ie,a as Oe}from"./CbjFsO0T.js";import{V as pe}from"./CsOvkQMc.js";import{_ as Ne}from"./sb6AQiBr.js";import{R as B}from"./ciCyplrD.js";import{V as Ve}from"./HLwzrep7.js";import{V as ce}from"./C_FTRR8m.js";import{_ as Te,V as Le}from"./DxPFgVMm.js";import{u as je}from"./CJauG_RX.js";import{u as Ge}from"./DpRw7U6r.js";import{u as ve}from"./Ci8V9Md_.js";import{t as ze,a as ue,b as He}from"./BBggtmFf.js";import{a as Y}from"./CusXBXJr.js";import{V as qe}from"./CbywPFrM.js";import{V as Be}from"./lxXI-Ipy.js";import{V as X}from"./_MrG4Qzc.js";import Ke from"./Dd_ptEuo.js";import{C as Je,p as Ye,a as Xe,b as Ze,L as Qe,P as et,c as tt,d as st,e as at}from"./D4R6pQQ5.js";import{M as q}from"./BQGgX5ID.js";import{V as nt}from"./Bwe6WoDM.js";import{a as ot,b as lt,c as it,V as rt}from"./Bf45qiAc.js";import{V as ge}from"./DDO_tocw.js";import{_ as dt}from"./Dc-nFeH9.js";import{u as ut}from"./DknDYpsM.js";import{u as mt}from"./Bht1taiZ.js";import{u as ct}from"./IiSMleoJ.js";import{u as ft}from"./CY94b49y.js";import{F as pt}from"./CFPUExE7.js";import{D as se}from"./Ckubnz2N.js";import{b as gt,a as ht,V as yt}from"./D_ojGsqK.js";import"./B931MWyl.js";import"./CY07sUq5.js";import"./C1PmHpO2.js";import"./D_YM2NF9.js";import"./BJEZURo1.js";import"./DFmCVkFv.js";import"./CEN1ZApb.js";import"./qzx_-4Xp.js";import"./CRWMzYl9.js";import"./C_viBdnf.js";import"./Dpja-O8o.js";import"./85aYgJ7U.js";import"./DTh5aDWK.js";/* empty css        */import"./Ch8e8etN.js";import"./DxcjxDr2.js";import"./D2vPiwbM.js";const bt={class:"d-flex"},Dt={class:"d-flex w-100"},Vt={class:"d-flex align-start"},Tt={class:"d-flex mt-4"},vt={class:"text-subtitle-1 font-weight-medium w-100 pr-2"},zt={style:{position:"relative",top:"3px"}},_t={class:"d-flex align-start"},Ct={class:"d-flex"},wt={class:"font-weight-medium align-self-end w-60 pr-2"},kt={style:{position:"relative",top:"3px"}},Rt={class:"w-40 font-weight-medium"},Et={class:"d-flex w-40"},$t=Z({name:"TheFertilizersDosesTable",__name:"TheFertilizerDosesTable",setup(U){const{t}=Q(),{required:l,positive:i}=De(),h=[{text:t("dosing.dosesTable.everyDay"),value:!1},{text:t("dosing.dosesTable.total"),value:!0}],s=ae(),g=F({get(){return s.isTotalMode},set(n){s.setTotalMode(n)}}),c=F({get(){return s.daysTotal},set(n){s.setDaysTotal(n)}}),V=F({get(){return s.fertilizersRegime},set(n){s.setFertilizersRegime(n)}}),m=F({get(){return s.tank.waterChangeVolume},set(n){s.setWaterChangeVolume(n)}});return(n,C)=>{const E=me;return r(),u("div",null,[d(Oe,{modelValue:e(V),"onUpdate:modelValue":C[0]||(C[0]=p=>M(V)?V.value=p:null),color:"primary",class:"my-2 ml-n3","hide-details":"auto",inline:n.$vuetify.display.smAndUp},{default:D(()=>[d(ie,{label:e(t)("dosing.dosesTable.regime1"),value:0},null,8,["label"]),d(ie,{label:e(t)("dosing.dosesTable.regime2"),value:1,class:"mt-1 mt-sm-0"},null,8,["label"]),d(ie,{label:e(t)("dosing.dosesTable.regime3"),value:2,class:"mt-1 mt-sm-0"},null,8,["label"])]),_:1},8,["modelValue","inline"]),e(V)===("FertilizersRegime"in n?n.FertilizersRegime:e(S)).EVERY_DAY?(r(),u(k,{key:0},[a("div",bt,[d(re,{modelValue:e(g),"onUpdate:modelValue":C[1]||(C[1]=p=>M(g)?g.value=p:null),items:h,"item-title":"text","item-value":"value",variant:"underlined",class:"w-60 pr-2","hide-details":"auto"},null,8,["modelValue"]),d(E,{modelValue:e(c),"onUpdate:modelValue":C[2]||(C[2]=p=>M(c)?c.value=p:null),"hide-details":"auto",class:"w-40",label:e(t)("dosing.dosesTable.daysTotal"),rules:[e(i)]},null,8,["modelValue","label","rules"])]),(r(!0),u(k,null,O(e(s).doseModels,(p,A)=>(r(),u("div",{key:A,class:"d-flex justify-space-between align-center"},[a("div",Dt,[e(g)?(r(),P(E,{key:0,"model-value":("format"in n?n.format:e(T))(p.amount),label:p.fertilizer.name,suffix:p.fertilizer.isLiquid?e(t)("units.ml"):e(t)("units.g"),"hide-details":"auto","onUpdate:modelValue":W=>e(s).updateAmount(W,A)},null,8,["model-value","label","suffix","onUpdate:modelValue"])):(r(),P(E,{key:1,"model-value":("format"in n?n.format:e(T))(p.amountDay),label:p.fertilizer.name,suffix:p.fertilizer.isLiquid?e(t)("units.ml/d"):e(t)("units.g/d"),"hide-details":"auto","onUpdate:modelValue":W=>e(s).updateAmountDay(W,A)},null,8,["model-value","label","suffix","onUpdate:modelValue"]))])]))),128))],64)):e(V)===("FertilizersRegime"in n?n.FertilizersRegime:e(S)).ONCE_A_WEEK?(r(),u(k,{key:1},[a("div",Vt,[d(E,{modelValue:e(m),"onUpdate:modelValue":C[3]||(C[3]=p=>M(m)?m.value=p:null),label:e(t)("dosing.dosesTable.waterChange"),hint:e(t)("dosing.dosesTable.waterChangeHint"),"persistent-hint":"",class:"pr-2 w-60","validate-on":"eager",rules:[e(l),e(i)]},null,8,["modelValue","label","hint","rules"]),d(E,{modelValue:e(c),"onUpdate:modelValue":C[4]||(C[4]=p=>M(c)?c.value=p:null),"hide-details":"auto",class:"w-40",label:e(t)("dosing.dosesTable.daysTotal"),rules:[e(i)]},null,8,["modelValue","label","rules"])]),a("div",Tt,[a("div",vt,[a("span",zt,o(e(t)("dosing.dosesTable.doseTotal")),1),d(pe,{class:"mt-1"})])]),(r(!0),u(k,null,O(e(s).doseModels,(p,A)=>(r(),u("div",{key:A,class:"d-flex justify-space-between align-center"},[d(E,{"model-value":("format"in n?n.format:e(T))(p.amount),label:p.fertilizer.name,suffix:p.fertilizer.isLiquid?e(t)("units.ml"):e(t)("units.g"),"hide-details":"auto",class:"pr-2",disabled:!e(m),"onUpdate:modelValue":W=>e(s).updateAmount(W,A)},null,8,["model-value","label","suffix","disabled","onUpdate:modelValue"])]))),128))],64)):e(V)===("FertilizersRegime"in n?n.FertilizersRegime:e(S)).MIX?(r(),u(k,{key:2},[a("div",_t,[d(E,{modelValue:e(m),"onUpdate:modelValue":C[5]||(C[5]=p=>M(m)?m.value=p:null),label:e(t)("dosing.dosesTable.waterChange"),hint:e(t)("dosing.dosesTable.waterChangeHint"),"persistent-hint":"",class:"pr-2 w-60","validate-on":"eager",rules:[e(l),e(i)]},null,8,["modelValue","label","hint","rules"]),d(E,{modelValue:e(c),"onUpdate:modelValue":C[6]||(C[6]=p=>M(c)?c.value=p:null),"hide-details":"auto",label:e(t)("dosing.dosesTable.daysTotal"),class:"w-40",rules:[e(i)]},null,8,["modelValue","label","rules"])]),a("div",Ct,[a("div",wt,[a("span",kt,o(e(t)("dosing.dosesTable.waterChangeTitle")),1),d(pe,{class:"mt-1"})]),a("div",Rt,[d(re,{modelValue:e(g),"onUpdate:modelValue":C[7]||(C[7]=p=>M(g)?g.value=p:null),items:h,"item-title":"text","item-value":"value",variant:"underlined","hide-details":"auto"},null,8,["modelValue"])])]),(r(!0),u(k,null,O(e(s).doseModels,(p,A)=>(r(),u("div",{key:A,class:"d-flex justify-space-between align-center"},[d(E,{"model-value":("format"in n?n.format:e(T))(p.amountWaterChange),label:p.fertilizer.name,suffix:p.fertilizer.isLiquid?e(t)("units.ml"):e(t)("units.g"),"hide-details":"auto",class:"pr-2 w-60",disabled:!e(m),"onUpdate:modelValue":W=>e(s).updateAmountWaterChange(W,A)},null,8,["model-value","label","suffix","disabled","onUpdate:modelValue"]),a("div",Et,[e(g)?(r(),P(E,{key:0,"model-value":("format"in n?n.format:e(T))(p.amount),suffix:p.fertilizer.isLiquid?e(t)("units.ml"):e(t)("units.g"),"hide-details":"auto","onUpdate:modelValue":W=>e(s).updateAmount(W,A)},null,8,["model-value","suffix","onUpdate:modelValue"])):(r(),P(E,{key:1,"model-value":("format"in n?n.format:e(T))(p.amountDay),suffix:p.fertilizer.isLiquid?e(t)("units.ml/d"):e(t)("units.g/d"),"hide-details":"auto","onUpdate:modelValue":W=>e(s).updateAmountDay(W,A)},null,8,["model-value","suffix","onUpdate:modelValue"]))])]))),128))],64)):$("",!0)])}}}),St=Se($t,[["__scopeId","data-v-a4cf41f5"]]),Ft={class:"d-flex flex-column flex-md-row justify-space-between align-md-center mt-2 mb-2"},Mt={class:"pl-0 text-center"},At={class:"text-center"},Wt={class:"text-no-wrap"},Ut={class:"text-center"},It={class:"text-no-wrap"},xt={class:"text-center"},Pt={class:"text-no-wrap"},Ot={class:"text-center"},Nt={class:"text-no-wrap"},Lt={class:"text-center"},jt={class:"text-no-wrap"},Gt={class:"text-center"},Ht={class:"text-no-wrap"},qt={class:"text-center"},Bt={class:"text-no-wrap"},Kt={class:"text-center"},Jt={class:"text-no-wrap"},Yt={key:3,class:"text-center"},Xt={class:"pl-0 text-center"},Zt={key:3,class:"text-center"},Qt=Z({name:"TheElementsTable",__name:"TheDosingElementsTable",props:{dosing:{}},setup(U){const{t}=Q(),l=ae(),i=F({get(){return l.isHardness},set(s){l.setHardness(s)}});function h(s){return s<.01}return(s,g)=>{const c=Ne;return r(),u("div",null,[a("div",Ft,[d(Ve,{modelValue:e(i),"onUpdate:modelValue":g[0]||(g[0]=V=>M(i)?i.value=V:null),color:"primary",label:e(t)("dosing.elementsTable.showGh"),"hide-details":"auto",class:"mt-0 mb-2 mb-sm-0"},null,8,["modelValue","label"]),Fe(s.$slots,"default")]),d(ce,{density:"compact"},{default:D(()=>[a("thead",null,[a("tr",null,[a("th",Mt,o(e(t)("dosing.elementsTable.element")),1),e(l).fertilizersRegime===("FertilizersRegime"in s?s.FertilizersRegime:e(S)).EVERY_DAY?(r(),u(k,{key:0},[a("th",At,[R(o(e(t)("dosing.elementsTable.everyDayDose"))+", ",1),a("span",Wt,o(e(t)("units.mg/l")),1)]),a("th",Ut,[R(o(e(t)("dosing.elementsTable.totalDose"))+", ",1),a("span",It,o(e(t)("units.mg/l")),1)])],64)):$("",!0),e(l).fertilizersRegime===("FertilizersRegime"in s?s.FertilizersRegime:e(S)).ONCE_A_WEEK?(r(),u(k,{key:1},[a("th",xt,[R(o(e(t)("dosing.elementsTable.inWaterChangeDose"))+", ",1),a("span",Pt,o(e(t)("units.mg/l")),1)]),a("th",Ot,[R(o(e(t)("dosing.elementsTable.everyDayDose"))+", ",1),a("span",Nt,o(e(t)("units.mg/l")),1)]),a("th",Lt,[R(o(e(t)("dosing.elementsTable.totalDose"))+", ",1),a("span",jt,o(e(t)("units.mg/l")),1)])],64)):$("",!0),e(l).fertilizersRegime===("FertilizersRegime"in s?s.FertilizersRegime:e(S)).MIX?(r(),u(k,{key:2},[a("th",Gt,[R(o(e(t)("dosing.elementsTable.inWaterChangeDose"))+", ",1),a("span",Ht,o(e(t)("units.mg/l")),1)]),a("th",qt,[R(o(e(t)("dosing.elementsTable.inDayWeekDose"))+", ",1),a("span",Bt,o(e(t)("units.mg/l")),1)]),a("th",Kt,[R(o(e(t)("dosing.elementsTable.totalDose"))+", ",1),a("span",Jt,o(e(t)("units.mg/l")),1)])],64)):$("",!0),e(i)?(r(),u("th",Yt," Gh ")):$("",!0)])]),a("tbody",null,[(r(!0),u(k,null,O(s.dosing.concentrationSorted,([V,m])=>(r(),u("tr",{key:V,class:"caption regular-sm"},[a("td",Xt,o(V),1),e(l).fertilizersRegime===("FertilizersRegime"in s?s.FertilizersRegime:e(S)).EVERY_DAY?(r(),u(k,{key:0},[a("td",{class:j(["text-center text-no-wrap",{"text-caption":h(m.concentrationDay)}])},o(("format"in s?s.format:e(T))(m.concentrationDay)),3),a("td",{class:j(["text-center text-no-wrap",{"text-caption":h(m.concentration)}])},o(("format"in s?s.format:e(T))(m.concentration)),3)],64)):$("",!0),e(l).fertilizersRegime===("FertilizersRegime"in s?s.FertilizersRegime:e(S)).ONCE_A_WEEK?(r(),u(k,{key:1},[a("td",{class:j(["text-center text-no-wrap",{"text-caption":h(m.concentrationWaterChange)}])},o(("format"in s?s.format:e(T))(m.concentrationWaterChange)),3),a("td",{class:j(["text-center text-no-wrap",{"text-caption":h(m.concentrationDay)}])},o(("format"in s?s.format:e(T))(m.concentrationDay)),3),a("td",{class:j(["text-center text-no-wrap",{"text-caption":h(m.concentration)}])},o(("format"in s?s.format:e(T))(m.concentration)),3)],64)):$("",!0),e(l).fertilizersRegime===("FertilizersRegime"in s?s.FertilizersRegime:e(S)).MIX?(r(),u(k,{key:2},[a("td",{class:j(["text-center text-no-wrap",{"text-caption":h(m.concentrationWaterChange)}])},o(("format"in s?s.format:e(T))(m.concentrationWaterChange)),3),a("td",{class:j(["text-center text-no-wrap",{"text-caption":h(m.concentrationDay)}])},o(("format"in s?s.format:e(T))(m.concentrationDay))+" / "+o(("format"in s?s.format:e(T))(m.concentration)),3),a("td",{class:j(["text-center text-no-wrap",{"text-caption":h(m.concentrationTotal)}])},o(("format"in s?s.format:e(T))(m.concentrationTotal)),3)],64)):$("",!0),e(i)?(r(),u("td",Zt,[V in("RemineralRecipe"in s?s.RemineralRecipe:e(B)).GH?(r(),u(k,{key:0},[[("FertilizersRegime"in s?s.FertilizersRegime:e(S)).ONCE_A_WEEK,("FertilizersRegime"in s?s.FertilizersRegime:e(S)).EVERY_DAY].includes(e(l).fertilizersRegime)?(r(),u(k,{key:0},[R(" +"+o(("format"in s?s.format:e(T))(m.concentration/("RemineralRecipe"in s?s.RemineralRecipe:e(B)).GH[V])),1)],64)):$("",!0),("FertilizersRegime"in s?s.FertilizersRegime:e(S)).MIX===e(l).fertilizersRegime?(r(),u(k,{key:1},[R(" +"+o(("format"in s?s.format:e(T))(m.concentrationTotal/("RemineralRecipe"in s?s.RemineralRecipe:e(B)).GH[V])),1)],64)):$("",!0)],64)):$("",!0)])):$("",!0)]))),128))])]),_:1}),d(c,{concentration:s.dosing.concentrationTotal,"is-gh":e(i),class:"mt-8"},null,8,["concentration","is-gh"])])}}});class es{constructor(t){L(this,"dosing");L(this,"startDate");L(this,"waterChangeDay",{date:"",fertilizers:{}});L(this,"days",[]);this.dosing=t}get daysAmountTotal(){const t={};return this.days.forEach(l=>{ze(l.fertilizers).forEach(([i,h])=>{i in t||(t[i]=0),t[i]+=h.amount})}),t}get daysSelectedTotal(){const t={};return this.days.forEach(l=>{ue(l.fertilizers).forEach(i=>{i in t||(t[i]=0),l.fertilizers[i].selected&&(t[i]+=1)})}),t}resetWaterChangeDay(){this.waterChangeDay={date:"",fertilizers:{}}}resetDays(){this.days=[]}initWaterChangeDay(){this.resetWaterChangeDay(),this.waterChangeDay.date=this.startDate,this.dosing.doses.forEach(t=>{t.amountWaterChange&&(this.waterChangeDay.fertilizers[t.fertilizer.name]={amount:t.amountWaterChange,status:le.ACTIVE})})}initDays(){this.resetDays();let t=new Date(this.startDate);[...Array(this.dosing.daysTotal)].forEach(()=>{const l=he(t),i={};this.dosing.doses.forEach(h=>{h.amountDay&&(i[h.fertilizer.name]={amount:h.amountDay,status:le.ACTIVE,selected:!0})}),Object.entries(i).length!==0&&this.days.push({date:l,fertilizers:i}),t=new Date(t.setDate(t.getDate()+1))})}updateDays(){let t=new Date(this.startDate);for(const l of this.days){l.date=t.toISOString().split("T")[0];for(const i in l.fertilizers)l.fertilizers[i].status=le.ACTIVE;t=new Date(t.setDate(t.getDate()+1))}}spreadDayAmounts(t){const l=this.dosing.doses.find(i=>i.fertilizer.name===t);l&&this.days.forEach(i=>{l.amountDay&&i.fertilizers[t].selected&&(i.fertilizers[t].amount=T(l.amount/this.daysSelectedTotal[t]))})}resetDaysAmount(t){const l=this.dosing.doses.find(i=>i.fertilizer.name===t);l&&this.days.forEach(i=>{i.fertilizers[t].amount=T(l.amount/this.days.length),i.fertilizers[t].selected=!0})}toJson(){return{dosing:this.dosing.toJson(),startDate:this.startDate,waterChangeDay:this.waterChangeDay,days:this.days}}}const ts={key:0},ss={class:"text-center pl-0"},as={key:0},ns={class:"pl-0 text-center"},os={class:"pl-0 text-center"},ls={class:"d-flex flex-column"},is={style:{"text-transform":"capitalize"}},rs={key:0,class:"d-flex justify-center align-center"},ds={style:{width:"50px"}},us={class:"pl-0 text-center font-weight-medium"},ms={key:0,class:"d-flex flex-column align-center"},cs={class:"font-weight-medium"},fs=["onClick"],ps={class:"d-flex mt-10"},gs=Z({name:"TheScheduleDoseTable",__name:"TheScheduleDoseTable",props:{dosing:{}},setup(U){const{t,locale:l}=Q(),i=ye(),h=Me(),{appRoutes:s}=je(),g=Ge(),c=ve(),V=U,m=G(),n=Ae(new es(V.dosing)),C=F(()=>!isNaN(m.value));de(()=>V.dosing,()=>{n.dosing=V.dosing,n.startDate&&(n.initWaterChangeDay(),n.initDays())}),be(()=>{if(m.value=+i.query.schedule,isNaN(m.value))n.startDate=he(new Date),n.initWaterChangeDay(),n.initDays();else{const f=JSON.parse(JSON.stringify(g.schedules[m.value]));f&&(n.startDate=f.startDate,n.waterChangeDay=f.waterChangeDay,n.days=f.days)}});function E(f){f&&(n.startDate=f,n.initWaterChangeDay(),n.days.length>0?n.updateDays():n.initDays())}async function p(){C.value?g.editSchedule(m.value,n.toJson()):g.saveSchedule(n.toJson()),await h.push(s.value.schedules.path)}function A(f,x){x.selected||(x.amount=0),n.spreadDayAmounts(f)}async function W(){g.removeSchedule(m.value),c.show(t("dosing.schedule.scheduleRemoved")),await h.push(s.value.schedules.path)}return(f,x)=>{const N=me;return r(),u("div",null,[d(qe,{"model-value":e(n).startDate,type:"date",label:e(t)("dosing.schedule.chooseDate"),class:"mb-4","onUpdate:modelValue":E},null,8,["model-value","label"]),d(Y,null,{default:D(()=>[e(n).startDate?(r(),u("div",ts,[d(ce,{"fixed-footer":""},{default:D(()=>[a("thead",null,[a("tr",null,[a("th",ss,o(e(t)("dosing.schedule.days")),1),(r(!0),u(k,null,O(e(n).dosing.doses,z=>(r(),u("th",{key:z.fertilizer.name,class:"text-center"},o(z.fertilizer.name),1))),128))])]),a("tbody",null,[e(n).dosing.fertilizersRegime===("FertilizersRegime"in f?f.FertilizersRegime:e(S)).ONCE_A_WEEK||e(n).dosing.fertilizersRegime===("FertilizersRegime"in f?f.FertilizersRegime:e(S)).MIX?(r(),u("tr",as,[a("td",ns,o(e(t)("dosing.schedule.waterChange")),1),(r(!0),u(k,null,O(e(n).dosing.doses,z=>{var y;return r(),u("td",{key:`water_change_${z.fertilizer.name}`,class:"text-center"},o(((y=e(n).waterChangeDay.fertilizers[z.fertilizer.name])==null?void 0:y.amount)||"—"),1)}),128))])):$("",!0),e(n).days.length>0?(r(),u(k,{key:1},[(r(!0),u(k,null,O(e(n).days,z=>(r(),u("tr",{key:z.date},[a("td",os,[a("div",ls,[a("span",is,o(("getWeekday"in f?f.getWeekday:e(Ee))(z.date,e(l))),1),a("span",null,o(("formatDate"in f?f.formatDate:e($e))(z.date,e(l))),1)])]),(r(!0),u(k,null,O(e(n).dosing.doses,y=>{var w;return r(),u("td",{key:y.fertilizer.name+z,class:"text-center"},[((w=z.fertilizers[y.fertilizer.name])==null?void 0:w.amount)!==void 0?(r(),u("div",rs,[a("div",ds,[d(N,{modelValue:z.fertilizers[y.fertilizer.name].amount,"onUpdate:modelValue":I=>z.fertilizers[y.fertilizer.name].amount=I},null,8,["modelValue","onUpdate:modelValue"])]),d(Be,{modelValue:z.fertilizers[y.fertilizer.name].selected,"onUpdate:modelValue":[I=>z.fertilizers[y.fertilizer.name].selected=I,I=>A(y.fertilizer.name,z.fertilizers[y.fertilizer.name])],color:"primary",dense:"","hide-details":"auto",class:"mt-0 ml-1",style:{display:"inline-block"}},null,8,["modelValue","onUpdate:modelValue"])])):(r(),u(k,{key:1},[R(" — ")],64))])}),128))]))),128)),a("tr",null,[a("td",us,o(e(t)("common.total")),1),(r(!0),u(k,null,O(e(n).dosing.doses,z=>(r(),u("td",{key:z.fertilizer.name,class:"text-center"},[e(n).daysAmountTotal[z.fertilizer.name]?(r(),u("div",ms,[a("div",null,[a("span",{class:j({"text-warning":("format"in f?f.format:e(T))(e(n).daysAmountTotal[z.fertilizer.name])!==("format"in f?f.format:e(T))(z.amount)})},o(("format"in f?f.format:e(T))(e(n).daysAmountTotal[z.fertilizer.name])),3),x[1]||(x[1]=R(" / ")),a("span",cs,o(("format"in f?f.format:e(T))(z.amount)),1)]),a("div",{class:"text-blue cursor-pointer",onClick:y=>e(n).resetDaysAmount(z.fertilizer.name)},o(e(t)("buttons.reset")),9,fs)])):(r(),u(k,{key:1},[R(" — ")],64))]))),128))])],64)):$("",!0)])]),_:1}),a("div",ps,[e(C)?(r(),P(X,{key:0,color:"error",onClick:W},{default:D(()=>[R(o(e(t)("buttons.remove")),1)]),_:1})):$("",!0),d(X,{class:"ml-auto mr-1 mr-sm-2 ml-sm-auto",onClick:x[0]||(x[0]=z=>e(h).push(e(s).schedules.path))},{default:D(()=>[R(o(e(t)("buttons.cancel")),1)]),_:1}),d(X,{color:"primary",onClick:p},{default:D(()=>[R(o(e(t)("buttons.save")),1)]),_:1})])])):$("",!0)]),_:1})])}}}),hs=Z({__name:"LineChart",props:{data:{},options:{}},setup(U){return Je.register(Ye,Xe,Ze,Qe,et,tt,st),(t,l)=>(r(),P(e(at),{id:"my-chart-id",options:t.options,data:t.data},null,8,["options","data"]))}}),ys={key:0},bs={class:"mb-4 text-body-2"},Ds={class:"mb-2"},Vs={class:"text-center"},Ts={class:"text-center"},vs={class:"text-center"},zs={class:"text-center"},_s={class:"text-center"},Cs={class:"text-center"},ws={class:"text-center"},ks={key:0},Rs=Z({name:"TheDynamicsPopup",__name:"TheDynamicsPopup",props:We({dosing:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:["update:modelValue"],setup(U){const{t}=Q(),{mdAndUp:l}=Ue(),{positive:i}=De(),h=ae(),s=Ie(U,"modelValue"),g=U,c=G(!1),V=G(),m=G(),n=G(),C=G(),E=G([]),p={NO3:"#D81B60",PO4:"#1E88E5",K:"#78909C"},A={maintainAspectRatio:!1,responsive:!0},W=F(()=>({labels:Object.keys([...Array(g.dosing.daysTotal*15)]),datasets:[{label:V.value,fill:!1,borderColor:p[V.value],data:E.value}]})),f=F(()=>g.dosing.countBalancedIons()),x=F(()=>{let b=0,_=0;return He(f.value).forEach(([H,J])=>{b+=H,_+=J}),[b,_]}),N=F(()=>"Ca"in f.value&&"Mg"in f.value?f.value.Ca[0]/f.value.Mg[0]:null),z=F(()=>"Ca"in f.value&&"Mg"in f.value?f.value.Ca[1]/f.value.Mg[1]:null),y=F(()=>B.countCaGh(f.value.Ca[0],1/q,1)+B.countMgGh(f.value.Mg[0],1/q,1)),w=F(()=>B.countCaGh(f.value.Ca[1],1/q,1)+B.countMgGh(f.value.Mg[1],1/q,1)),I=F({get(){return h.tank.waterChangeVolume},set(b){h.setWaterChangeVolume(b)}});de(V,()=>{m.value=0,n.value=0,C.value=0}),de([V,m,n,C,()=>g.dosing],()=>{E.value=g.dosing.countIonDynamic(V.value,m.value,n.value,C.value)});function K(){return Math.ceil(Math.log(.05)/Math.log(1-g.dosing.waterChangeDecimal))}return(b,_)=>{const H=me,J=Ke,ne=Te,oe=hs;return r(),P(nt,{modelValue:s.value,"onUpdate:modelValue":_[7]||(_[7]=v=>s.value=v),"max-width":"700"},{default:D(()=>[d(rt,null,{default:D(()=>[d(ot,null,{default:D(()=>[R(o(e(t)("dosing.dynamicsPopup.tankParams")),1)]),_:1}),d(lt,null,{default:D(()=>[d(H,{modelValue:e(I),"onUpdate:modelValue":_[0]||(_[0]=v=>M(I)?I.value=v:null),label:e(t)("dosing.dosesTable.waterChange"),hint:e(t)("dosing.dosesTable.waterChangeHint"),"persistent-hint":"",class:"pr-2 w-60 mb-4","validate-on":"eager",rules:[e(i)]},null,8,["modelValue","label","hint","rules"]),d(Y,null,{default:D(()=>[e(I)?(r(),u("div",ys,[a("div",bs,[R(o(e(t)("dosing.dynamicsPopup.description",{waterChangePercent:("format"in b?b.format:e(T))(b.dosing.waterChangePercent,3),daysTotal:b.dosing.daysTotal,balancedWaterChangeNumber:K(),balancedDaysTotal:b.dosing.daysTotal*(K()-1)}))+" ",1),d(ge,{location:"bottom","max-width":"400","open-on-click":"","open-on-hover":""},{activator:D(({props:v})=>[d(J,fe({name:"mdi-help-circle-outline",size:"18",class:"mb-n1"},v),null,16)]),default:D(()=>[a("p",Ds,o(e(t)("dosing.dynamicsPopup.tooltip.text1")),1),a("p",null,o(e(t)("dosing.dynamicsPopup.tooltip.text2")),1)]),_:1}),_[8]||(_[8]=R(": "))]),Object.keys(e(f)).length>0?(r(),P(ce,{key:0,density:"compact"},{default:D(()=>[a("thead",null,[a("tr",null,[a("th",Vs,o(e(t)("dosing.dynamicsPopup.element")),1),a("th",Ts,[R(o(e(t)("dosing.dynamicsPopup.range"))+", "+o(e(t)("units.mg/l"))+" ",1),d(ge,{location:"bottom","max-width":"400","open-on-click":"","open-on-hover":""},{activator:D(({props:v})=>[d(J,fe({name:"mdi-help-circle-outline",size:"18",class:"mb-n1"},v),null,16)]),default:D(()=>[R(" "+o(e(t)("dosing.dynamicsPopup.tableTooltip")),1)]),_:1})])])]),a("tbody",null,[(r(!0),u(k,null,O(e(f),(v,ee)=>(r(),u("tr",{key:ee},[a("td",vs,o(ee),1),a("td",zs,o(("format"in b?b.format:e(T))(v[0]))+" — "+o(("format"in b?b.format:e(T))(v[1])),1)]))),128))]),a("tfoot",null,[e(N)&&e(z)?(r(),u(k,{key:0},[a("tr",null,[_[9]||(_[9]=a("td",{class:"text-center"},"Ca/Mg",-1)),a("td",_s,o(("format"in b?b.format:e(T))(e(N)))+" — "+o(("format"in b?b.format:e(T))(e(z))),1)]),a("tr",null,[_[10]||(_[10]=a("td",{class:"text-center"},"dGh",-1)),a("td",Cs,o(("format"in b?b.format:e(T))(e(y)))+" — "+o(("format"in b?b.format:e(T))(e(w))),1)])],64)):$("",!0),a("tr",null,[_[11]||(_[11]=a("td",{class:"text-center"},"TDS",-1)),a("td",ws,o(("format"in b?b.format:e(T))(e(x)[0]))+" — "+o(("format"in b?b.format:e(T))(e(x)[1])),1)])])]),_:1})):$("",!0),d(ne,{modelValue:e(c),"onUpdate:modelValue":_[1]||(_[1]=v=>M(c)?c.value=v:null),button:"",class:"my-10"},{default:D(()=>[R(o(e(t)("dosing.dynamicsPopup.dynamics")),1)]),_:1},8,["modelValue"]),d(Y,null,{default:D(()=>[e(c)?(r(),u("div",ks,[d(re,{modelValue:e(V),"onUpdate:modelValue":_[2]||(_[2]=v=>M(V)?V.value=v:null),items:b.dosing.ionList,variant:"outlined",label:e(t)("dosing.dynamicsPopup.chooseElement")},null,8,["modelValue","items","label"]),a("div",{style:xe(e(l)?"height: 400px;":"height: 250px;"),class:"mb-4"},[d(oe,{data:e(W),options:A,class:"line-chart"},null,8,["data"])],4),d(H,{modelValue:e(n),"onUpdate:modelValue":_[3]||(_[3]=v=>M(n)?n.value=v:null),label:e(t)("dosing.dynamicsPopup.concInWaterChange"),suffix:e(t)("units.mg/l"),"hide-details":"auto"},null,8,["modelValue","label","suffix"]),d(H,{modelValue:e(m),"onUpdate:modelValue":_[4]||(_[4]=v=>M(m)?m.value=v:null),label:e(t)("dosing.dynamicsPopup.concInTank"),suffix:e(t)("units.mg/l"),"hide-details":"auto"},null,8,["modelValue","label","suffix"]),d(H,{modelValue:e(C),"onUpdate:modelValue":_[5]||(_[5]=v=>M(C)?C.value=v:null),label:e(t)("dosing.dynamicsPopup.concPerDay"),suffix:e(t)("units.mg/l"),"hide-details":"auto"},null,8,["modelValue","label","suffix"])])):$("",!0)]),_:1})])):$("",!0)]),_:1})]),_:1}),d(it,null,{default:D(()=>[d(X,{color:"primary",onClick:_[6]||(_[6]=v=>s.value=!1)},{default:D(()=>[R(o(e(t)("buttons.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});class Es{constructor(t,l,i,h){L(this,"doses");L(this,"fertilizersRegime");L(this,"daysTotal");L(this,"tank");this.doses=t,this.fertilizersRegime=l,this.daysTotal=i,this.tank=h}get isDoses(){return this.doses.length>0}get waterChangeDecimal(){return this.tank.waterChangeVolume/this.tank.volume}get waterChangePercent(){return this.tank.waterChangeVolume/this.tank.volume*100}get concentration(){const t={};return this.doses.forEach(l=>{ze(l.fertilizer.concentration).forEach(([i,h])=>{i in t||(t[i]={concentration:0,concentrationDay:0,concentrationWaterChange:0,concentrationTotal:0});let s=l.amount*h/this.tank.volume,g=l.amountDay*h/this.tank.volume,c=this.tank.waterChangeVolume?l.amountWaterChange*h/this.tank.waterChangeVolume:0,V=s;this.fertilizersRegime===S.ONCE_A_WEEK&&(c=s/this.waterChangeDecimal),this.fertilizersRegime===S.MIX&&(V=c*this.waterChangeDecimal+s),l.fertilizer.isLiquid||(s*=q,g*=q,c*=q,V*=q),t[i].concentration+=s,t[i].concentrationDay+=g,t[i].concentrationTotal+=V,t[i].concentrationWaterChange+=c})}),t}get ionList(){return ue(this.concentration)}get concentrationSorted(){const t=[];return Object.entries(this.concentration).forEach(([l,i])=>{t.push([l,{...i}])}),t.sort((l,i)=>i[1].concentrationTotal-l[1].concentrationTotal),t}get concentrationTotal(){return Object.fromEntries(Object.entries(this.concentration).map(([t,l])=>[t,l.concentrationTotal]))}countIonDynamic(t,l=0,i=0,h=0){const s=[];let g=l;if(t in this.concentration)return ue([...Array(this.daysTotal*15)]).forEach(c=>{+c>0&&+c%this.daysTotal===0&&(g=g*(1-this.waterChangeDecimal)+i*this.waterChangeDecimal),this.fertilizersRegime===S.EVERY_DAY?g+=this.concentration[t].concentrationDay:this.fertilizersRegime===S.ONCE_A_WEEK?+c%this.daysTotal===0&&(g+=this.concentration[t].concentrationWaterChange*this.waterChangeDecimal):this.fertilizersRegime===S.MIX&&(+c%this.daysTotal===0&&(g+=this.concentration[t].concentrationWaterChange*this.waterChangeDecimal),g+=this.concentration[t].concentrationDay),g-=h,g<0&&(g=0),s.push(g)}),s}countBalancedIons(){const t={};return["NO3","PO4","K","Ca","Mg","Na","SO4","Cl"].forEach(i=>{const h=this.countIonDynamic(i);if(h){const s=h.slice(-1*this.daysTotal);t[i]=[s[0],s[this.daysTotal-1]]}}),t}toJson(){return{doses:this.doses.map(t=>t.toJson()),daysTotal:this.daysTotal,tank:{...this.tank},fertilizersRegime:this.fertilizersRegime}}}const $s={class:"text-body-2 text-grey-darken-1 mb-8"},Ss={key:0,class:"d-flex flex-column flex-sm-row align-sm-center"},Fs={key:0},Aa=Z({name:"DosingPage",__name:"index",setup(U){const{t}=Q(),l=ye(),i=ut(),{fertilizerRecipes:h}=mt(),{fertilizers:s}=ct(),{remineralRecipes:g}=ft(),c=ae(),V=ve(),m=G(!1),n=G(!1),C=i.tankModels.map(y=>y.toJson()),E=F(()=>new Es(c.doseModels,c.fertilizersRegime,c.daysTotal,c.tank)),p=F(()=>{let y=[];if(N.value){const w=h.map(b=>b.name),I=s.map(b=>b.name),K=g.map(b=>b.name);y=pt.filter(b=>![...w,...I,...K].includes(b.name))}return[...h.map(w=>new se({fertilizer:w,fertilizerType:te.fertilizerRecipe,daysTotal:c.daysTotal})),...s.map(w=>new se({fertilizer:w,fertilizerType:te.fertilizer,daysTotal:c.daysTotal})),...g.map(w=>new se({fertilizer:w,fertilizerType:te.remineralRecipe,daysTotal:c.daysTotal})),...y.map(w=>new se({fertilizer:w,fertilizerType:te.fertilizer,daysTotal:c.daysTotal}))]}),A=F(()=>!isNaN(+l.query.schedule));be(()=>{l.query.schedule&&(n.value=!0)});function W(y){if(typeof y=="number"){c.setTank({name:y.toString(),volume:y});return}else if(typeof y=="string"||y===null)return;c.setTank({name:y.name,volume:y.volumeTotal,waterChangeVolume:y.waterChangeVolume})}function f(y){y.length>c.doseModels.length&&typeof[...y].pop()=="string"||c.setDoses(y.map(w=>w.toJson()))}function x(){c.resetDosing()}const N=F({get(){return c.isDefaultFertilizers},set(y){c.setDefaultFertilizers(y),V.show(t(y?"dosing.brandedAdded":"dosing.brandedRemoved"))}}),z=[y=>!!y||"Выберите аквариум"];return Pe({title:t("meta.dosing.title"),description:t("meta.dosing.description"),keywords:t("meta.dosing.keywords")}),(y,w)=>{const I=we,K=Re,b=St,_=Qt,H=Te,J=gs,ne=Rs,oe=dt;return r(),P(gt,{class:"mb-12"},{default:D(()=>[d(ht,null,{default:D(()=>[d(I,null,{button:D(()=>[d(X,{color:"primary",onClick:x},{default:D(()=>[R(o(e(t)("buttons.reset")),1)]),_:1})]),default:D(()=>[R(o(e(t)("dosing.title"))+" ",1)]),_:1}),d(yt,{cols:"12",sm:"10",md:"8","offset-sm":"1","offset-md":"2"},{default:D(()=>[a("div",$s,o(e(t)("dosing.doses.description")),1),d(oe,null,{default:D(()=>[d(Le,{ref:"scheduleForm"},{default:D(()=>[d(ke,{modelValue:e(E).tank,"onUpdate:modelValue":[w[0]||(w[0]=v=>e(E).tank=v),W],modelModifiers:{number:!0},items:e(C),"item-title":"name",variant:"underlined",label:e(t)("dosing.tankInputLabel"),hint:e(t)("dosing.tankInputHint"),"persistent-hint":"","hide-selected":"",rules:z,class:"mb-4",disabled:e(A)},null,8,["modelValue","items","label","hint","disabled"]),d(Y,null,{default:D(()=>{var v;return[(v=e(E).tank)!=null&&v.volume?(r(),u("div",Ss,[d(K,{"model-value":e(c).doseModels,items:e(p),variant:"underlined",label:e(t)("dosing.fertilizersInputLabel"),hint:e(t)("dosing.fertilizersInputHint"),"item-title":"fertilizer.name","persistent-hint":"",multiple:"",chips:"","closable-chips":"",class:"mb-4","onUpdate:modelValue":f},null,8,["model-value","items","label","hint"]),d(Ve,{modelValue:e(N),"onUpdate:modelValue":w[1]||(w[1]=ee=>M(N)?N.value=ee:null),color:"primary",label:e(t)("dosing.switch"),class:"ml-sm-4 flex-shrink-0"},null,8,["modelValue","label"])])):$("",!0)]}),_:1}),e(E).isDoses?(r(),P(b,{key:0,class:"mb-4"})):$("",!0),d(Y,null,{default:D(()=>[e(E).isDoses?(r(),u("div",Fs,[d(_,{"is-helpful-info":"","is-switchers":"",dosing:e(E)},{default:D(()=>[d(X,{color:"success",class:"mb-3 mb-sm-0",onClick:w[2]||(w[2]=v=>{m.value=!0})},{default:D(()=>[R(o(e(t)("dosing.dynamicsPopup.tankParams")),1)]),_:1})]),_:1},8,["dosing"])])):$("",!0)]),_:1}),e(E).isDoses?(r(),u(k,{key:1},[d(H,{modelValue:e(n),"onUpdate:modelValue":w[3]||(w[3]=v=>M(n)?n.value=v:null),button:"",class:"my-10"},{default:D(()=>[R(o(e(t)("dosing.schedule.createSchedule")),1)]),_:1},8,["modelValue"]),d(Y,null,{default:D(()=>[e(n)?(r(),P(J,{key:0,dosing:e(E),class:"mt-10"},null,8,["dosing"])):$("",!0)]),_:1})],64)):$("",!0),d(ne,{modelValue:e(m),"onUpdate:modelValue":w[4]||(w[4]=v=>M(m)?m.value=v:null),dosing:e(E)},null,8,["modelValue","dosing"])]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})}}});export{Aa as default};
