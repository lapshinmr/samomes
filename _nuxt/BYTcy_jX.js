var ke=Object.defineProperty;var we=(I,t,i)=>t in I?ke(I,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):I[t]=i;var j=(I,t,i)=>we(I,typeof t!="symbol"?t+"":t,i);import{_ as Re}from"./DIra7s3Q.js";import{V as de,a as Ee,_ as Se}from"./B3vb3TPU.js";import{_ as ce}from"./DVlJ22pm.js";import{F as $,A as ie,D as se}from"./BoIzNFIF.js";import{f as C,g as ye,a as $e,b as Fe}from"./DHChNhVW.js";import{e as Q,k as ee,E as F,c as u,o as r,b as d,i as R,w as V,j as e,z as W,H as k,a,L as O,h as N,t as o,_ as Me,l as We,d as w,M as H,F as be,G as Ae,r as G,D as Ue,y as ue,f as Ve,B as Ie,N as xe,C as Pe,I as pe,n as Ne,A as Oe}from"./Dt_hY5Oj.js";import{u as De}from"./DLpJezXQ.js";import{u as ne}from"./B8EHSZKT.js";import{V as re,a as Le}from"./BjC2Z3pJ.js";import{V as ge}from"./BZRvyWuu.js";import{_ as je}from"./CyNV4Nzl.js";import{R as q}from"./CgbmeEYS.js";import{V as ze}from"./D5JPqcNe.js";import{V as fe}from"./BzRjksdU.js";import{_ as ve,V as Ge}from"./AlMIrVF_.js";import{u as He}from"./BXcduvnD.js";import{u as Je}from"./EFSP32lW.js";import{u as Te}from"./CEN6kidz.js";import{t as Ce,a as me,b as qe}from"./BBggtmFf.js";import{a as X}from"./DVYLtouC.js";import{V as Be}from"./Bcp7-2_3.js";import{V as Ke}from"./2GcB7m4U.js";import{V as Z}from"./BFeFc3tU.js";import Ye from"./DQiwTzrJ.js";import{C as Xe,p as Ze,a as Qe,b as et,L as tt,P as st,c as at,d as nt,e as ot}from"./Bo6P3aXk.js";import{M as J}from"./pIIQsBHX.js";import{V as lt}from"./3yyLXgcO.js";import{a as it,b as rt,c as dt,V as ut}from"./1ZPuLRBT.js";import{V as he}from"./BxUAMrhL.js";import{_ as mt}from"./BayVzq8k.js";import{u as ct}from"./FN2OVCaq.js";import{u as ft}from"./BLuUstuC.js";import{u as pt}from"./B9H1_PTo.js";import{u as gt}from"./Qrnf7WDO.js";import{F as ht,a as yt}from"./NKOkaf8o.js";import{D as ae}from"./DsEisNnw.js";import{b as bt,a as Vt,V as Dt}from"./MZDb2Wcg.js";import"./B931MWyl.js";import"./Cut41Rwg.js";import"./CVKIk_o5.js";import"./CDHuI93o.js";import"./BbdJ6orW.js";import"./DN4H-Mtc.js";import"./DD68NtD1.js";import"./D9OwnUGw.js";import"./BjkILM8G.js";import"./DH5RAi3T.js";import"./C7OuhF3l.js";import"./Ct-l0l1E.js";import"./oyapwneb.js";/* empty css        */import"./Ch8e8etN.js";import"./CCfVRiHa.js";import"./D2vPiwbM.js";const zt={class:"d-flex"},vt={class:"d-flex w-100"},Tt={class:"d-flex align-start"},Ct={class:"d-flex mt-4"},_t={class:"text-subtitle-1 font-weight-medium w-100 pr-2"},kt={style:{position:"relative",top:"3px"}},wt={class:"d-flex align-start"},Rt={class:"d-flex"},Et={class:"font-weight-medium align-self-end w-60 pr-2"},St={style:{position:"relative",top:"3px"}},$t={class:"w-40 font-weight-medium"},Ft={class:"d-flex w-40"},Mt=Q({name:"TheFertilizersDosesTable",__name:"TheFertilizerDosesTable",setup(I){const{t}=ee(),{required:i,positive:l}=De(),b=[{text:t("dosing.dosesTable.everyDay"),value:!1},{text:t("dosing.dosesTable.total"),value:!0}],s=ne(),g=F({get(){return s.isTotalMode},set(n){s.setTotalMode(n)}}),z=F({get(){return s.daysTotal},set(n){s.setDaysTotal(n)}}),m=F({get(){return s.fertilizersRegime},set(n){s.setFertilizersRegime(n)}}),p=F({get(){return s.tank.waterChangeVolume},set(n){s.setWaterChangeVolume(n)}});return(n,v)=>{const M=ce;return r(),u("div",null,[d(Le,{modelValue:e(m),"onUpdate:modelValue":v[0]||(v[0]=c=>W(m)?m.value=c:null),color:"primary",class:"my-2 ml-n3","hide-details":"auto",inline:n.$vuetify.display.smAndUp},{default:V(()=>[d(re,{label:e(t)("dosing.dosesTable.regime1"),value:0},null,8,["label"]),d(re,{label:e(t)("dosing.dosesTable.regime2"),value:1,class:"mt-1 mt-sm-0"},null,8,["label"]),d(re,{label:e(t)("dosing.dosesTable.regime3"),value:2,class:"mt-1 mt-sm-0"},null,8,["label"])]),_:1},8,["modelValue","inline"]),e(m)===("FertilizersRegime"in n?n.FertilizersRegime:e($)).EVERY_DAY?(r(),u(k,{key:0},[a("div",zt,[d(de,{modelValue:e(g),"onUpdate:modelValue":v[1]||(v[1]=c=>W(g)?g.value=c:null),items:b,"item-title":"text","item-value":"value",variant:"underlined",class:"w-60 pr-2","hide-details":"auto"},null,8,["modelValue"]),d(M,{modelValue:e(z),"onUpdate:modelValue":v[2]||(v[2]=c=>W(z)?z.value=c:null),"hide-details":"auto",class:"w-40",label:e(t)("dosing.dosesTable.daysTotal"),rules:[e(l)]},null,8,["modelValue","label","rules"])]),(r(!0),u(k,null,O(e(s).doseModels,(c,A)=>(r(),u("div",{key:A,class:"d-flex justify-space-between align-center"},[a("div",vt,[e(g)?(r(),N(M,{key:0,"model-value":("format"in n?n.format:e(C))(c.amount),label:c.fertilizer.name,suffix:c.fertilizer.isLiquid?e(t)("units.ml"):e(t)("units.g"),"hide-details":"auto","onUpdate:modelValue":U=>e(s).updateAmount(U,A)},null,8,["model-value","label","suffix","onUpdate:modelValue"])):(r(),N(M,{key:1,"model-value":("format"in n?n.format:e(C))(c.amountDay),label:c.fertilizer.name,suffix:c.fertilizer.isLiquid?e(t)("units.ml/d"):e(t)("units.g/d"),"hide-details":"auto","onUpdate:modelValue":U=>e(s).updateAmountDay(U,A)},null,8,["model-value","label","suffix","onUpdate:modelValue"]))])]))),128))],64)):e(m)===("FertilizersRegime"in n?n.FertilizersRegime:e($)).ONCE_A_WEEK?(r(),u(k,{key:1},[a("div",Tt,[d(M,{modelValue:e(p),"onUpdate:modelValue":v[3]||(v[3]=c=>W(p)?p.value=c:null),label:e(t)("dosing.dosesTable.waterChange"),hint:e(t)("dosing.dosesTable.waterChangeHint"),"persistent-hint":"",class:"pr-2 w-60","validate-on":"eager",rules:[e(i),e(l)]},null,8,["modelValue","label","hint","rules"]),d(M,{modelValue:e(z),"onUpdate:modelValue":v[4]||(v[4]=c=>W(z)?z.value=c:null),"hide-details":"auto",class:"w-40",label:e(t)("dosing.dosesTable.daysTotal"),rules:[e(l)]},null,8,["modelValue","label","rules"])]),a("div",Ct,[a("div",_t,[a("span",kt,o(e(t)("dosing.dosesTable.doseTotal")),1),d(ge,{class:"mt-1"})])]),(r(!0),u(k,null,O(e(s).doseModels,(c,A)=>(r(),u("div",{key:A,class:"d-flex justify-space-between align-center"},[d(M,{"model-value":("format"in n?n.format:e(C))(c.amountWaterChange),label:c.fertilizer.name,suffix:c.fertilizer.isLiquid?e(t)("units.ml"):e(t)("units.g"),"hide-details":"auto",class:"pr-2",disabled:!e(p),"onUpdate:modelValue":U=>e(s).updateAmountWaterChange(U,A)},null,8,["model-value","label","suffix","disabled","onUpdate:modelValue"])]))),128))],64)):e(m)===("FertilizersRegime"in n?n.FertilizersRegime:e($)).MIX?(r(),u(k,{key:2},[a("div",wt,[d(M,{modelValue:e(p),"onUpdate:modelValue":v[5]||(v[5]=c=>W(p)?p.value=c:null),label:e(t)("dosing.dosesTable.waterChange"),hint:e(t)("dosing.dosesTable.waterChangeHint"),"persistent-hint":"",class:"pr-2 w-60","validate-on":"eager",rules:[e(i),e(l)]},null,8,["modelValue","label","hint","rules"]),d(M,{modelValue:e(z),"onUpdate:modelValue":v[6]||(v[6]=c=>W(z)?z.value=c:null),"hide-details":"auto",label:e(t)("dosing.dosesTable.daysTotal"),class:"w-40",rules:[e(l)]},null,8,["modelValue","label","rules"])]),a("div",Rt,[a("div",Et,[a("span",St,o(e(t)("dosing.dosesTable.waterChangeTitle")),1),d(ge,{class:"mt-1"})]),a("div",$t,[d(de,{modelValue:e(g),"onUpdate:modelValue":v[7]||(v[7]=c=>W(g)?g.value=c:null),items:b,"item-title":"text","item-value":"value",variant:"underlined","hide-details":"auto"},null,8,["modelValue"])])]),(r(!0),u(k,null,O(e(s).doseModels,(c,A)=>(r(),u("div",{key:A,class:"d-flex justify-space-between align-center"},[d(M,{"model-value":("format"in n?n.format:e(C))(c.amountWaterChange),label:c.fertilizer.name,suffix:c.fertilizer.isLiquid?e(t)("units.ml"):e(t)("units.g"),"hide-details":"auto",class:"pr-2 w-60",disabled:!e(p),"onUpdate:modelValue":U=>e(s).updateAmountWaterChange(U,A)},null,8,["model-value","label","suffix","disabled","onUpdate:modelValue"]),a("div",Ft,[e(g)?(r(),N(M,{key:0,"model-value":("format"in n?n.format:e(C))(c.amount),suffix:c.fertilizer.isLiquid?e(t)("units.ml"):e(t)("units.g"),"hide-details":"auto","onUpdate:modelValue":U=>e(s).updateAmount(U,A)},null,8,["model-value","suffix","onUpdate:modelValue"])):(r(),N(M,{key:1,"model-value":("format"in n?n.format:e(C))(c.amountDay),suffix:c.fertilizer.isLiquid?e(t)("units.ml/d"):e(t)("units.g/d"),"hide-details":"auto","onUpdate:modelValue":U=>e(s).updateAmountDay(U,A)},null,8,["model-value","suffix","onUpdate:modelValue"]))])]))),128))],64)):R("",!0)])}}}),Wt=Me(Mt,[["__scopeId","data-v-bc61e109"]]),At={class:"d-flex flex-column flex-md-row justify-space-between align-md-center mt-2 mb-2"},Ut={class:"pl-0 text-center"},It={class:"text-center"},xt={class:"text-no-wrap"},Pt={class:"text-center"},Nt={class:"text-no-wrap"},Ot={class:"text-center"},Lt={class:"text-no-wrap"},jt={class:"text-center"},Gt={class:"text-no-wrap"},Ht={class:"text-center"},Jt={class:"text-no-wrap"},qt={class:"text-center"},Bt={class:"text-no-wrap"},Kt={class:"text-center"},Yt={class:"text-no-wrap"},Xt={key:3,class:"text-center"},Zt={class:"pl-0 text-center"},Qt={key:3,class:"text-center"},es=Q({name:"TheElementsTable",__name:"TheDosingElementsTable",props:{dosing:{}},setup(I){const{t}=ee(),i=ne(),l=F({get(){return i.isHardness},set(s){i.setHardness(s)}});function b(s){return s<.01}return(s,g)=>{const z=je;return r(),u("div",null,[a("div",At,[d(ze,{modelValue:e(l),"onUpdate:modelValue":g[0]||(g[0]=m=>W(l)?l.value=m:null),color:"primary",label:e(t)("dosing.elementsTable.showGh"),"hide-details":"auto",class:"mt-0 mb-2 mb-sm-0"},null,8,["modelValue","label"]),We(s.$slots,"default")]),d(fe,{density:"compact"},{default:V(()=>[a("thead",null,[a("tr",null,[a("th",Ut,o(e(t)("dosing.elementsTable.element")),1),e(i).fertilizersRegime===("FertilizersRegime"in s?s.FertilizersRegime:e($)).EVERY_DAY?(r(),u(k,{key:0},[a("th",It,[w(o(e(t)("dosing.elementsTable.everyDayDose"))+", ",1),a("span",xt,o(e(t)("units.mg/l")),1)]),a("th",Pt,[w(o(e(t)("dosing.elementsTable.totalDose"))+", ",1),a("span",Nt,o(e(t)("units.mg/l")),1)])],64)):R("",!0),e(i).fertilizersRegime===("FertilizersRegime"in s?s.FertilizersRegime:e($)).ONCE_A_WEEK?(r(),u(k,{key:1},[a("th",Ot,[w(o(e(t)("dosing.elementsTable.inWaterChangeDose"))+", ",1),a("span",Lt,o(e(t)("units.mg/l")),1)]),a("th",jt,[w(o(e(t)("dosing.elementsTable.totalDose"))+", ",1),a("span",Gt,o(e(t)("units.mg/l")),1)])],64)):R("",!0),e(i).fertilizersRegime===("FertilizersRegime"in s?s.FertilizersRegime:e($)).MIX?(r(),u(k,{key:2},[a("th",Ht,[w(o(e(t)("dosing.elementsTable.inWaterChangeDose"))+", ",1),a("span",Jt,o(e(t)("units.mg/l")),1)]),a("th",qt,[w(o(e(t)("dosing.elementsTable.inDayWeekDose"))+", ",1),a("span",Bt,o(e(t)("units.mg/l")),1)]),a("th",Kt,[w(o(e(t)("dosing.elementsTable.totalDose"))+", ",1),a("span",Yt,o(e(t)("units.mg/l")),1)])],64)):R("",!0),e(l)?(r(),u("th",Xt," Gh ")):R("",!0)])]),a("tbody",null,[(r(!0),u(k,null,O(s.dosing.concentrationSorted,([m,p])=>(r(),u("tr",{key:m,class:"caption regular-sm"},[a("td",Zt,o(m),1),e(i).fertilizersRegime===("FertilizersRegime"in s?s.FertilizersRegime:e($)).EVERY_DAY?(r(),u(k,{key:0},[a("td",{class:H(["text-center text-no-wrap",{"text-caption":b(p.concentrationDay)}])},o(("format"in s?s.format:e(C))(p.concentrationDay)),3),a("td",{class:H(["text-center text-no-wrap",{"text-caption":b(p.concentration)}])},o(("format"in s?s.format:e(C))(p.concentration)),3)],64)):R("",!0),e(i).fertilizersRegime===("FertilizersRegime"in s?s.FertilizersRegime:e($)).ONCE_A_WEEK?(r(),u(k,{key:1},[a("td",{class:H(["text-center text-no-wrap",{"text-caption":b(p.concentrationWaterChange)}])},o(("format"in s?s.format:e(C))(p.concentrationWaterChange)),3),a("td",{class:H(["text-center text-no-wrap",{"text-caption":b(p.concentrationTotal)}])},o(("format"in s?s.format:e(C))(p.concentrationTotal)),3)],64)):R("",!0),e(i).fertilizersRegime===("FertilizersRegime"in s?s.FertilizersRegime:e($)).MIX?(r(),u(k,{key:2},[a("td",{class:H(["text-center text-no-wrap",{"text-caption":b(p.concentrationWaterChange)}])},o(("format"in s?s.format:e(C))(p.concentrationWaterChange)),3),a("td",{class:H(["text-center text-no-wrap",{"text-caption":b(p.concentrationDay)}])},o(("format"in s?s.format:e(C))(p.concentrationDay))+" / "+o(("format"in s?s.format:e(C))(p.concentration)),3),a("td",{class:H(["text-center text-no-wrap",{"text-caption":b(p.concentrationTotal)}])},o(("format"in s?s.format:e(C))(p.concentrationTotal)),3)],64)):R("",!0),e(l)?(r(),u("td",Qt,[m in("RemineralRecipe"in s?s.RemineralRecipe:e(q)).GH?(r(),u(k,{key:0},[[("FertilizersRegime"in s?s.FertilizersRegime:e($)).ONCE_A_WEEK,("FertilizersRegime"in s?s.FertilizersRegime:e($)).EVERY_DAY].includes(e(i).fertilizersRegime)?(r(),u(k,{key:0},[w(" +"+o(("format"in s?s.format:e(C))(p.concentration/("RemineralRecipe"in s?s.RemineralRecipe:e(q)).GH[m])),1)],64)):R("",!0),("FertilizersRegime"in s?s.FertilizersRegime:e($)).MIX===e(i).fertilizersRegime?(r(),u(k,{key:1},[w(" +"+o(("format"in s?s.format:e(C))(p.concentrationTotal/("RemineralRecipe"in s?s.RemineralRecipe:e(q)).GH[m])),1)],64)):R("",!0)],64)):R("",!0)])):R("",!0)]))),128))])]),_:1}),d(z,{concentration:s.dosing.concentrationTotal,"is-gh":e(l),class:"mt-8"},null,8,["concentration","is-gh"])])}}});class ts{constructor(t){j(this,"dosing");j(this,"startDate");j(this,"waterChangeDay",{date:"",fertilizers:{}});j(this,"days",[]);this.dosing=t}get daysAmountTotal(){const t={};return this.days.forEach(i=>{Ce(i.fertilizers).forEach(([l,b])=>{l in t||(t[l]=0),t[l]+=b.amount})}),t}get daysSelectedTotal(){const t={};return this.days.forEach(i=>{me(i.fertilizers).forEach(l=>{l in t||(t[l]=0),i.fertilizers[l].selected&&(t[l]+=1)})}),t}resetWaterChangeDay(){this.waterChangeDay={date:"",fertilizers:{}}}resetDays(){this.days=[]}initWaterChangeDay(){this.resetWaterChangeDay(),this.waterChangeDay.date=this.startDate,this.dosing.doses.forEach(t=>{t.amountWaterChange&&(this.waterChangeDay.fertilizers[t.fertilizer.name]={amount:t.amountWaterChange,status:ie.ACTIVE})})}initDays(){this.resetDays();let t=new Date(this.startDate);[...Array(this.dosing.daysTotal)].forEach(()=>{const i=ye(t),l={};this.dosing.doses.forEach(b=>{b.amountDay&&(l[b.fertilizer.name]={amount:b.amountDay,status:ie.ACTIVE,selected:!0})}),Object.entries(l).length!==0&&this.days.push({date:i,fertilizers:l}),t=new Date(t.setDate(t.getDate()+1))})}updateDays(){let t=new Date(this.startDate);for(const i of this.days){i.date=t.toISOString().split("T")[0];for(const l in i.fertilizers)i.fertilizers[l].status=ie.ACTIVE;t=new Date(t.setDate(t.getDate()+1))}}spreadDayAmounts(t){const i=this.dosing.doses.find(l=>l.fertilizer.name===t);i&&this.days.forEach(l=>{i.amountDay&&l.fertilizers[t].selected&&(l.fertilizers[t].amount=C(i.amount/this.daysSelectedTotal[t]))})}resetDaysAmount(t){const i=this.dosing.doses.find(l=>l.fertilizer.name===t);i&&this.days.forEach(l=>{l.fertilizers[t].amount=C(i.amount/this.days.length),l.fertilizers[t].selected=!0})}toJson(){return{dosing:this.dosing.toJson(),startDate:this.startDate,waterChangeDay:this.waterChangeDay,days:this.days}}}const ss={key:0},as={class:"text-center pl-0"},ns={key:0},os={class:"pl-0 text-center"},ls={class:"pl-0 text-center"},is={class:"d-flex flex-column"},rs={style:{"text-transform":"capitalize"}},ds={key:0,class:"d-flex justify-center align-center"},us={style:{width:"50px"}},ms={class:"pl-0 text-center font-weight-medium"},cs={key:0,class:"d-flex flex-column align-center"},fs={class:"font-weight-medium"},ps=["onClick"],gs={class:"d-flex mt-10"},hs=Q({name:"TheScheduleDoseTable",__name:"TheScheduleDoseTable",props:{dosing:{}},setup(I){const{t,locale:i}=ee(),l=be(),b=Ae(),{appRoutes:s}=He(),g=Je(),z=Te(),m=I,p=G(),n=Ue(new ts(m.dosing)),v=F(()=>!isNaN(p.value));ue(()=>m.dosing,()=>{n.dosing=m.dosing,n.startDate&&(n.initWaterChangeDay(),n.initDays())}),Ve(()=>{if(p.value=+l.query.schedule,isNaN(p.value))n.startDate=ye(new Date),n.initWaterChangeDay(),n.initDays();else{const f=JSON.parse(JSON.stringify(g.schedules[p.value]));f&&(n.startDate=f.startDate,n.waterChangeDay=f.waterChangeDay,n.days=f.days)}});function M(f){f&&(n.startDate=f,n.initWaterChangeDay(),n.days.length>0?n.updateDays():n.initDays())}async function c(){v.value?g.editSchedule(p.value,n.toJson()):g.saveSchedule(n.toJson()),await b.push(s.value.schedules.path)}function A(f,P){P.selected||(P.amount=0),n.spreadDayAmounts(f)}async function U(){g.removeSchedule(p.value),z.show(t("dosing.schedule.scheduleRemoved")),await b.push(s.value.schedules.path)}return(f,P)=>{const B=ce;return r(),u("div",null,[d(Be,{"model-value":e(n).startDate,type:"date",label:e(t)("dosing.schedule.chooseDate"),class:"mb-4","onUpdate:modelValue":M},null,8,["model-value","label"]),d(X,null,{default:V(()=>[e(n).startDate?(r(),u("div",ss,[d(fe,{"fixed-footer":""},{default:V(()=>[a("thead",null,[a("tr",null,[a("th",as,o(e(t)("dosing.schedule.days")),1),(r(!0),u(k,null,O(e(n).dosing.doses,_=>(r(),u("th",{key:_.fertilizer.name,class:"text-center"},o(_.fertilizer.name),1))),128))])]),a("tbody",null,[e(n).dosing.fertilizersRegime===("FertilizersRegime"in f?f.FertilizersRegime:e($)).ONCE_A_WEEK||e(n).dosing.fertilizersRegime===("FertilizersRegime"in f?f.FertilizersRegime:e($)).MIX?(r(),u("tr",ns,[a("td",os,o(e(t)("dosing.schedule.waterChange")),1),(r(!0),u(k,null,O(e(n).dosing.doses,_=>{var S;return r(),u("td",{key:`water_change_${_.fertilizer.name}`,class:"text-center"},o(((S=e(n).waterChangeDay.fertilizers[_.fertilizer.name])==null?void 0:S.amount)||"—"),1)}),128))])):R("",!0),e(n).days.length>0?(r(),u(k,{key:1},[(r(!0),u(k,null,O(e(n).days,_=>(r(),u("tr",{key:_.date},[a("td",ls,[a("div",is,[a("span",rs,o(("getWeekday"in f?f.getWeekday:e($e))(_.date,e(i))),1),a("span",null,o(("formatDate"in f?f.formatDate:e(Fe))(_.date,e(i))),1)])]),(r(!0),u(k,null,O(e(n).dosing.doses,S=>{var K;return r(),u("td",{key:S.fertilizer.name+_,class:"text-center"},[((K=_.fertilizers[S.fertilizer.name])==null?void 0:K.amount)!==void 0?(r(),u("div",ds,[a("div",us,[d(B,{modelValue:_.fertilizers[S.fertilizer.name].amount,"onUpdate:modelValue":h=>_.fertilizers[S.fertilizer.name].amount=h},null,8,["modelValue","onUpdate:modelValue"])]),d(Ke,{modelValue:_.fertilizers[S.fertilizer.name].selected,"onUpdate:modelValue":[h=>_.fertilizers[S.fertilizer.name].selected=h,h=>A(S.fertilizer.name,_.fertilizers[S.fertilizer.name])],color:"primary",dense:"","hide-details":"auto",class:"mt-0 ml-1",style:{display:"inline-block"}},null,8,["modelValue","onUpdate:modelValue"])])):(r(),u(k,{key:1},[w(" — ")],64))])}),128))]))),128)),a("tr",null,[a("td",ms,o(e(t)("common.total")),1),(r(!0),u(k,null,O(e(n).dosing.doses,_=>(r(),u("td",{key:_.fertilizer.name,class:"text-center"},[e(n).daysAmountTotal[_.fertilizer.name]?(r(),u("div",cs,[a("div",null,[a("span",{class:H({"text-warning":("format"in f?f.format:e(C))(e(n).daysAmountTotal[_.fertilizer.name])!==("format"in f?f.format:e(C))(_.amount)})},o(("format"in f?f.format:e(C))(e(n).daysAmountTotal[_.fertilizer.name])),3),P[1]||(P[1]=w(" / ")),a("span",fs,o(("format"in f?f.format:e(C))(_.amount)),1)]),a("div",{class:"text-blue cursor-pointer",onClick:S=>e(n).resetDaysAmount(_.fertilizer.name)},o(e(t)("buttons.reset")),9,ps)])):(r(),u(k,{key:1},[w(" — ")],64))]))),128))])],64)):R("",!0)])]),_:1}),a("div",gs,[e(v)?(r(),N(Z,{key:0,color:"error",onClick:U},{default:V(()=>[w(o(e(t)("buttons.remove")),1)]),_:1})):R("",!0),d(Z,{class:"ml-auto mr-1 mr-sm-2 ml-sm-auto",onClick:P[0]||(P[0]=_=>e(b).push(e(s).schedules.path))},{default:V(()=>[w(o(e(t)("buttons.cancel")),1)]),_:1}),d(Z,{color:"primary",onClick:c},{default:V(()=>[w(o(e(t)("buttons.save")),1)]),_:1})])])):R("",!0)]),_:1})])}}}),ys=Q({__name:"LineChart",props:{data:{},options:{}},setup(I){return Xe.register(Ze,Qe,et,tt,st,at,nt),(t,i)=>(r(),N(e(ot),{id:"my-chart-id",options:t.options,data:t.data},null,8,["options","data"]))}}),bs={key:0},Vs={class:"mb-4 text-body-2"},Ds={class:"mb-2"},zs={class:"text-center"},vs={class:"text-center"},Ts={class:"text-center"},Cs={class:"text-center"},_s={class:"text-center"},ks={class:"text-center"},ws={class:"text-center"},Rs={key:0},Es=Q({name:"TheDynamicsPopup",__name:"TheDynamicsPopup",props:Ie({dosing:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:["update:modelValue"],setup(I){const{t}=ee(),{mdAndUp:i}=xe(),{positive:l}=De(),b=ne(),s=Pe(I,"modelValue"),g=I,z=G(!1),m=G(),p=G(),n=G(),v=G(),M=G([]),c={NO3:"#D81B60",PO4:"#1E88E5",K:"#78909C"},A={maintainAspectRatio:!1,responsive:!0},U=F(()=>({labels:Object.keys([...Array(g.dosing.daysTotal*15)]),datasets:[{label:m.value,fill:!1,borderColor:c[m.value],data:M.value}]})),f=F(()=>g.dosing.countBalancedIons()),P=F(()=>{let y=0,D=0;return qe(f.value).forEach(([x,Y])=>{y+=x,D+=Y}),[y,D]}),B=F(()=>"Ca"in f.value&&"Mg"in f.value?f.value.Ca[0]/f.value.Mg[0]:null),_=F(()=>"Ca"in f.value&&"Mg"in f.value?f.value.Ca[1]/f.value.Mg[1]:null),S=F(()=>q.countCaGh(f.value.Ca[0],1/J,1)+q.countMgGh(f.value.Mg[0],1/J,1)),K=F(()=>q.countCaGh(f.value.Ca[1],1/J,1)+q.countMgGh(f.value.Mg[1],1/J,1)),h=F({get(){return b.tank.waterChangeVolume},set(y){b.setWaterChangeVolume(y)}});ue(m,()=>{p.value=0,n.value=0,v.value=0}),ue([m,p,n,v,()=>g.dosing],()=>{M.value=g.dosing.countIonDynamic(m.value,p.value,n.value,v.value)});function T(){return Math.ceil(Math.log(.05)/Math.log(1-g.dosing.waterChangeDecimal))}return(y,D)=>{const x=ce,Y=Ye,oe=ve,le=ys;return r(),N(lt,{modelValue:s.value,"onUpdate:modelValue":D[7]||(D[7]=E=>s.value=E),"max-width":"700"},{default:V(()=>[d(ut,null,{default:V(()=>[d(it,null,{default:V(()=>[w(o(e(t)("dosing.dynamicsPopup.tankParams")),1)]),_:1}),d(rt,null,{default:V(()=>[d(x,{modelValue:e(h),"onUpdate:modelValue":D[0]||(D[0]=E=>W(h)?h.value=E:null),label:e(t)("dosing.dosesTable.waterChange"),hint:e(t)("dosing.dosesTable.waterChangeHint"),"persistent-hint":"",class:"pr-2 w-60 mb-4","validate-on":"eager",rules:[e(l)]},null,8,["modelValue","label","hint","rules"]),d(X,null,{default:V(()=>[e(h)?(r(),u("div",bs,[a("div",Vs,[w(o(e(t)("dosing.dynamicsPopup.description",{waterChangePercent:("format"in y?y.format:e(C))(y.dosing.waterChangePercent,3),daysTotal:y.dosing.daysTotal,balancedWaterChangeNumber:T(),balancedDaysTotal:y.dosing.daysTotal*(T()-1)}))+" ",1),d(he,{location:"bottom","max-width":"400","open-on-click":"","open-on-hover":""},{activator:V(({props:E})=>[d(Y,pe({name:"mdi-help-circle-outline",size:"18",class:"mb-n1"},E),null,16)]),default:V(()=>[a("p",Ds,o(e(t)("dosing.dynamicsPopup.tooltip.text1")),1),a("p",null,o(e(t)("dosing.dynamicsPopup.tooltip.text2")),1)]),_:1}),D[8]||(D[8]=w(": "))]),Object.keys(e(f)).length>0?(r(),N(fe,{key:0,density:"compact"},{default:V(()=>[a("thead",null,[a("tr",null,[a("th",zs,o(e(t)("dosing.dynamicsPopup.element")),1),a("th",vs,[w(o(e(t)("dosing.dynamicsPopup.range"))+", "+o(e(t)("units.mg/l"))+" ",1),d(he,{location:"bottom","max-width":"400","open-on-click":"","open-on-hover":""},{activator:V(({props:E})=>[d(Y,pe({name:"mdi-help-circle-outline",size:"18",class:"mb-n1"},E),null,16)]),default:V(()=>[w(" "+o(e(t)("dosing.dynamicsPopup.tableTooltip")),1)]),_:1})])])]),a("tbody",null,[(r(!0),u(k,null,O(e(f),(E,te)=>(r(),u("tr",{key:te},[a("td",Ts,o(te),1),a("td",Cs,o(("format"in y?y.format:e(C))(E[0]))+" — "+o(("format"in y?y.format:e(C))(E[1])),1)]))),128))]),a("tfoot",null,[e(B)&&e(_)?(r(),u(k,{key:0},[a("tr",null,[D[9]||(D[9]=a("td",{class:"text-center"},"Ca/Mg",-1)),a("td",_s,o(("format"in y?y.format:e(C))(e(B)))+" — "+o(("format"in y?y.format:e(C))(e(_))),1)]),a("tr",null,[D[10]||(D[10]=a("td",{class:"text-center"},"dGh",-1)),a("td",ks,o(("format"in y?y.format:e(C))(e(S)))+" — "+o(("format"in y?y.format:e(C))(e(K))),1)])],64)):R("",!0),a("tr",null,[D[11]||(D[11]=a("td",{class:"text-center"},"TDS",-1)),a("td",ws,o(("format"in y?y.format:e(C))(e(P)[0]))+" — "+o(("format"in y?y.format:e(C))(e(P)[1])),1)])])]),_:1})):R("",!0),d(oe,{modelValue:e(z),"onUpdate:modelValue":D[1]||(D[1]=E=>W(z)?z.value=E:null),button:"",class:"my-10"},{default:V(()=>[w(o(e(t)("dosing.dynamicsPopup.dynamics")),1)]),_:1},8,["modelValue"]),d(X,null,{default:V(()=>[e(z)?(r(),u("div",Rs,[d(de,{modelValue:e(m),"onUpdate:modelValue":D[2]||(D[2]=E=>W(m)?m.value=E:null),items:y.dosing.ionList,variant:"outlined",label:e(t)("dosing.dynamicsPopup.chooseElement")},null,8,["modelValue","items","label"]),a("div",{style:Ne(e(i)?"height: 400px;":"height: 250px;"),class:"mb-4"},[d(le,{data:e(U),options:A,class:"line-chart"},null,8,["data"])],4),d(x,{modelValue:e(n),"onUpdate:modelValue":D[3]||(D[3]=E=>W(n)?n.value=E:null),label:e(t)("dosing.dynamicsPopup.concInWaterChange"),suffix:e(t)("units.mg/l"),"hide-details":"auto"},null,8,["modelValue","label","suffix"]),d(x,{modelValue:e(p),"onUpdate:modelValue":D[4]||(D[4]=E=>W(p)?p.value=E:null),label:e(t)("dosing.dynamicsPopup.concInTank"),suffix:e(t)("units.mg/l"),"hide-details":"auto"},null,8,["modelValue","label","suffix"]),d(x,{modelValue:e(v),"onUpdate:modelValue":D[5]||(D[5]=E=>W(v)?v.value=E:null),label:e(t)("dosing.dynamicsPopup.concPerDay"),suffix:e(t)("units.mg/l"),"hide-details":"auto"},null,8,["modelValue","label","suffix"])])):R("",!0)]),_:1})])):R("",!0)]),_:1})]),_:1}),d(dt,null,{default:V(()=>[d(Z,{color:"primary",onClick:D[6]||(D[6]=E=>s.value=!1)},{default:V(()=>[w(o(e(t)("buttons.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});class Ss{constructor(t,i,l,b){j(this,"doses");j(this,"fertilizersRegime");j(this,"daysTotal");j(this,"tank");this.doses=t,this.fertilizersRegime=i,this.daysTotal=l,this.tank=b}get isDoses(){return this.doses.length>0}get waterChangeDecimal(){return this.tank.waterChangeVolume/this.tank.volume}get waterChangePercent(){return this.tank.waterChangeVolume/this.tank.volume*100}get concentration(){const t={};return this.doses.forEach(i=>{Ce(i.fertilizer.concentration).forEach(([l,b])=>{l in t||(t[l]={concentration:0,concentrationDay:0,concentrationWaterChange:0,concentrationTotal:0});let s=i.amount*b/this.tank.volume,g=i.amountDay*b/this.tank.volume,z=0;this.tank.waterChangeVolume&&(z=i.amountWaterChange*b/this.tank.waterChangeVolume);let m=s;this.fertilizersRegime===$.ONCE_A_WEEK&&(m=z*this.waterChangeDecimal),this.fertilizersRegime===$.MIX&&(m=z*this.waterChangeDecimal+s),i.fertilizer.isLiquid||(s*=J,g*=J,z*=J,m*=J),t[l].concentration+=s,t[l].concentrationDay+=g,t[l].concentrationTotal+=m,t[l].concentrationWaterChange+=z})}),t}get ionList(){return me(this.concentration)}get concentrationSorted(){const t=[];return Object.entries(this.concentration).forEach(([i,l])=>{t.push([i,{...l}])}),t.sort((i,l)=>l[1].concentrationTotal-i[1].concentrationTotal),t}get concentrationTotal(){return Object.fromEntries(Object.entries(this.concentration).map(([t,i])=>[t,i.concentrationTotal]))}countIonDynamic(t,i=0,l=0,b=0){const s=[];let g=i;if(t in this.concentration)return me([...Array(this.daysTotal*15)]).forEach(z=>{+z>0&&+z%this.daysTotal===0&&(g=g*(1-this.waterChangeDecimal)+l*this.waterChangeDecimal),this.fertilizersRegime===$.EVERY_DAY?g+=this.concentration[t].concentrationDay:this.fertilizersRegime===$.ONCE_A_WEEK?+z%this.daysTotal===0&&(g+=this.concentration[t].concentrationWaterChange*this.waterChangeDecimal):this.fertilizersRegime===$.MIX&&(+z%this.daysTotal===0&&(g+=this.concentration[t].concentrationWaterChange*this.waterChangeDecimal),g+=this.concentration[t].concentrationDay),g-=b,g<0&&(g=0),s.push(g)}),s}countBalancedIons(){const t={};return["NO3","PO4","K","Ca","Mg","Na","SO4","Cl"].forEach(l=>{const b=this.countIonDynamic(l);if(b){const s=b.slice(-1*this.daysTotal);t[l]=[s[0],s[this.daysTotal-1]]}}),t}toJson(){return{doses:this.doses.map(t=>t.toJson()),daysTotal:this.daysTotal,tank:{...this.tank},fertilizersRegime:this.fertilizersRegime}}}const $s={class:"text-body-2 text-grey-darken-1 mb-8"},Fs={key:0,class:"d-flex flex-column flex-sm-row align-sm-center"},Ms={key:0},Aa=Q({name:"DosingPage",__name:"index",setup(I){const{t,locale:i}=ee(),l=be(),b=ct(),s=ft(),g=pt(),z=gt(),m=ne(),p=Te(),n=G(!1),v=G(!1),M=b.tankModels.map(h=>h.toJson()),c=F(()=>new Ss(m.doseModels,m.fertilizersRegime,m.daysTotal,m.tank)),A=F(()=>{const h=JSON.parse(JSON.stringify(ht));return i.value==="en"&&yt.forEach(T=>{const y=h.find(D=>T.key===D.key);y&&(y.name=T.name,y.description=T.description)}),h.sort((T,y)=>T.name.localeCompare(y.name)),h}),U=F(()=>{let h=[];if(S.value){const T=s.fertilizerRecipes.map(x=>x.name),y=g.fertilizers.map(x=>x.name),D=z.remineralRecipes.map(x=>x.name);h=A.value.filter(x=>![...T,...y,...D].includes(x.name))}return[...s.fertilizerRecipes.map(T=>new ae({fertilizer:T,fertilizerType:se.fertilizerRecipe,daysTotal:m.daysTotal})),...g.fertilizers.map(T=>new ae({fertilizer:T,fertilizerType:se.fertilizer,daysTotal:m.daysTotal})),...z.remineralRecipes.map(T=>new ae({fertilizer:T,fertilizerType:se.remineralRecipe,daysTotal:m.daysTotal})),...h.map(T=>new ae({fertilizer:T,fertilizerType:se.fertilizer,daysTotal:m.daysTotal}))]}),f=F(()=>!isNaN(+l.query.schedule));Ve(()=>{l.query.schedule&&(v.value=!0)});function P(h){if(typeof h=="number"){m.setTank({name:h.toString(),volume:h});return}else if(typeof h=="string"||h===null)return;m.setTank({name:h.name,volume:h.volumeTotal,waterChangeVolume:h.waterChangeVolume})}function B(h){h.length>m.doseModels.length&&typeof[...h].pop()=="string"||m.setDoses(h.map(T=>T.toJson()))}function _(){m.resetDosing()}const S=F({get(){return m.isDefaultFertilizers},set(h){m.setDefaultFertilizers(h),p.show(t(h?"dosing.brandedAdded":"dosing.brandedRemoved"))}}),K=[h=>!!h||"Выберите аквариум"];return Oe({title:t("meta.dosing.title"),description:t("meta.dosing.description"),keywords:t("meta.dosing.keywords")}),(h,T)=>{const y=Re,D=Se,x=Wt,Y=es,oe=ve,le=hs,E=Es,te=mt;return r(),N(bt,{class:"mb-12"},{default:V(()=>[d(Vt,null,{default:V(()=>[d(y,null,{button:V(()=>[d(Z,{color:"primary",onClick:_},{default:V(()=>[w(o(e(t)("buttons.reset")),1)]),_:1})]),default:V(()=>[w(o(e(t)("dosing.title"))+" ",1)]),_:1}),d(Dt,{cols:"12",sm:"10",md:"8","offset-sm":"1","offset-md":"2"},{default:V(()=>[a("div",$s,o(e(t)("dosing.doses.description")),1),d(te,null,{default:V(()=>[d(Ge,{ref:"scheduleForm"},{default:V(()=>[d(Ee,{modelValue:e(c).tank,"onUpdate:modelValue":[T[0]||(T[0]=L=>e(c).tank=L),P],modelModifiers:{number:!0},items:e(M),"item-title":"name",variant:"underlined",label:e(t)("dosing.tankInputLabel"),hint:e(t)("dosing.tankInputHint"),"persistent-hint":"","hide-selected":"",rules:K,class:"mb-4",disabled:e(f)},null,8,["modelValue","items","label","hint","disabled"]),d(X,null,{default:V(()=>{var L;return[(L=e(c).tank)!=null&&L.volume?(r(),u("div",Fs,[d(D,{"model-value":e(m).doseModels,items:e(U),variant:"underlined",label:e(t)("dosing.fertilizersInputLabel"),hint:e(t)("dosing.fertilizersInputHint"),"item-title":"fertilizer.name","persistent-hint":"",multiple:"",chips:"","closable-chips":"",class:"mb-4","onUpdate:modelValue":B},null,8,["model-value","items","label","hint"]),d(ze,{modelValue:e(S),"onUpdate:modelValue":T[1]||(T[1]=_e=>W(S)?S.value=_e:null),color:"primary",label:e(t)("dosing.switch"),class:"ml-sm-4 flex-shrink-0"},null,8,["modelValue","label"])])):R("",!0)]}),_:1}),e(c).isDoses?(r(),N(x,{key:0,class:"mb-4"})):R("",!0),d(X,null,{default:V(()=>[e(c).isDoses?(r(),u("div",Ms,[d(Y,{"is-helpful-info":"","is-switchers":"",dosing:e(c)},{default:V(()=>[d(Z,{color:"success",class:"mb-3 mb-sm-0",onClick:T[2]||(T[2]=L=>{n.value=!0})},{default:V(()=>[w(o(e(t)("dosing.dynamicsPopup.tankParams")),1)]),_:1})]),_:1},8,["dosing"])])):R("",!0)]),_:1}),e(c).isDoses?(r(),u(k,{key:1},[d(oe,{modelValue:e(v),"onUpdate:modelValue":T[3]||(T[3]=L=>W(v)?v.value=L:null),button:"",class:"my-10"},{default:V(()=>[w(o(e(t)("dosing.schedule.createSchedule")),1)]),_:1},8,["modelValue"]),d(X,null,{default:V(()=>[e(v)?(r(),N(le,{key:0,dosing:e(c),class:"mt-10"},null,8,["dosing"])):R("",!0)]),_:1})],64)):R("",!0),d(E,{modelValue:e(n),"onUpdate:modelValue":T[4]||(T[4]=L=>W(n)?n.value=L:null),dosing:e(c)},null,8,["modelValue","dosing"])]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})}}});export{Aa as default};
