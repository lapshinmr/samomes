var we=Object.defineProperty;var ke=(A,t,i)=>t in A?we(A,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):A[t]=i;var j=(A,t,i)=>ke(A,typeof t!="symbol"?t+"":t,i);import{_ as Re}from"./D8L4ddpU.js";import{V as de,a as Ee,_ as Se}from"./BFeahmug.js";import{_ as ce}from"./BAlGtWDv.js";import{F as I,A as ie,D as se}from"./BoIzNFIF.js";import{f as C,g as ye,a as $e,b as Fe}from"./DHChNhVW.js";import{e as Q,k as ee,E as $,c,o as r,b as d,i as E,w as V,j as e,z as M,H as w,a,L as O,h as N,t as o,_ as Me,l as We,d as k,M as J,F as be,G as xe,r as G,D as Ae,y as ue,f as Ve,B as Ue,N as Ie,C as Pe,I as pe,n as Ne,A as Oe}from"./4DDGlPu9.js";import{u as De}from"./BraOfSPb.js";import{u as ne}from"./2Oyo2Vtg.js";import{V as re,a as Le}from"./Csi3Qo0Q.js";import{V as he}from"./vnWA3dHU.js";import{_ as je}from"./Cvf1YOSE.js";import{R as Y}from"./CgbmeEYS.js";import{V as ve}from"./Bhla4Hl_.js";import{V as fe}from"./CiwXtdbK.js";import{_ as Te,V as Ge}from"./B1YqnSCG.js";import{u as Je}from"./CVh6j9lI.js";import{u as qe}from"./CUUFcsf8.js";import{u as _e}from"./CUZIdrTu.js";import{t as ze,a as me,b as Be}from"./BBggtmFf.js";import{a as X}from"./ChtXI062.js";import{V as He}from"./BqA8cAIL.js";import{V as Ke}from"./OcCitwYj.js";import{V as Z}from"./pn0yBbum.js";import Ye from"./Cr_eJaku.js";import{C as Xe,p as Ze,a as Qe,b as et,L as tt,P as st,c as at,d as nt,e as ot}from"./BEcuzk1H.js";import{M as q}from"./pIIQsBHX.js";import{V as lt}from"./DHTBsvVg.js";import{a as it,b as rt,c as dt,V as ut}from"./C69-yiqz.js";import{V as ge}from"./Cx8Jdcth.js";import{_ as mt}from"./CMs0IOao.js";import{u as ct}from"./BJARJ5Mr.js";import{u as ft}from"./CVm5WXKH.js";import{u as pt}from"./Dw-wCBdr.js";import{u as ht}from"./C-kXbRrJ.js";import{F as gt,a as yt}from"./NKOkaf8o.js";import{D as ae}from"./DsEisNnw.js";import{b as bt,a as Vt,V as Dt}from"./BEWM2UJB.js";import"./B931MWyl.js";import"./bzDsmipn.js";import"./B_yGS1YP.js";import"./CIUUx1Lt.js";import"./CKJfut37.js";import"./D5xaZfaH.js";import"./D1J_CxX2.js";import"./DpWlsX81.js";import"./T2xCpJ1C.js";import"./DPOVp56R.js";import"./C6uoOoNV.js";import"./Pi4BUpqD.js";import"./Cn_JaUnx.js";/* empty css        */import"./Ch8e8etN.js";import"./CCfVRiHa.js";import"./D2vPiwbM.js";const vt={class:"d-flex"},Tt={class:"d-flex w-100"},_t={class:"d-flex align-start"},zt={class:"d-flex mt-4"},Ct={class:"text-subtitle-1 font-weight-medium w-100 pr-2"},wt={style:{position:"relative",top:"3px"}},kt={class:"d-flex align-start"},Rt={class:"d-flex"},Et={class:"font-weight-medium align-self-end w-60 pr-2"},St={style:{position:"relative",top:"3px"}},$t={class:"w-40 font-weight-medium"},Ft={class:"d-flex w-40"},Mt=Q({name:"TheFertilizersDosesTable",__name:"TheFertilizerDosesTable",setup(A){const{t}=ee(),{required:i,positive:l}=De(),b=[{text:t("dosing.dosesTable.everyDay"),value:!1},{text:t("dosing.dosesTable.total"),value:!0}],s=ne(),h=$({get(){return s.isTotalMode},set(n){s.setTotalMode(n)}}),v=$({get(){return s.daysTotal},set(n){s.setDaysTotal(n)}}),u=$({get(){return s.fertilizersRegime},set(n){s.setFertilizersRegime(n)}}),p=$({get(){return s.tank.waterChangeVolume},set(n){s.setWaterChangeVolume(n)}});return(n,T)=>{const F=ce;return r(),c("div",null,[d(Le,{modelValue:e(u),"onUpdate:modelValue":T[0]||(T[0]=m=>M(u)?u.value=m:null),color:"primary",class:"my-2 ml-n3","hide-details":"auto",inline:n.$vuetify.display.smAndUp},{default:V(()=>[d(re,{label:e(t)("dosing.dosesTable.regime1"),value:0},null,8,["label"]),d(re,{label:e(t)("dosing.dosesTable.regime2"),value:1,class:"mt-1 mt-sm-0"},null,8,["label"]),d(re,{label:e(t)("dosing.dosesTable.regime3"),value:2,class:"mt-1 mt-sm-0"},null,8,["label"])]),_:1},8,["modelValue","inline"]),e(u)===("FertilizersRegime"in n?n.FertilizersRegime:e(I)).EVERY_DAY?(r(),c(w,{key:0},[a("div",vt,[d(de,{modelValue:e(h),"onUpdate:modelValue":T[1]||(T[1]=m=>M(h)?h.value=m:null),items:b,"item-title":"text","item-value":"value",variant:"underlined",class:"w-60 pr-2","hide-details":"auto"},null,8,["modelValue"]),d(F,{modelValue:e(v),"onUpdate:modelValue":T[2]||(T[2]=m=>M(v)?v.value=m:null),"hide-details":"auto",class:"w-40",label:e(t)("dosing.dosesTable.daysTotal"),rules:[e(l)]},null,8,["modelValue","label","rules"])]),(r(!0),c(w,null,O(e(s).doseModels,(m,W)=>(r(),c("div",{key:W,class:"d-flex justify-space-between align-center"},[a("div",Tt,[e(h)?(r(),N(F,{key:0,"model-value":("format"in n?n.format:e(C))(m.amount),label:m.fertilizer.name,suffix:m.fertilizer.isLiquid?e(t)("units.ml"):e(t)("units.g"),"hide-details":"auto","onUpdate:modelValue":x=>e(s).updateAmount(x,W)},null,8,["model-value","label","suffix","onUpdate:modelValue"])):(r(),N(F,{key:1,"model-value":("format"in n?n.format:e(C))(m.amountDay),label:m.fertilizer.name,suffix:m.fertilizer.isLiquid?e(t)("units.ml/d"):e(t)("units.g/d"),"hide-details":"auto","onUpdate:modelValue":x=>e(s).updateAmountDay(x,W)},null,8,["model-value","label","suffix","onUpdate:modelValue"]))])]))),128))],64)):e(u)===("FertilizersRegime"in n?n.FertilizersRegime:e(I)).ONCE_A_WEEK?(r(),c(w,{key:1},[a("div",_t,[d(F,{modelValue:e(p),"onUpdate:modelValue":T[3]||(T[3]=m=>M(p)?p.value=m:null),label:e(t)("dosing.dosesTable.waterChange"),hint:e(t)("dosing.dosesTable.waterChangeHint"),"persistent-hint":"",class:"pr-2 w-60","validate-on":"eager",rules:[e(i),e(l)]},null,8,["modelValue","label","hint","rules"]),d(F,{modelValue:e(v),"onUpdate:modelValue":T[4]||(T[4]=m=>M(v)?v.value=m:null),"hide-details":"auto",class:"w-40",label:e(t)("dosing.dosesTable.daysTotal"),rules:[e(l)]},null,8,["modelValue","label","rules"])]),a("div",zt,[a("div",Ct,[a("span",wt,o(e(t)("dosing.dosesTable.doseTotal")),1),d(he,{class:"mt-1"})])]),(r(!0),c(w,null,O(e(s).doseModels,(m,W)=>(r(),c("div",{key:W,class:"d-flex justify-space-between align-center"},[d(F,{"model-value":("format"in n?n.format:e(C))(m.amountWaterChange),label:m.fertilizer.name,suffix:m.fertilizer.isLiquid?e(t)("units.ml"):e(t)("units.g"),"hide-details":"auto",class:"pr-2",disabled:!e(p),"onUpdate:modelValue":x=>e(s).updateAmountWaterChange(x,W)},null,8,["model-value","label","suffix","disabled","onUpdate:modelValue"])]))),128))],64)):e(u)===("FertilizersRegime"in n?n.FertilizersRegime:e(I)).MIX?(r(),c(w,{key:2},[a("div",kt,[d(F,{modelValue:e(p),"onUpdate:modelValue":T[5]||(T[5]=m=>M(p)?p.value=m:null),label:e(t)("dosing.dosesTable.waterChange"),hint:e(t)("dosing.dosesTable.waterChangeHint"),"persistent-hint":"",class:"pr-2 w-60","validate-on":"eager",rules:[e(i),e(l)]},null,8,["modelValue","label","hint","rules"]),d(F,{modelValue:e(v),"onUpdate:modelValue":T[6]||(T[6]=m=>M(v)?v.value=m:null),"hide-details":"auto",label:e(t)("dosing.dosesTable.daysTotal"),class:"w-40",rules:[e(l)]},null,8,["modelValue","label","rules"])]),a("div",Rt,[a("div",Et,[a("span",St,o(e(t)("dosing.dosesTable.waterChangeTitle")),1),d(he,{class:"mt-1"})]),a("div",$t,[d(de,{modelValue:e(h),"onUpdate:modelValue":T[7]||(T[7]=m=>M(h)?h.value=m:null),items:b,"item-title":"text","item-value":"value",variant:"underlined","hide-details":"auto"},null,8,["modelValue"])])]),(r(!0),c(w,null,O(e(s).doseModels,(m,W)=>(r(),c("div",{key:W,class:"d-flex justify-space-between align-center"},[d(F,{"model-value":("format"in n?n.format:e(C))(m.amountWaterChange),label:m.fertilizer.name,suffix:m.fertilizer.isLiquid?e(t)("units.ml"):e(t)("units.g"),"hide-details":"auto",class:"pr-2 w-60",disabled:!e(p),"onUpdate:modelValue":x=>e(s).updateAmountWaterChange(x,W)},null,8,["model-value","label","suffix","disabled","onUpdate:modelValue"]),a("div",Ft,[e(h)?(r(),N(F,{key:0,"model-value":("format"in n?n.format:e(C))(m.amount),suffix:m.fertilizer.isLiquid?e(t)("units.ml"):e(t)("units.g"),"hide-details":"auto","onUpdate:modelValue":x=>e(s).updateAmount(x,W)},null,8,["model-value","suffix","onUpdate:modelValue"])):(r(),N(F,{key:1,"model-value":("format"in n?n.format:e(C))(m.amountDay),suffix:m.fertilizer.isLiquid?e(t)("units.ml/d"):e(t)("units.g/d"),"hide-details":"auto","onUpdate:modelValue":x=>e(s).updateAmountDay(x,W)},null,8,["model-value","suffix","onUpdate:modelValue"]))])]))),128))],64)):E("",!0)])}}}),Wt=Me(Mt,[["__scopeId","data-v-bc61e109"]]),xt={class:"d-flex flex-column flex-md-row justify-space-between align-md-center mt-2 mb-2"},At={class:"pl-0 text-center"},Ut={class:"text-center"},It={class:"text-no-wrap"},Pt={class:"text-center"},Nt={class:"text-no-wrap"},Ot={class:"text-center"},Lt={class:"text-no-wrap"},jt={class:"text-center"},Gt={class:"text-no-wrap"},Jt={class:"text-center"},qt={class:"text-no-wrap"},Bt={class:"text-center"},Ht={class:"text-no-wrap"},Kt={class:"text-center"},Yt={class:"text-no-wrap"},Xt={key:3,class:"text-center"},Zt={class:"pl-0 text-center"},Qt={key:3,class:"text-center"},es=Q({name:"TheElementsTable",__name:"TheDosingElementsTable",props:{dosing:{}},setup(A){const{t}=ee(),i=ne(),l=$({get(){return i.isHardness},set(s){i.setHardness(s)}});function b(s){return s<.01}return(s,h)=>{const v=je;return r(),c("div",null,[a("div",xt,[d(ve,{modelValue:e(l),"onUpdate:modelValue":h[0]||(h[0]=u=>M(l)?l.value=u:null),color:"primary",label:e(t)("dosing.elementsTable.showGh"),"hide-details":"auto",class:"mt-0 mb-2 mb-sm-0"},null,8,["modelValue","label"]),We(s.$slots,"default")]),d(fe,{density:"compact"},{default:V(()=>[a("thead",null,[a("tr",null,[a("th",At,o(e(t)("dosing.elementsTable.element")),1),e(i).fertilizersRegime===("FertilizersRegime"in s?s.FertilizersRegime:e(I)).EVERY_DAY?(r(),c(w,{key:0},[a("th",Ut,[k(o(e(t)("dosing.elementsTable.everyDayDose"))+", ",1),a("span",It,o(e(t)("units.mg/l")),1)]),a("th",Pt,[k(o(e(t)("dosing.elementsTable.totalDose"))+", ",1),a("span",Nt,o(e(t)("units.mg/l")),1)])],64)):E("",!0),e(i).fertilizersRegime===("FertilizersRegime"in s?s.FertilizersRegime:e(I)).ONCE_A_WEEK?(r(),c(w,{key:1},[a("th",Ot,[k(o(e(t)("dosing.elementsTable.inWaterChangeDose"))+", ",1),a("span",Lt,o(e(t)("units.mg/l")),1)]),a("th",jt,[k(o(e(t)("dosing.elementsTable.totalDose"))+", ",1),a("span",Gt,o(e(t)("units.mg/l")),1)])],64)):E("",!0),e(i).fertilizersRegime===("FertilizersRegime"in s?s.FertilizersRegime:e(I)).MIX?(r(),c(w,{key:2},[a("th",Jt,[k(o(e(t)("dosing.elementsTable.inWaterChangeDose"))+", ",1),a("span",qt,o(e(t)("units.mg/l")),1)]),a("th",Bt,[k(o(e(t)("dosing.elementsTable.inDayWeekDose"))+", ",1),a("span",Ht,o(e(t)("units.mg/l")),1)]),a("th",Kt,[k(o(e(t)("dosing.elementsTable.totalDose"))+", ",1),a("span",Yt,o(e(t)("units.mg/l")),1)])],64)):E("",!0),e(l)?(r(),c("th",Xt," Gh ")):E("",!0)])]),a("tbody",null,[(r(!0),c(w,null,O(s.dosing.concentrationSorted,([u,p])=>(r(),c("tr",{key:u,class:"caption regular-sm"},[a("td",Zt,o(u),1),e(i).fertilizersRegime===("FertilizersRegime"in s?s.FertilizersRegime:e(I)).EVERY_DAY?(r(),c(w,{key:0},[a("td",{class:J(["text-center text-no-wrap",{"text-caption":b(p.concentrationDay)}])},o(("format"in s?s.format:e(C))(p.concentrationDay)),3),a("td",{class:J(["text-center text-no-wrap",{"text-caption":b(p.concentration)}])},o(("format"in s?s.format:e(C))(p.concentration)),3)],64)):E("",!0),e(i).fertilizersRegime===("FertilizersRegime"in s?s.FertilizersRegime:e(I)).ONCE_A_WEEK?(r(),c(w,{key:1},[a("td",{class:J(["text-center text-no-wrap",{"text-caption":b(p.concentrationWaterChange)}])},o(("format"in s?s.format:e(C))(p.concentrationWaterChange)),3),a("td",{class:J(["text-center text-no-wrap",{"text-caption":b(p.concentrationTotal)}])},o(("format"in s?s.format:e(C))(p.concentrationTotal)),3)],64)):E("",!0),e(i).fertilizersRegime===("FertilizersRegime"in s?s.FertilizersRegime:e(I)).MIX?(r(),c(w,{key:2},[a("td",{class:J(["text-center text-no-wrap",{"text-caption":b(p.concentrationWaterChange)}])},o(("format"in s?s.format:e(C))(p.concentrationWaterChange)),3),a("td",{class:J(["text-center text-no-wrap",{"text-caption":b(p.concentrationDay)}])},o(("format"in s?s.format:e(C))(p.concentrationDay))+" / "+o(("format"in s?s.format:e(C))(p.concentration)),3),a("td",{class:J(["text-center text-no-wrap",{"text-caption":b(p.concentrationTotal)}])},o(("format"in s?s.format:e(C))(p.concentrationTotal)),3)],64)):E("",!0),e(l)?(r(),c("td",Qt,[u in("RemineralRecipe"in s?s.RemineralRecipe:e(Y)).GH?(r(),c(w,{key:0},[k(" +"+o(("format"in s?s.format:e(C))(p.concentrationTotal/("RemineralRecipe"in s?s.RemineralRecipe:e(Y)).GH[u])),1)],64)):E("",!0)])):E("",!0)]))),128))])]),_:1}),d(v,{concentration:s.dosing.concentrationTotal,"is-gh":e(l),class:"mt-8"},null,8,["concentration","is-gh"])])}}});class ts{constructor(t){j(this,"dosing");j(this,"startDate");j(this,"waterChangeDay",{date:"",fertilizers:{}});j(this,"days",[]);this.dosing=t}get daysAmountTotal(){const t={};return this.days.forEach(i=>{ze(i.fertilizers).forEach(([l,b])=>{l in t||(t[l]=0),t[l]+=b.amount})}),t}get daysSelectedTotal(){const t={};return this.days.forEach(i=>{me(i.fertilizers).forEach(l=>{l in t||(t[l]=0),i.fertilizers[l].selected&&(t[l]+=1)})}),t}resetWaterChangeDay(){this.waterChangeDay={date:"",fertilizers:{}}}resetDays(){this.days=[]}initWaterChangeDay(){this.resetWaterChangeDay(),this.waterChangeDay.date=this.startDate,this.dosing.doses.forEach(t=>{t.amountWaterChange&&(this.waterChangeDay.fertilizers[t.fertilizer.name]={amount:t.amountWaterChange,status:ie.ACTIVE})})}initDays(){this.resetDays();let t=new Date(this.startDate);[...Array(this.dosing.daysTotal)].forEach(()=>{const i=ye(t),l={};this.dosing.doses.forEach(b=>{b.amountDay&&(l[b.fertilizer.name]={amount:b.amountDay,status:ie.ACTIVE,selected:!0})}),Object.entries(l).length!==0&&this.days.push({date:i,fertilizers:l}),t=new Date(t.setDate(t.getDate()+1))})}updateDays(){let t=new Date(this.startDate);for(const i of this.days){i.date=t.toISOString().split("T")[0];for(const l in i.fertilizers)i.fertilizers[l].status=ie.ACTIVE;t=new Date(t.setDate(t.getDate()+1))}}spreadDayAmounts(t){const i=this.dosing.doses.find(l=>l.fertilizer.name===t);i&&this.days.forEach(l=>{i.amountDay&&l.fertilizers[t].selected&&(l.fertilizers[t].amount=C(i.amount/this.daysSelectedTotal[t]))})}resetDaysAmount(t){const i=this.dosing.doses.find(l=>l.fertilizer.name===t);i&&this.days.forEach(l=>{l.fertilizers[t].amount=C(i.amount/this.days.length),l.fertilizers[t].selected=!0})}toJson(){return{dosing:this.dosing.toJson(),startDate:this.startDate,waterChangeDay:this.waterChangeDay,days:this.days}}}const ss={key:0},as={class:"text-center pl-0"},ns={key:0},os={class:"pl-0 text-center"},ls={class:"pl-0 text-center"},is={class:"d-flex flex-column"},rs={style:{"text-transform":"capitalize"}},ds={key:0,class:"d-flex justify-center align-center"},us={style:{width:"50px"}},ms={class:"pl-0 text-center font-weight-medium"},cs={key:0,class:"d-flex flex-column align-center"},fs={class:"font-weight-medium"},ps=["onClick"],hs={class:"d-flex mt-10"},gs=Q({name:"TheScheduleDoseTable",__name:"TheScheduleDoseTable",props:{dosing:{}},setup(A){const{t,locale:i}=ee(),l=be(),b=xe(),{appRoutes:s}=Je(),h=qe(),v=_e(),u=A,p=G(),n=Ae(new ts(u.dosing)),T=$(()=>!isNaN(p.value));ue(()=>u.dosing,()=>{n.dosing=u.dosing,n.startDate&&(n.initWaterChangeDay(),n.initDays())}),Ve(()=>{if(p.value=+l.query.schedule,isNaN(p.value))n.startDate=ye(new Date),n.initWaterChangeDay(),n.initDays();else{const f=JSON.parse(JSON.stringify(h.schedules[p.value]));f&&(n.startDate=f.startDate,n.waterChangeDay=f.waterChangeDay,n.days=f.days)}});function F(f){f&&(n.startDate=f,n.initWaterChangeDay(),n.days.length>0?n.updateDays():n.initDays())}async function m(){T.value?h.editSchedule(p.value,n.toJson()):h.saveSchedule(n.toJson()),await b.push(s.value.schedules.path)}function W(f,P){P.selected||(P.amount=0),n.spreadDayAmounts(f)}async function x(){h.removeSchedule(p.value),v.show(t("dosing.schedule.scheduleRemoved")),await b.push(s.value.schedules.path)}return(f,P)=>{const B=ce;return r(),c("div",null,[d(He,{"model-value":e(n).startDate,type:"date",label:e(t)("dosing.schedule.chooseDate"),class:"mb-4","onUpdate:modelValue":F},null,8,["model-value","label"]),d(X,null,{default:V(()=>[e(n).startDate?(r(),c("div",ss,[d(fe,{"fixed-footer":""},{default:V(()=>[a("thead",null,[a("tr",null,[a("th",as,o(e(t)("dosing.schedule.days")),1),(r(!0),c(w,null,O(e(n).dosing.doses,z=>(r(),c("th",{key:z.fertilizer.name,class:"text-center"},o(z.fertilizer.name),1))),128))])]),a("tbody",null,[e(n).dosing.fertilizersRegime===("FertilizersRegime"in f?f.FertilizersRegime:e(I)).ONCE_A_WEEK||e(n).dosing.fertilizersRegime===("FertilizersRegime"in f?f.FertilizersRegime:e(I)).MIX?(r(),c("tr",ns,[a("td",os,o(e(t)("dosing.schedule.waterChange")),1),(r(!0),c(w,null,O(e(n).dosing.doses,z=>{var S;return r(),c("td",{key:`water_change_${z.fertilizer.name}`,class:"text-center"},o(((S=e(n).waterChangeDay.fertilizers[z.fertilizer.name])==null?void 0:S.amount)||"—"),1)}),128))])):E("",!0),e(n).days.length>0?(r(),c(w,{key:1},[(r(!0),c(w,null,O(e(n).days,z=>(r(),c("tr",{key:z.date},[a("td",ls,[a("div",is,[a("span",rs,o(("getWeekday"in f?f.getWeekday:e($e))(z.date,e(i))),1),a("span",null,o(("formatDate"in f?f.formatDate:e(Fe))(z.date,e(i))),1)])]),(r(!0),c(w,null,O(e(n).dosing.doses,S=>{var H;return r(),c("td",{key:S.fertilizer.name+z,class:"text-center"},[((H=z.fertilizers[S.fertilizer.name])==null?void 0:H.amount)!==void 0?(r(),c("div",ds,[a("div",us,[d(B,{modelValue:z.fertilizers[S.fertilizer.name].amount,"onUpdate:modelValue":g=>z.fertilizers[S.fertilizer.name].amount=g},null,8,["modelValue","onUpdate:modelValue"])]),d(Ke,{modelValue:z.fertilizers[S.fertilizer.name].selected,"onUpdate:modelValue":[g=>z.fertilizers[S.fertilizer.name].selected=g,g=>W(S.fertilizer.name,z.fertilizers[S.fertilizer.name])],color:"primary",dense:"","hide-details":"auto",class:"mt-0 ml-1",style:{display:"inline-block"}},null,8,["modelValue","onUpdate:modelValue"])])):(r(),c(w,{key:1},[k(" — ")],64))])}),128))]))),128)),a("tr",null,[a("td",ms,o(e(t)("common.total")),1),(r(!0),c(w,null,O(e(n).dosing.doses,z=>(r(),c("td",{key:z.fertilizer.name,class:"text-center"},[e(n).daysAmountTotal[z.fertilizer.name]?(r(),c("div",cs,[a("div",null,[a("span",{class:J({"text-warning":("format"in f?f.format:e(C))(e(n).daysAmountTotal[z.fertilizer.name])!==("format"in f?f.format:e(C))(z.amount)})},o(("format"in f?f.format:e(C))(e(n).daysAmountTotal[z.fertilizer.name])),3),P[1]||(P[1]=k(" / ")),a("span",fs,o(("format"in f?f.format:e(C))(z.amount)),1)]),a("div",{class:"text-blue cursor-pointer",onClick:S=>e(n).resetDaysAmount(z.fertilizer.name)},o(e(t)("buttons.reset")),9,ps)])):(r(),c(w,{key:1},[k(" — ")],64))]))),128))])],64)):E("",!0)])]),_:1}),a("div",hs,[e(T)?(r(),N(Z,{key:0,color:"error",onClick:x},{default:V(()=>[k(o(e(t)("buttons.remove")),1)]),_:1})):E("",!0),d(Z,{class:"ml-auto mr-1 mr-sm-2 ml-sm-auto",onClick:P[0]||(P[0]=z=>e(b).push(e(s).schedules.path))},{default:V(()=>[k(o(e(t)("buttons.cancel")),1)]),_:1}),d(Z,{color:"primary",onClick:m},{default:V(()=>[k(o(e(t)("buttons.save")),1)]),_:1})])])):E("",!0)]),_:1})])}}}),ys=Q({__name:"LineChart",props:{data:{},options:{}},setup(A){return Xe.register(Ze,Qe,et,tt,st,at,nt),(t,i)=>(r(),N(e(ot),{id:"my-chart-id",options:t.options,data:t.data},null,8,["options","data"]))}}),bs={key:0},Vs={class:"mb-4 text-body-2"},Ds={class:"mb-2"},vs={class:"text-center"},Ts={class:"text-center"},_s={class:"text-center"},zs={class:"text-center"},Cs={class:"text-center"},ws={class:"text-center"},ks={class:"text-center"},Rs={key:0},Es=Q({name:"TheDynamicsPopup",__name:"TheDynamicsPopup",props:Ue({dosing:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:["update:modelValue"],setup(A){const{t}=ee(),{mdAndUp:i}=Ie(),{positive:l}=De(),b=ne(),s=Pe(A,"modelValue"),h=A,v=G(!1),u=G(),p=G(),n=G(),T=G(),F=G([]),m={NO3:"#D81B60",PO4:"#1E88E5",K:"#78909C"},W={maintainAspectRatio:!1,responsive:!0},x=$(()=>({labels:Object.keys([...Array(h.dosing.daysTotal*15)]),datasets:[{label:u.value,fill:!1,borderColor:m[u.value],data:F.value}]})),f=$(()=>h.dosing.countBalancedIons()),P=$(()=>{let y=0,D=0;return Be(f.value).forEach(([U,K])=>{y+=U,D+=K}),[y,D]}),B=$(()=>"Ca"in f.value&&"Mg"in f.value?f.value.Ca[0]/f.value.Mg[0]:null),z=$(()=>"Ca"in f.value&&"Mg"in f.value?f.value.Ca[1]/f.value.Mg[1]:null),S=$(()=>Y.countCaGh(f.value.Ca[0],1/q,1)+Y.countMgGh(f.value.Mg[0],1/q,1)),H=$(()=>Y.countCaGh(f.value.Ca[1],1/q,1)+Y.countMgGh(f.value.Mg[1],1/q,1)),g=$({get(){return b.tank.waterChangeVolume},set(y){b.setWaterChangeVolume(y)}});ue(u,()=>{p.value=0,n.value=0,T.value=0}),ue([u,p,n,T,()=>h.dosing],()=>{F.value=h.dosing.countIonDynamic(u.value,p.value,n.value,T.value)});function _(){return Math.ceil(Math.log(.05)/Math.log(1-h.dosing.waterChangeDecimal))}return(y,D)=>{const U=ce,K=Ye,oe=Te,le=ys;return r(),N(lt,{modelValue:s.value,"onUpdate:modelValue":D[7]||(D[7]=R=>s.value=R),"max-width":"700"},{default:V(()=>[d(ut,null,{default:V(()=>[d(it,null,{default:V(()=>[k(o(e(t)("dosing.dynamicsPopup.tankParams")),1)]),_:1}),d(rt,null,{default:V(()=>[d(U,{modelValue:e(g),"onUpdate:modelValue":D[0]||(D[0]=R=>M(g)?g.value=R:null),label:e(t)("dosing.dosesTable.waterChange"),hint:e(t)("dosing.dosesTable.waterChangeHint"),"persistent-hint":"",class:"pr-2 w-60 mb-4","validate-on":"eager",rules:[e(l)]},null,8,["modelValue","label","hint","rules"]),d(X,null,{default:V(()=>[e(g)?(r(),c("div",bs,[a("div",Vs,[k(o(e(t)("dosing.dynamicsPopup.description",{waterChangePercent:("format"in y?y.format:e(C))(y.dosing.waterChangePercent,3),daysTotal:y.dosing.daysTotal,balancedWaterChangeNumber:_(),balancedDaysTotal:y.dosing.daysTotal*(_()-1)}))+" ",1),d(ge,{location:"bottom","max-width":"400","open-on-click":"","open-on-hover":""},{activator:V(({props:R})=>[d(K,pe({name:"mdi-help-circle-outline",size:"18",class:"mb-n1"},R),null,16)]),default:V(()=>[a("p",Ds,o(e(t)("dosing.dynamicsPopup.tooltip.text1")),1),a("p",null,o(e(t)("dosing.dynamicsPopup.tooltip.text2")),1)]),_:1}),D[8]||(D[8]=k(": "))]),Object.keys(e(f)).length>0?(r(),N(fe,{key:0,density:"compact"},{default:V(()=>[a("thead",null,[a("tr",null,[a("th",vs,o(e(t)("dosing.dynamicsPopup.element")),1),a("th",Ts,[k(o(e(t)("dosing.dynamicsPopup.range"))+", "+o(e(t)("units.mg/l"))+" ",1),d(ge,{location:"bottom","max-width":"400","open-on-click":"","open-on-hover":""},{activator:V(({props:R})=>[d(K,pe({name:"mdi-help-circle-outline",size:"18",class:"mb-n1"},R),null,16)]),default:V(()=>[k(" "+o(e(t)("dosing.dynamicsPopup.tableTooltip")),1)]),_:1})])])]),a("tbody",null,[(r(!0),c(w,null,O(e(f),(R,te)=>(r(),c("tr",{key:te},[a("td",_s,o(te),1),a("td",zs,o(("format"in y?y.format:e(C))(R[0]))+" — "+o(("format"in y?y.format:e(C))(R[1])),1)]))),128))]),a("tfoot",null,[e(B)&&e(z)?(r(),c(w,{key:0},[a("tr",null,[D[9]||(D[9]=a("td",{class:"text-center"},"Ca/Mg",-1)),a("td",Cs,o(("format"in y?y.format:e(C))(e(B)))+" — "+o(("format"in y?y.format:e(C))(e(z))),1)]),a("tr",null,[D[10]||(D[10]=a("td",{class:"text-center"},"dGh",-1)),a("td",ws,o(("format"in y?y.format:e(C))(e(S)))+" — "+o(("format"in y?y.format:e(C))(e(H))),1)])],64)):E("",!0),a("tr",null,[D[11]||(D[11]=a("td",{class:"text-center"},"TDS",-1)),a("td",ks,o(("format"in y?y.format:e(C))(e(P)[0]))+" — "+o(("format"in y?y.format:e(C))(e(P)[1])),1)])])]),_:1})):E("",!0),d(oe,{modelValue:e(v),"onUpdate:modelValue":D[1]||(D[1]=R=>M(v)?v.value=R:null),button:"",class:"my-10"},{default:V(()=>[k(o(e(t)("dosing.dynamicsPopup.dynamics")),1)]),_:1},8,["modelValue"]),d(X,null,{default:V(()=>[e(v)?(r(),c("div",Rs,[d(de,{modelValue:e(u),"onUpdate:modelValue":D[2]||(D[2]=R=>M(u)?u.value=R:null),items:y.dosing.ionList,variant:"outlined",label:e(t)("dosing.dynamicsPopup.chooseElement")},null,8,["modelValue","items","label"]),a("div",{style:Ne(e(i)?"height: 400px;":"height: 250px;"),class:"mb-4"},[d(le,{data:e(x),options:W,class:"line-chart"},null,8,["data"])],4),d(U,{modelValue:e(n),"onUpdate:modelValue":D[3]||(D[3]=R=>M(n)?n.value=R:null),label:e(t)("dosing.dynamicsPopup.concInWaterChange"),suffix:e(t)("units.mg/l"),"hide-details":"auto"},null,8,["modelValue","label","suffix"]),d(U,{modelValue:e(p),"onUpdate:modelValue":D[4]||(D[4]=R=>M(p)?p.value=R:null),label:e(t)("dosing.dynamicsPopup.concInTank"),suffix:e(t)("units.mg/l"),"hide-details":"auto"},null,8,["modelValue","label","suffix"]),d(U,{modelValue:e(T),"onUpdate:modelValue":D[5]||(D[5]=R=>M(T)?T.value=R:null),label:e(t)("dosing.dynamicsPopup.concPerDay"),suffix:e(t)("units.mg/l"),"hide-details":"auto"},null,8,["modelValue","label","suffix"])])):E("",!0)]),_:1})])):E("",!0)]),_:1})]),_:1}),d(dt,null,{default:V(()=>[d(Z,{color:"primary",onClick:D[6]||(D[6]=R=>s.value=!1)},{default:V(()=>[k(o(e(t)("buttons.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});class Ss{constructor(t,i,l,b){j(this,"doses");j(this,"fertilizersRegime");j(this,"daysTotal");j(this,"tank");this.doses=t,this.fertilizersRegime=i,this.daysTotal=l,this.tank=b}get isDoses(){return this.doses.length>0}get waterChangeDecimal(){return this.tank.waterChangeVolume/this.tank.volume}get waterChangePercent(){return this.tank.waterChangeVolume/this.tank.volume*100}get concentration(){const t={};return this.doses.forEach(i=>{ze(i.fertilizer.concentration).forEach(([l,b])=>{l in t||(t[l]={concentration:0,concentrationDay:0,concentrationWaterChange:0,concentrationTotal:0});let s=i.amount*b/this.tank.volume,h=i.amountDay*b/this.tank.volume,v=0;this.tank.waterChangeVolume&&(v=i.amountWaterChange*b/this.tank.waterChangeVolume);let u=s;this.fertilizersRegime===I.ONCE_A_WEEK&&(u=v*this.waterChangeDecimal),this.fertilizersRegime===I.MIX&&(u=v*this.waterChangeDecimal+s),i.fertilizer.isLiquid||(s*=q,h*=q,v*=q,u*=q),t[l].concentration+=s,t[l].concentrationDay+=h,t[l].concentrationTotal+=u,t[l].concentrationWaterChange+=v})}),t}get ionList(){return me(this.concentration)}get concentrationSorted(){const t=[];return Object.entries(this.concentration).forEach(([i,l])=>{t.push([i,{...l}])}),t.sort((i,l)=>l[1].concentrationTotal-i[1].concentrationTotal),t}get concentrationTotal(){return Object.fromEntries(Object.entries(this.concentration).map(([t,i])=>[t,i.concentrationTotal]))}countIonDynamic(t,i=0,l=0,b=0){const s=[];let h=i;if(t in this.concentration)return me([...Array(this.daysTotal*15)]).forEach(v=>{+v>0&&+v%this.daysTotal===0&&(h=h*(1-this.waterChangeDecimal)+l*this.waterChangeDecimal),this.fertilizersRegime===I.EVERY_DAY?h+=this.concentration[t].concentrationDay:this.fertilizersRegime===I.ONCE_A_WEEK?+v%this.daysTotal===0&&(h+=this.concentration[t].concentrationWaterChange*this.waterChangeDecimal):this.fertilizersRegime===I.MIX&&(+v%this.daysTotal===0&&(h+=this.concentration[t].concentrationWaterChange*this.waterChangeDecimal),h+=this.concentration[t].concentrationDay),h-=b,h<0&&(h=0),s.push(h)}),s}countBalancedIons(){const t={};return["NO3","PO4","K","Ca","Mg","Na","SO4","Cl"].forEach(l=>{const b=this.countIonDynamic(l);if(b){const s=b.slice(-1*this.daysTotal);t[l]=[s[0],s[this.daysTotal-1]]}}),t}toJson(){return{doses:this.doses.map(t=>t.toJson()),daysTotal:this.daysTotal,tank:{...this.tank},fertilizersRegime:this.fertilizersRegime}}}const $s={class:"text-body-2 text-grey-darken-1 mb-8"},Fs={key:0,class:"d-flex flex-column flex-sm-row align-sm-center"},Ms={key:0},xa=Q({name:"DosingPage",__name:"index",setup(A){const{t,locale:i}=ee(),l=be(),b=ct(),s=ft(),h=pt(),v=ht(),u=ne(),p=_e(),n=G(!1),T=G(!1),F=b.tankModels.map(g=>g.toJson()),m=$(()=>new Ss(u.doseModels,u.fertilizersRegime,u.daysTotal,u.tank)),W=$(()=>{const g=JSON.parse(JSON.stringify(gt));return i.value==="en"&&yt.forEach(_=>{const y=g.find(D=>_.key===D.key);y&&(y.name=_.name,y.description=_.description)}),g.sort((_,y)=>_.name.localeCompare(y.name)),g}),x=$(()=>{let g=[];if(S.value){const _=s.fertilizerRecipes.map(U=>U.name),y=h.fertilizers.map(U=>U.name),D=v.remineralRecipes.map(U=>U.name);g=W.value.filter(U=>![..._,...y,...D].includes(U.name))}return[...s.fertilizerRecipes.map(_=>new ae({fertilizer:_,fertilizerType:se.fertilizerRecipe,daysTotal:u.daysTotal})),...h.fertilizers.map(_=>new ae({fertilizer:_,fertilizerType:se.fertilizer,daysTotal:u.daysTotal})),...v.remineralRecipes.map(_=>new ae({fertilizer:_,fertilizerType:se.remineralRecipe,daysTotal:u.daysTotal})),...g.map(_=>new ae({fertilizer:_,fertilizerType:se.fertilizer,daysTotal:u.daysTotal}))]}),f=$(()=>!isNaN(+l.query.schedule));Ve(()=>{l.query.schedule&&(T.value=!0)});function P(g){if(typeof g=="number"){u.setTank({name:g.toString(),volume:g});return}else if(typeof g=="string"||g===null)return;u.setTank({name:g.name,volume:g.volumeTotal,waterChangeVolume:g.waterChangeVolume})}function B(g){g.length>u.doseModels.length&&typeof[...g].pop()=="string"||u.setDoses(g.map(_=>_.toJson()))}function z(){u.resetDosing()}const S=$({get(){return u.isDefaultFertilizers},set(g){u.setDefaultFertilizers(g),p.show(t(g?"dosing.brandedAdded":"dosing.brandedRemoved"))}}),H=[g=>!!g||"Выберите аквариум"];return Oe({title:t("meta.dosing.title"),description:t("meta.dosing.description"),keywords:t("meta.dosing.keywords")}),(g,_)=>{const y=Re,D=Se,U=Wt,K=es,oe=Te,le=gs,R=Es,te=mt;return r(),N(bt,{class:"mb-12"},{default:V(()=>[d(Vt,null,{default:V(()=>[d(y,null,{button:V(()=>[d(Z,{color:"primary",onClick:z},{default:V(()=>[k(o(e(t)("buttons.reset")),1)]),_:1})]),default:V(()=>[k(o(e(t)("dosing.title"))+" ",1)]),_:1}),d(Dt,{cols:"12",sm:"10",md:"8","offset-sm":"1","offset-md":"2"},{default:V(()=>[a("div",$s,o(e(t)("dosing.doses.description")),1),d(te,null,{default:V(()=>[d(Ge,{ref:"scheduleForm"},{default:V(()=>[d(Ee,{modelValue:e(m).tank,"onUpdate:modelValue":[_[0]||(_[0]=L=>e(m).tank=L),P],modelModifiers:{number:!0},items:e(F),"item-title":"name",variant:"underlined",label:e(t)("dosing.tankInputLabel"),hint:e(t)("dosing.tankInputHint"),"persistent-hint":"","hide-selected":"",rules:H,class:"mb-4",disabled:e(f)},null,8,["modelValue","items","label","hint","disabled"]),d(X,null,{default:V(()=>{var L;return[(L=e(m).tank)!=null&&L.volume?(r(),c("div",Fs,[d(D,{"model-value":e(u).doseModels,items:e(x),variant:"underlined",label:e(t)("dosing.fertilizersInputLabel"),hint:e(t)("dosing.fertilizersInputHint"),"item-title":"fertilizer.name","persistent-hint":"",multiple:"",chips:"","closable-chips":"",class:"mb-4","onUpdate:modelValue":B},null,8,["model-value","items","label","hint"]),d(ve,{modelValue:e(S),"onUpdate:modelValue":_[1]||(_[1]=Ce=>M(S)?S.value=Ce:null),color:"primary",label:e(t)("dosing.switch"),class:"ml-sm-4 flex-shrink-0"},null,8,["modelValue","label"])])):E("",!0)]}),_:1}),e(m).isDoses?(r(),N(U,{key:0,class:"mb-4"})):E("",!0),d(X,null,{default:V(()=>[e(m).isDoses?(r(),c("div",Ms,[d(K,{"is-helpful-info":"","is-switchers":"",dosing:e(m)},{default:V(()=>[d(Z,{color:"success",class:"mb-3 mb-sm-0",onClick:_[2]||(_[2]=L=>{n.value=!0})},{default:V(()=>[k(o(e(t)("dosing.dynamicsPopup.tankParams")),1)]),_:1})]),_:1},8,["dosing"])])):E("",!0)]),_:1}),e(m).isDoses?(r(),c(w,{key:1},[d(oe,{modelValue:e(T),"onUpdate:modelValue":_[3]||(_[3]=L=>M(T)?T.value=L:null),button:"",class:"my-10"},{default:V(()=>[k(o(e(t)("dosing.schedule.createSchedule")),1)]),_:1},8,["modelValue"]),d(X,null,{default:V(()=>[e(T)?(r(),N(le,{key:0,dosing:e(m),class:"mt-10"},null,8,["dosing"])):E("",!0)]),_:1})],64)):E("",!0),d(R,{modelValue:e(n),"onUpdate:modelValue":_[4]||(_[4]=L=>M(n)?n.value=L:null),dosing:e(m)},null,8,["modelValue","dosing"])]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})}}});export{xa as default};
